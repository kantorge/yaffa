import{_ as f,a as c,o as d,b as n,t as o,F as D,h as T,f as F,i as C,r as y,d as p,n as A,g as m,e as R,c as L}from"./app-KLFPBacJ.js";import{l as V,_,a as P,p as O}from"./helpers-C8PqwG3r.js";import{t as w,d as v,c as N,e as j}from"./dataTableHelper-BFrUsbwO.js";import{s as W}from"./select2-8otZJJuH.js";import{D as z}from"./DateRangePicker-BBP1Q5Mi.js";import{u as S,t as x,c as k,P as Y,l as B,d as g,b as Q,D as X,V as H,e as I,L as G,m as J,a as K}from"./animated-BLhhOB8u.js";import{Q as Z}from"./Modal-D3Xn8WLm.js";import"./dataTables.bootstrap5-Csew7iXD.js";import"./tslib.es6-CZM0TROl.js";import"./Datepicker-CU1wOnOT.js";import"./ActionButtonBar-E-t72VHc.js";W();V(window.YAFFA.language);const ee={name:"FindTransactionSelectCard",emits:["update","preset-ready"],props:{property:{type:String,required:!0},title:{type:String,required:!0},placeholder:{type:String,default:"Select item"},searchApiPath:{type:String,required:!0},search_label_field:{type:String,default:"name"},presetItemIds:{type:Array,default:[]},detailsApiPath:{type:String,required:!0},detailsLabelField:{type:String,default:"name"}},data(){return{itemsToPreset:this.presetItemIds.map(e=>e),selectedValues:[],elementId:`select_${this.property}`,elementSelector:`#select_${this.property}`}},computed:{ready(){return this.itemsToPreset.length===0}},mounted(){const e=this;$(this.elementSelector).select2({theme:"bootstrap-5",multiple:!0,ajax:{url:this.searchApiPath,dataType:"json",delay:150,data:function(t){return{q:t.term,withInactive:!0}},processResults:function(t){return{results:t.map(function(r){return{id:r.id,text:r[e.search_label_field]}})}},cache:!0},selectOnClose:!1,placeholder:_(this.placeholder),allowClear:!0}).on("select2:select select2:unselect",function(t){const r=new Event("change",{bubbles:!0,cancelable:!0});t.target.dispatchEvent(r),e.selectedValues=$(t.target).select2("val"),e.$emit("update",$(t.target).select2("val"))}),this.presetItemIds.length>0?this.presetItemIds.forEach(function(t){$.ajax({url:e.detailsApiPath.replace("#id#",t),data:{},success:function(r){$(e.elementSelector).append(new Option(r[e.detailsLabelField],r.id,!0,!0)).trigger("change").trigger({type:"select2:select",params:{data:{id:r.id,name:r[e.detailsLabelField]}}}),e.itemsToPreset=e.itemsToPreset.filter(s=>s!==t),e.itemsToPreset.length===0&&e.$emit("preset-ready",e.property)}})}):this.$emit("preset-ready",this.property)},methods:{clearSelection:function(){$(this.elementSelector).val(null).trigger("change"),this.selectedValues=[],this.$emit("update",this.selectedValues)},__:_}},te={class:"card mb-3"},ae={class:"card-header d-flex justify-content-between"},se={class:"card-title"},re=["disabled","title"],ne={class:"card-body"},ie=["id"];function le(e,t,r,s,i,a){return d(),c("div",te,[n("div",ae,[n("div",se,o(a.__(r.title)),1),n("div",null,[n("button",{class:"btn btn-sm btn-outline-danger",onClick:t[0]||(t[0]=(...l)=>a.clearSelection&&a.clearSelection(...l)),disabled:i.selectedValues.length===0||!a.ready,title:a.__("Clear selection")},[...t[1]||(t[1]=[n("i",{class:"fa fa-fw fa-times"},null,-1)])],8,re)])]),n("div",ne,[n("select",{id:i.elementId,class:"form-select"},null,8,ie)])])}const oe=f(ee,[["render",le]]),ce={name:"DateRangeSelector",emits:["update"],props:{initialDateFrom:{type:String,default:null},initialDateTo:{type:String,default:null}},data(){return{dateFrom:this.initialDateFrom,dateTo:this.initialDateTo,dateRangePicker:null,presetSelectorOptions:[{value:"placeholder",label:"Select preset",callback:function(){this.clearSelection()}},{value:"thisMonth",label:"This month",callback:function(){const e=new Date;this.dateRangePicker.setDates(new Date(e.getFullYear(),e.getMonth(),1),new Date(e.getFullYear(),e.getMonth()+1,0))}},{value:"thisQuarter",label:"This quarter",callback:function(){const e=new Date;this.dateRangePicker.setDates(new Date(e.getFullYear(),Math.floor(e.getMonth()/3)*3,1),new Date(e.getFullYear(),Math.floor(e.getMonth()/3)*3+3,0))}},{value:"thisYear",label:"This year",callback:function(){const e=new Date;this.dateRangePicker.setDates(new Date(e.getFullYear(),0,1),new Date(e.getFullYear(),11,31))}},{value:"thisMonthToDate",label:"This month to date",callback:function(){const e=new Date;this.dateRangePicker.setDates(new Date(e.getFullYear(),e.getMonth(),1),e)}},{value:"thisQuarterToDate",label:"This quarter to date",callback:function(){const e=new Date;this.dateRangePicker.setDates(new Date(e.getFullYear(),Math.floor(e.getMonth()/3)*3,1),e)}},{value:"thisYearToDate",label:"This year to date",callback:function(){const e=new Date;this.dateRangePicker.setDates(new Date(e.getFullYear(),0,1),e)}},{value:"previousMonth",label:"Previous month",callback:function(){const e=new Date;this.dateRangePicker.setDates(new Date(e.getFullYear(),e.getMonth()-1,1),new Date(e.getFullYear(),e.getMonth(),0))}},{value:"previousMonthToDate",label:"Previous month to date",callback:function(){const e=new Date;this.dateRangePicker.setDates(new Date(e.getFullYear(),e.getMonth()-1,1),e)}}]}},mounted(){this.dateRangePicker=new z(this.$refs.dateRangePicker,{allowOneSidedRange:!0,weekStart:1,todayButton:!0,todayButtonMode:1,todayHighlight:!0,language:window.YAFFA.language,format:"yyyy-mm-dd",autohide:!0,buttonClass:"btn"}),this.dateRangePicker.setDates(this.dateFrom,this.dateTo)},methods:{clearSelection(){this.dateRangePicker.setDates({clear:!0},{clear:!0}),this.dateFrom=null,this.dateTo=null;const e=document.getElementById("dateRangePickerPresets");e.selectedIndex=0},onDateChange(){if(!this.dateRangePicker)return;const e=this.dateRangePicker.getDates("yyyy-mm-dd");this.dateFrom=e[0],this.dateTo=e[1],this.$emit("update",{dateFrom:this.dateFrom,dateTo:this.dateTo})},onPresetSelect(e){const t=e.target.value,r=this.presetSelectorOptions.find(s=>s.value===t);r&&(r.callback.call(this),this.$emit("update",{dateFrom:this.dateFrom,dateTo:this.dateTo}))},__:function(e,t){return _(e,t)}}},de={class:"card mb-3"},ue={class:"card-header d-flex justify-content-between"},he={class:"card-title"},_e=["title"],pe={class:"card-body",ref:"dateRangePicker",dusk:"dateRangePicker"},me={class:"row"},ye={class:"col-6"},fe={for:"date_from",class:"form-label"},ge=["placeholder"],be={class:"col-6"},we={for:"date_to",class:"form-label"},ve=["placeholder"],De={class:"row mt-2"},Te={class:"col-12"},Fe=["value"];function Ce(e,t,r,s,i,a){return d(),c("div",de,[n("div",ue,[n("div",he,o(a.__("Date")),1),n("div",null,[n("button",{class:"btn btn-sm btn-outline-danger",id:"clearDateSelection",onClick:t[0]||(t[0]=(...l)=>a.clearSelection&&a.clearSelection(...l)),title:a.__("Clear selection")},[...t[4]||(t[4]=[n("i",{class:"fa fa-fw fa-times"},null,-1)])],8,_e)])]),n("div",pe,[n("div",me,[n("div",ye,[n("label",fe,o(a.__("Date from")),1),n("input",{type:"text",class:"form-control",name:"date_from",id:"date_from",placeholder:a.__("Select date"),"on:changeDate":t[1]||(t[1]=(...l)=>a.onDateChange&&a.onDateChange(...l)),autocomplete:"off"},null,40,ge)]),n("div",be,[n("label",we,o(a.__("Date to")),1),n("input",{type:"text",class:"form-control",name:"date_to",id:"date_to",placeholder:a.__("Select date"),"on:changeDate":t[2]||(t[2]=(...l)=>a.onDateChange&&a.onDateChange(...l)),autocomplete:"off"},null,40,ve)])]),n("div",De,[n("div",Te,[n("select",{id:"dateRangePickerPresets",class:"form-select",onChange:t[3]||(t[3]=(...l)=>a.onPresetSelect&&a.onPresetSelect(...l))},[(d(!0),c(D,null,T(i.presetSelectorOptions,l=>(d(),c("option",{value:l.value},o(a.__(l.label)),9,Fe))),256))],32)])])],512)])}const Pe=f(ce,[["render",Ce]]);S(x);const Se={name:"WithdrawalsByParentCategory",props:{transactions:{type:Array,required:!1,default:()=>[]},title:{type:String,default:"Withdrawals by category"},busy:{type:Boolean,required:!0}},data(){return{filteredTransactions:[],chartData:{},selectedParentId:void 0}},watch:{transactions:{handler(e){this.updateChartData(e)},immediate:!0,deep:!0}},methods:{updateChartData(e){const t=[];if(e.forEach(r=>{r.transaction_type_id===1&&t.push(r)}),!t.length)this.filteredTransactions=[],this.chartData=[{amount:1,id:0,parent_id:0,parent_name:"No data",name:"No data",selected:!1,disabled:!0,color:g("#dadada"),tooltip:"No data"}];else{this.filteredTransactions=t;const r=[];t.flatMap(s=>s.transaction_items).forEach(s=>{if(!s.category)return;const i={};this.getDistinctParentIds().forEach((h,b)=>{this.chart?i[h]=this.chart.colors.getIndex(b):i[h]=g("#000000")});let a;this.selectedParentId&&s.category.parent_id===this.selectedParentId?a=s.category:a=s.category.parent_id?s.category.parent:s.category;let l=r.findIndex(h=>h.id===a.id);l===-1&&(r.push({amount:0,id:a.id,parent_id:a.parent_id,parent_name:a.parent_id?a.parent.name:a.name,name:a.parent_id===this.selectedParentId?a.full_name:a.name,selected:a.parent_id===this.selectedParentId,color:i[a.id]||i[a.parent_id]}),l=r.length-1),r[l].amount+=s.amount_in_base}),r.sort((s,i)=>s.parent_name.localeCompare(i.parent_name)),this.chartData=r.map(s=>({...s,tooltip:`${s.name}: ${P(s.amount,window.YAFFA.locale,window.YAFFA.baseCurrency)}`}))}this.chart&&(this.chart.data=this.chartData)},getDistinctParentIds(){return this.filteredTransactions.flatMap(e=>e.transaction_items).filter(e=>e.category).map(e=>e.category.parent_id).filter((e,t,r)=>r.indexOf(e)===t)}},mounted(){let e=k(this.$refs.chartContainer,Y);e.data=null;let t=e.series.push(new B);t.dataFields.value="amount",t.dataFields.category="name",t.slices.template.propertyFields.fill="color",t.slices.template.propertyFields.isActive="selected",t.labels.template.propertyFields.disabled="disabled",t.ticks.template.propertyFields.disabled="disabled",t.slices.template.tooltipText="{tooltip}",t.slices.template.events.on("hit",s=>{const i=s.target.dataItem.dataContext;this.selectedParentId=i.id,this.updateChartData(this.transactions)});let r=e.titles.create();r.text=this.title,r.fontSize=20,r.marginBottom=20,this.chart=e},beforeDestroy(){this.chart&&this.chart.dispose()}},xe={class:"container"},ke={class:"loader"},Ae={class:"chartContainer",ref:"chartContainer"};function Re(e,t,r,s,i,a){return d(),c("div",xe,[F(n("div",ke,null,512),[[C,r.busy]]),F(n("div",Ae,null,512),[[C,!r.busy]])])}const Ie=f(Se,[["render",Re],["__scopeId","data-v-0b427c1a"]]);S(x);const $e={name:"DepositsByParentCategory",props:{transactions:{type:Array,required:!1,default:()=>[]},title:{type:String,default:"Deposits by category"},busy:{type:Boolean,required:!0}},data(){return{filteredTransactions:[],chartData:{},selectedParentId:void 0}},watch:{transactions:{handler(e){this.updateChartData(e)},immediate:!0,deep:!0}},methods:{updateChartData(e){const t=[];if(e.forEach(r=>{r.transaction_type_id===2&&t.push(r)}),!t.length)this.filteredTransactions=[],this.chartData=[{amount:1,id:0,parent_id:0,parent_name:"No data",name:"No data",selected:!1,disabled:!0,color:g("#dadada"),tooltip:"No data"}];else{this.filteredTransactions=t;const r=[];t.flatMap(s=>s.transaction_items).forEach(s=>{if(!s.category)return;const i={};this.getDistinctParentIds().forEach((h,b)=>{this.chart?i[h]=this.chart.colors.getIndex(b):i[h]=g("#000000")});let a;this.selectedParentId&&s.category.parent_id===this.selectedParentId?a=s.category:a=s.category.parent_id?s.category.parent:s.category;let l=r.findIndex(h=>h.id===a.id);l===-1&&(r.push({amount:0,id:a.id,parent_id:a.parent_id,parent_name:a.parent_id?a.parent.name:a.name,name:a.parent_id===this.selectedParentId?a.full_name:a.name,selected:a.parent_id===this.selectedParentId,color:i[a.id]||i[a.parent_id]}),l=r.length-1),r[l].amount+=s.amount_in_base}),r.sort((s,i)=>s.parent_name.localeCompare(i.parent_name)),this.chartData=r.map(s=>({...s,tooltip:`${s.name}: ${P(s.amount,window.YAFFA.locale,window.YAFFA.baseCurrency)}`}))}this.chart&&(this.chart.data=this.chartData)},getDistinctParentIds(){return this.filteredTransactions.flatMap(e=>e.transaction_items).filter(e=>e.category).map(e=>e.category.parent_id).filter((e,t,r)=>r.indexOf(e)===t)}},mounted(){let e=k(this.$refs.chartContainer,Y);e.data=null;let t=e.series.push(new B);t.dataFields.value="amount",t.dataFields.category="name",t.slices.template.propertyFields.fill="color",t.slices.template.propertyFields.isActive="selected",t.labels.template.propertyFields.disabled="disabled",t.ticks.template.propertyFields.disabled="disabled",t.slices.template.tooltipText="{tooltip}",t.slices.template.events.on("hit",s=>{const i=s.target.dataItem.dataContext;this.selectedParentId=i.id,this.updateChartData(this.transactions)});let r=e.titles.create();r.text=this.title,r.fontSize=20,r.marginBottom=20,this.chart=e},beforeDestroy(){this.chart&&this.chart.dispose()}},Ye={class:"container"},Be={class:"loader"},Me={class:"chartContainer",ref:"chartContainer"};function Ue(e,t,r,s,i,a){return d(),c("div",Ye,[F(n("div",Be,null,512),[[C,r.busy]]),F(n("div",Me,null,512),[[C,!r.busy]])])}const Ee=f($e,[["render",Ue],["__scopeId","data-v-d14ebcdc"]]),qe={name:"ReportingCanvasFindTransactionsCategoryDetails",components:{"reporting-withdrawals-by-parent-category":Ie,"reporting-deposits-by-parent-category":Ee},props:{transactions:{type:Array,required:!1,default:()=>[]},busy:{type:Boolean,required:!0}},data(){return{}},methods:{__:function(e,t){return _(e,t)}},mounted(){}},Le={class:"row mb-5 mt-5"},Ve={class:"col-12"},Oe={class:"row mb-5 mt-5"},Ne={class:"col-12"};function je(e,t,r,s,i,a){const l=y("reporting-withdrawals-by-parent-category"),h=y("reporting-deposits-by-parent-category");return d(),c("div",null,[n("div",Le,[n("div",Ve,[p(l,{transactions:r.transactions,busy:r.busy},null,8,["transactions","busy"])])]),n("div",Oe,[n("div",Ne,[p(h,{transactions:r.transactions,busy:r.busy},null,8,["transactions","busy"])])])])}const We=f(qe,[["render",je]]),ze={name:"ReportingCanvasFindTransactionsSummary",props:{transactions:{type:Array,required:!1,default:()=>[]},busy:{type:Boolean,required:!0}},data(){return{baseCurrency:window.YAFFA.baseCurrency,locale:window.YAFFA.locale}},computed:{withdrawalSummary(){const e=[],t=[];let r=0;return this.transactions.filter(s=>s.transaction_type_id===1).forEach(s=>{if(!t.includes(s.currency_id))t.push(s.currency_id),e.push({currency_id:s.currency_id,currency_name:s.transaction_currency.name,currency:s.transaction_currency,count:1,sum:s.cashflow_value,sum_base:s.cashflow_value*s.currencyRateToBase});else{const i=e.findIndex(a=>a.currency_id===s.currency_id);e[i].count++,e[i].sum+=s.cashflow_value,e[i].sum_base+=s.cashflow_value*s.currencyRateToBase}r+=s.cashflow_value*s.currencyRateToBase}),e.unshift({currency_id:0,currency_name:"All withdrawals in "+this.baseCurrency.name,currency:this.baseCurrency,count:this.countWithdrawals,sum:r,sum_base:r}),e},countWithdrawals(){return this.transactions.filter(e=>e.transaction_type_id===1).length},depositSummary(){const e=[],t=[];let r=0;return this.transactions.filter(s=>s.transaction_type_id===2).forEach(s=>{if(!t.includes(s.currency_id))t.push(s.currency_id),e.push({currency_id:s.currency_id,currency_name:s.transaction_currency.name,currency:s.transaction_currency,count:1,sum:s.cashflow_value,sum_base:s.cashflow_value*s.currencyRateToBase});else{const i=e.findIndex(a=>a.currency_id===s.currency_id);e[i].count++,e[i].sum+=s.cashflow_value,e[i].sum_base+=s.cashflow_value*s.currencyRateToBase}r+=s.cashflow_value*s.currencyRateToBase}),e.unshift({currency_id:0,currency_name:"All deposits in "+this.baseCurrency.name,currency:this.baseCurrency,count:this.countDeposits,sum:r,sum_base:r}),e},countDeposits(){return this.transactions.filter(e=>e.transaction_type_id===2).length},countTransfers(){return this.transactions.filter(e=>e.transaction_type_id===3).length},countInvestments(){return this.transactions.filter(e=>e.transaction_type.type==="investment").length},minDate(){return this.transactions.length?this.transactions.reduce((e,t)=>e<t.date?e:t.date,this.transactions[0].date):null},minDateFormatted(){return!this.minDate||!this.minDate.toLocaleDateString?null:this.minDate.toLocaleDateString(window.YAFFA.locale)},maxDate(){return this.transactions.length?this.transactions.reduce((e,t)=>e>t.date?e:t.date,this.transactions[0].date):null},maxDateFormatted(){return!this.maxDate||!this.maxDate.toLocaleDateString?null:this.maxDate.toLocaleDateString(window.YAFFA.locale)}},methods:{__:function(e,t){return _(e,t)},toFormattedCurrency:P},mounted(){}},Qe={key:0,class:"list-group list-group-flush"},Xe={key:1,class:"row"},He={class:"col-12"},Ge=["innerHTML"],Je={class:"table table-borderless table-striped"},Ke={colspan:"2"},Ze={key:0,colspan:"2"},et={key:1},tt={key:2},at={key:0},st={key:0,colspan:"2"},rt={key:1},nt={key:2},it={key:0},lt={class:"table-info"},ot={colspan:"2"},ct={class:"table-info"},dt={colspan:"2"};function ut(e,t,r,s,i,a){return d(),c("div",null,[n("h2",null,o(a.__("Summary of the filtered transactions")),1),r.busy?(d(),c("ul",Qe,[(d(),c(D,null,T(5,l=>n("li",{"aria-hidden":"true",class:"list-group-item placeholder-glow",key:l},[...t[0]||(t[0]=[n("span",{class:"placeholder col-12"},null,-1)])])),64))])):(d(),c("div",Xe,[n("div",He,[n("p",{innerHTML:a.__("Your search returned <strong>:total</strong> transactions in total",{total:r.transactions.length})},null,8,Ge),n("p",null,o(a.__("The earliest transaction is from :date",{date:a.minDateFormatted}))+" "+o(a.__("The latest transaction is from :date",{date:a.maxDateFormatted})),1),n("table",Je,[n("thead",null,[n("tr",null,[n("th",Ke,o(a.__("Type")),1),n("th",null,o(a.__("Transaction count")),1),n("th",null,o(a.__("Transaction value")),1)])]),n("tbody",null,[(d(!0),c(D,null,T(a.withdrawalSummary,l=>(d(),c("tr",{key:l.currency_id,class:A({"table-info":l.currency_id===0})},[l.currency_id===0?(d(),c("td",Ze,o(l.currency_name),1)):m("",!0),l.currency_id!==0?(d(),c("td",et)):m("",!0),l.currency_id!==0?(d(),c("td",tt,o(l.currency_name),1)):m("",!0),n("td",null,o(l.count),1),n("td",null,[R(o(a.toFormattedCurrency(l.sum,this.locale,l.currency))+" ",1),l.currency_id!==0&&l.currency_id!==this.baseCurrency.id?(d(),c("span",at," ("+o(a.toFormattedCurrency(l.sum_base,this.locale,this.baseCurrency))+") ",1)):m("",!0)])],2))),128)),(d(!0),c(D,null,T(a.depositSummary,l=>(d(),c("tr",{key:l.currency_id,class:A({"table-info":l.currency_id===0})},[l.currency_id===0?(d(),c("td",st,o(l.currency_name),1)):m("",!0),l.currency_id!==0?(d(),c("td",rt)):m("",!0),l.currency_id!==0?(d(),c("td",nt,o(l.currency_name),1)):m("",!0),n("td",null,o(l.count),1),n("td",null,[R(o(a.toFormattedCurrency(l.sum,this.locale,l.currency))+" ",1),l.currency_id!==0&&l.currency_id!==this.baseCurrency.id?(d(),c("span",it," ("+o(a.toFormattedCurrency(l.sum_base,this.locale,this.baseCurrency))+") ",1)):m("",!0)])],2))),128)),n("tr",lt,[n("td",ot,o(a.__("Transfers")),1),n("td",null,o(a.countTransfers),1),t[1]||(t[1]=n("td",null,null,-1))]),n("tr",ct,[n("td",dt,o(a.__("Investment transactions")),1),n("td",null,o(a.countInvestments),1),t[2]||(t[2]=n("td",null,null,-1))])])])])]))])}const ht=f(ze,[["render",ut]]);S(x);const _t={name:"MonthlyTimeline",props:{transactions:{type:Array,required:!1,default:()=>[]},title:{type:String,default:"Monthly spending and income"},busy:{type:Boolean,required:!0}},data(){return{filteredTransactions:[],chartData:{},locale:window.YAFFA.locale,baseCurrency:window.YAFFA.baseCurrency}},watch:{transactions:{handler(e){this.updateChartData(e)},immediate:!0,deep:!0}},methods:{updateChartData(e){const t=[];if(e.forEach(r=>{(r.transaction_type_id===2||r.transaction_type_id===1)&&t.push(r)}),!t.length)this.filteredTransactions=[],this.chartData=[];else{this.filteredTransactions=t;const r=[],s={};t.forEach(i=>{const a=new Date(i.date),l=a.getFullYear()*100+a.getMonth()+1;s[l]||(s[l]={month:l,date:new Date(a.getFullYear(),a.getMonth(),1),deposits:0,withdrawals:0,cashFlow:0}),i.transaction_type_id===2?s[l].deposits+=i.cashflow_value*i.currencyRateToBase:i.transaction_type_id===1&&(s[l].withdrawals+=i.cashflow_value*i.currencyRateToBase)}),Object.values(s).forEach(i=>{r.push({month:i.month,date:i.date,deposits:i.deposits,withdrawals:i.withdrawals,cashFlow:i.deposits+i.withdrawals})}),this.chartData=r}this.chart&&(this.chart.data=this.chartData)},getDistinctParentIds(){return this.filteredTransactions.flatMap(e=>e.transaction_items).filter(e=>e.category).map(e=>e.category.parent_id).filter((e,t,r)=>r.indexOf(e)===t)}},mounted(){let e=k(this.$refs.chartContainer,Q);e.data=null,e.numberFormatter.intlLocales=this.locale,e.numberFormatter.numberFormat={style:"currency",currency:this.baseCurrency.iso_code,minimumFractionDigits:0};let t=e.xAxes.push(new X);t.renderer.minGridDistance=50,e.yAxes.push(new H);let r=e.series.push(new I);r.dataFields.valueY="deposits",r.dataFields.dateX="date",r.name="Deposits",r.tooltipText="{name}: [bold]{valueY}[/]",r.columns.template.fill=g("green"),r.strokeOpacity=0,r.clustered=!1;let s=e.series.push(new I);s.dataFields.valueY="withdrawals",s.dataFields.dateX="date",s.name="Withdrawals",s.tooltipText="{name}: [bold]{valueY}[/]",s.columns.template.fill=g("red"),s.strokeOpacity=0,s.clustered=!1;let i=e.series.push(new G);i.dataFields.valueY="cashFlow",i.dataFields.dateX="date",i.name="Monthly cash flow",i.tooltipText="{name}: [bold]{valueY}[/]";let a=i.bullets.push(new J);a.circle.fill=g("#fff"),a.circle.strokeWidth=2,e.cursor=new K;let l=e.titles.create();l.text=this.title,l.fontSize=20,l.marginBottom=20,this.chart=e},beforeDestroy(){this.chart&&this.chart.dispose()}},pt={key:0,class:"list-group list-group-flush"},mt={class:"chartContainer",ref:"chartContainer"};function yt(e,t,r,s,i,a){return d(),c("div",null,[r.busy?(d(),c("ul",pt,[(d(),c(D,null,T(5,l=>n("li",{"aria-hidden":"true",class:"list-group-item placeholder-glow",key:l},[...t[0]||(t[0]=[n("span",{class:"placeholder placeholder-lg col-12"},null,-1)])])),64))])):m("",!0),F(n("div",mt,null,512),[[C,!r.busy]])])}const ft=f(_t,[["render",yt],["__scopeId","data-v-96048919"]]),gt={name:"ReportingCanvasFindTransactionsTimeline",components:{"monthly-timeline":ft},props:{transactions:{type:Array,required:!1,default:()=>[]},busy:{type:Boolean,required:!0}},methods:{__:function(e,t){return _(e,t)}},mounted(){}},bt={class:"row mb-3"},wt={class:"col-12"};function vt(e,t,r,s,i,a){const l=y("monthly-timeline");return d(),c("div",bt,[n("div",wt,[p(l,{transactions:r.transactions,busy:r.busy},null,8,["transactions","busy"])])])}const Dt=f(gt,[["render",vt]]),Tt={name:"FindTransactions",components:{"find-transaction-select-card":oe,"transaction-show-modal":Z,"date-range-selector":Pe,"reporting-canvas-categories":We,"reporting-canvas-summary":ht,"reporting-canvas-timeline":Dt},data(){const e=new URLSearchParams(window.location.search);return{busy:!1,ready:!1,dataTable:null,dateFrom:e.get("date_from")||null,dateTo:e.get("date_to")||null,selectedAccounts:this.getUrlParams("accounts"),selectedCategories:this.getUrlParams("categories"),selectedPayees:this.getUrlParams("payees"),selectedTags:this.getUrlParams("tags"),presetsReady:{category:!1,payee:!1,account:!1,tag:!1},transactions:[]}},methods:{setReadyFlag(e){this.presetsReady[e]=!0,this.ready=Object.values(this.presetsReady).every(t=>t===!0)},onUpdateDateRange(e){this.dateFrom=e.dateFrom,this.dateTo=e.dateTo,this.rebuildUrl()},onUpdateCategory(e){this.selectedCategories=e,this.rebuildUrl()},onUpdatePayee(e){this.selectedPayees=e,this.rebuildUrl()},onUpdateAccount(e){this.selectedAccounts=e,this.rebuildUrl()},onUpdateTag(e){this.selectedTags=e,this.rebuildUrl()},rebuildUrl(){let e=[];this.dateFrom&&e.push("date_from="+this.dateFrom),this.dateTo&&e.push("date_to="+this.dateTo);const t=this.selectedAccounts.map(a=>"accounts[]="+a);e.push(...t);const r=this.selectedCategories.map(a=>"categories[]="+a);e.push(...r);const s=this.selectedPayees.map(a=>"payees[]="+a);e.push(...s);const i=this.selectedTags.map(a=>"tags[]="+a);e.push(...i),window.history.pushState("","",window.location.origin+window.location.pathname+"?"+e.join("&"))},getTransactions(){this.busy=!0,window.axios.get("/api/transactions",{params:{date_from:this.dateFrom,date_to:this.dateTo,accounts:this.selectedAccounts,categories:this.selectedCategories,payees:this.selectedPayees,tags:this.selectedTags}}).then(e=>{this.transactions=e.data.data.map(O)}).then(()=>{this.dataTable.clear(),this.dataTable.rows.add(this.transactions),this.dataTable.draw()}).catch(e=>{let t=new CustomEvent("toast",{detail:{header:_("Error"),body:_("Error getting transactions: :error",{error:e}),toastClass:"bg-danger"}});window.dispatchEvent(t)}).finally(()=>{this.busy=!1})},getUrlParams(e){const t=new URLSearchParams(window.location.search),r=new RegExp(`^${e}\\[(\\d)?\\]$`);let s=[];return t.forEach((i,a)=>{r.test(a)&&s.push(i)}),s},__:_},watch:{ready:function(e){e&&this.getTransactions()},busy:function(e){this.dataTable&&this.dataTable.processing(e)}},mounted(){this.dataTable=$(this.$refs.dataTable).DataTable({data:this.transactions,processing:!0,columns:[w.dateFromCustomField("date",_("Date"),window.YAFFA.locale),w.type,{title:_("From"),defaultContent:"",data:"config.account_from.name"},{title:_("To"),defaultContent:"",data:"config.account_to.name"},w.category,w.amount,w.extra,{data:"id",defaultContent:"",title:_("Actions"),render:function(e,t){return v(e,"quickView")+v(e,"show")+v(e,"edit")+v(e,"clone")+v(e,"delete")},className:"dt-nowrap",orderable:!1,searchable:!1}],order:[[0,"asc"]]}),N(this.$refs.dataTable),j(this.$refs.dataTable),this.ready=!0}},Ft={class:"row"},Ct={class:"col-sm-3"},Pt={class:"card mb-3"},St={class:"card-header"},xt={class:"card-title"},kt={class:"list-group list-group-flush"},At={class:"list-group-item d-flex justify-content-between align-items-center"},Rt=["disabled"],It={class:"col-sm-9"},$t={class:"card"},Yt={class:"card-header"},Bt={class:"nav nav-tabs card-header-tabs"},Mt={class:"nav-item"},Ut={class:"nav-link active",id:"nav-summary","data-coreui-toggle":"tab","data-coreui-target":"#tab-summary",type:"button",role:"tab","aria-controls":"tab-summary","aria-selected":"true"},Et={class:"nav-item"},qt={class:"nav-link",id:"nav-transaction-list","data-coreui-toggle":"tab","data-coreui-target":"#tab-transaction-list",type:"button",role:"tab","aria-controls":"tab-transaction-list","aria-selected":"false"},Lt={class:"nav-item"},Vt={class:"nav-link",id:"nav-timeline-charts","data-coreui-toggle":"tab","data-coreui-target":"#tab-timeline-charts",type:"button",role:"tab","aria-controls":"tab-timeline-charts","aria-selected":"false"},Ot={class:"nav-item"},Nt={class:"nav-link",id:"nav-category-charts","data-coreui-toggle":"tab","data-coreui-target":"#tab-category-charts",type:"button",role:"tab","aria-controls":"tab-category-charts","aria-selected":"false"},jt={class:"card-body"},Wt={class:"tab-content"},zt={class:"tab-pane fade show active",id:"tab-summary",role:"tabpanel","aria-labelledby":"nav-summary",tabindex:"0"},Qt={class:"tab-pane fade",id:"tab-transaction-list",role:"tabpanel","aria-labelledby":"nav-transaction-list",tabindex:"1"},Xt={class:"table table-bordered table-hover no-footer",ref:"dataTable"},Ht={class:"tab-pane fade",id:"tab-timeline-charts",role:"tabpanel","aria-labelledby":"nav-timeline-charts",tabindex:"3"},Gt={class:"tab-pane fade",id:"tab-category-charts",role:"tabpanel","aria-labelledby":"nav-category-charts",tabindex:"4"};function Jt(e,t,r,s,i,a){const l=y("date-range-selector"),h=y("find-transaction-select-card"),b=y("reporting-canvas-summary"),U=y("reporting-canvas-timeline"),E=y("reporting-canvas-categories"),q=y("transaction-show-modal");return d(),c("div",Ft,[n("div",Ct,[n("div",Pt,[n("div",St,[n("div",xt,o(a.__("Actions")),1)]),n("ul",kt,[n("li",At,[n("span",null,o(a.__("Update")),1),n("button",{name:"reload",type:"button",class:"btn btn-sm btn-primary",disabled:i.busy||!i.ready,onClick:t[0]||(t[0]=(...u)=>a.getTransactions&&a.getTransactions(...u))},[...t[9]||(t[9]=[n("i",{class:"fas fa-sync-alt"},null,-1)])],8,Rt)])])]),p(l,{"initial-date-from":i.dateFrom,"initial-date-to":i.dateTo,onUpdate:a.onUpdateDateRange},null,8,["initial-date-from","initial-date-to","onUpdate"]),p(h,{property:"category",title:"Category",placeholder:"Select category","search-api-path":"/api/assets/category",search_label_field:"text","details-api-path":"/api/assets/category/#id#","details-label-field":"full_name","preset-item-ids":i.selectedCategories,onUpdate:t[1]||(t[1]=u=>a.onUpdateCategory(u)),onPresetReady:t[2]||(t[2]=u=>a.setReadyFlag(u))},null,8,["preset-item-ids"]),p(h,{"search-api-path":"/api/assets/payee",property:"payee",title:"Payee",placeholder:"Select payee","details-api-path":"/api/assets/payee/#id#","preset-item-ids":i.selectedPayees,onUpdate:t[3]||(t[3]=u=>a.onUpdatePayee(u)),onPresetReady:t[4]||(t[4]=u=>a.setReadyFlag(u))},null,8,["preset-item-ids"]),p(h,{"search-api-path":"/api/assets/account",property:"account",title:"Account",placeholder:"Select account","details-api-path":"/api/assets/account/#id#","preset-item-ids":i.selectedAccounts,onUpdate:t[5]||(t[5]=u=>a.onUpdateAccount(u)),onPresetReady:t[6]||(t[6]=u=>a.setReadyFlag(u))},null,8,["preset-item-ids"]),p(h,{"search-api-path":"/api/assets/tag",search_label_field:"text",property:"tag",title:"Tag",placeholder:"Select tag","details-api-path":"/api/assets/tag/#id#","preset-item-ids":i.selectedTags,onUpdate:t[7]||(t[7]=u=>a.onUpdateTag(u)),onPresetReady:t[8]||(t[8]=u=>a.setReadyFlag(u))},null,8,["preset-item-ids"])]),n("div",It,[n("div",$t,[n("div",Yt,[n("ul",Bt,[n("li",Mt,[n("button",Ut,o(a.__("Summary")),1)]),n("li",Et,[n("button",qt,o(a.__("List of transactions")),1)]),n("li",Lt,[n("button",Vt,o(a.__("Timeline charts")),1)]),n("li",Ot,[n("button",Nt,o(a.__("Category charts")),1)])])]),n("div",jt,[n("div",Wt,[n("div",zt,[p(b,{transactions:i.transactions,busy:i.busy},null,8,["transactions","busy"])]),n("div",Qt,[n("table",Xt,null,512)]),n("div",Ht,[p(U,{transactions:i.transactions,busy:i.busy},null,8,["transactions","busy"])]),n("div",Gt,[p(E,{transactions:i.transactions,busy:i.busy},null,8,["transactions","busy"])])])])])]),p(q)])}const Kt=f(Tt,[["render",Jt]]),M=L({});M.component("find-transactions",Kt);M.mount("#app");
