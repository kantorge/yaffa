import{b as h,o as l,d as c,e as r,g as b,t as d,q as x,w as R,p as C,n as D,F as g,r as p,f,h as m,k as _,c as P}from"./app.ffd9927a.js";import{t as E,_ as y}from"./helpers.35739ffe.js";import"./dataTables.bootstrap5.509daac4.js";import{t as A,a as S}from"./dataTableHelper.1c2d9edf.js";import{S as M}from"./sweetalert2.esm.all.dd009341.js";import{u as q,t as L,c as B,X as U,D as N,V as O,N as I,L as Y,B as j,R as V,a as z,b as X}from"./animated.085da57c.js";import{D as W}from"./DateRangePicker.73854680.js";import G from"./presetDates.0fa38c6c.js";import"./tslib.es6.598c7c7a.js";import"./Datepicker.86824658.js";const J={name:"CurrencyRateOverview",props:{from:{type:Object,required:!0},to:{type:Object,required:!0},currencyRates:{type:Array,required:!0}},data(){return{locale:window.YAFFA.locale}},methods:{formatDate(e){return e=new Date(e),e.toLocaleDateString(this.locale)},toFormattedCurrency:E,__:y}},Q={class:"card mb-3"},H={class:"card-header"},K={class:"card-title collapse-control","data-coreui-toggle":"collapse","data-coreui-target":"#cardOverview"},Z={class:"collapse card-body show","aria-expanded":"true",id:"cardOverview"},ee={class:"row mb-0"},te={class:"col-6"},ae={class:"col-6"},se={class:"col-6"},re={class:"col-6"},ie={class:"col-6"},ne={class:"col-6"},oe={class:"col-6"},de={key:0,class:"col-6"},le={key:1,class:"col-6 text-italic text-muted"},ce={class:"col-6"},ue={key:2,class:"col-6"},he={key:3,class:"col-6 text-italic text-muted"},me={class:"col-6"},_e={key:4,class:"col-6"},ye={key:5,class:"col-6 text-italic text-muted"};function fe(e,a,i,n,s,t){return l(),c("div",Q,[r("div",H,[r("div",K,[a[0]||(a[0]=r("i",{class:"fa fa-angle-down"},null,-1)),b(" "+d(t.__("Overview")),1)])]),r("div",Z,[r("dl",ee,[r("dt",te,d(t.__("From")),1),r("dd",ae,d(i.from.name),1),r("dt",se,d(t.__("To")),1),r("dd",re,d(i.to.name),1),r("dt",ie,d(t.__("Number of records")),1),r("dd",ne,d(i.currencyRates.length),1),r("dt",oe,d(t.__("First available data")),1),i.currencyRates.length>0?(l(),c("dd",de,d(t.formatDate(i.currencyRates[0].date)),1)):(l(),c("dd",le,d(t.__("No data")),1)),r("dt",ce,d(t.__("Last available data")),1),i.currencyRates.length>0?(l(),c("dd",ue,d(t.formatDate(i.currencyRates[i.currencyRates.length-1].date)),1)):(l(),c("dd",he,d(t.__("No data")),1)),r("dt",me,d(t.__("Last known rate")),1),i.currencyRates.length>0?(l(),c("dd",_e,d(t.toFormattedCurrency(1,s.locale,i.from))+" = "+d(t.toFormattedCurrency(i.currencyRates[i.currencyRates.length-1].rate,s.locale,i.to)),1)):(l(),c("dd",ye,d(t.__("No data")),1))])])])}const be=h(J,[["render",fe]]),ge={name:"CurrencyRateActions",props:{fromCurrency:{type:Object,required:!0},dateFrom:{type:String,default:null},dateTo:{type:String,default:null}},emits:["add-rate","rates-loaded"],data(){return{isLoadingMissing:!1}},methods:{addNewRate(){this.$emit("add-rate")},async loadMissingRates(){var a,i;if(this.isLoadingMissing)return;this.isLoadingMissing=!0;const e=new CustomEvent("toast",{detail:{body:this.__("Loading missing rates..."),toastClass:"bg-info toast-loading-missing-rates",delay:1/0}});window.dispatchEvent(e);try{await window.axios.get(window.route("api.currency-rate.retrieveMissing",{currency:this.fromCurrency.id}));const n=new CustomEvent("toast",{detail:{header:this.__("Success"),body:this.__("Missing rates loaded successfully"),toastClass:"bg-success"}});window.dispatchEvent(n),this.$emit("rates-loaded")}catch(n){const s=new CustomEvent("toast",{detail:{header:this.__("Error"),body:((i=(a=n.response)==null?void 0:a.data)==null?void 0:i.message)||this.__("Failed to load missing rates"),toastClass:"bg-danger"}});window.dispatchEvent(s)}finally{this.isLoadingMissing=!1,setTimeout(()=>{const n=document.querySelectorAll(".toast-loading-missing-rates");n.length>0&&n.forEach(s=>{new window.bootstrap.Toast(s).dispose()})},250)}},__:y}},pe={class:"card mb-3"},we={class:"card-header"},ve={class:"card-title collapse-control","data-coreui-toggle":"collapse","data-coreui-target":"#cardActions"},Re={class:"list-group list-group-flush collapse show","aria-expanded":"true",id:"cardActions"},Ce={class:"list-group-item d-flex justify-content-between align-items-center"},De=["title"],Fe=["title"],ke={class:"list-group-item d-flex justify-content-between align-items-center"},Te=["title","disabled"],xe=["title","disabled"],Pe={key:0,class:"fa fa-fw fa-spinner fa-spin"},Ee={key:1,class:"fa fa-fw fa-cloud-download"};function Ae(e,a,i,n,s,t){return l(),c("div",pe,[r("div",we,[r("div",ve,[a[4]||(a[4]=r("i",{class:"fa fa-angle-down"},null,-1)),b(" "+d(t.__("Actions")),1)])]),r("ul",Re,[r("li",Ce,[r("button",{class:"btn btn-link text-decoration-none p-0 add-currency-rate-button",onClick:a[0]||(a[0]=(...o)=>t.addNewRate&&t.addNewRate(...o)),title:t.__("Add new rate")},d(t.__("Add new rate")),9,De),r("button",{class:"btn btn-xs btn-primary add-currency-rate-button",onClick:a[1]||(a[1]=(...o)=>t.addNewRate&&t.addNewRate(...o)),title:t.__("Add new rate")},[...a[5]||(a[5]=[r("span",{class:"fa fa-fw fa-plus"},null,-1)])],8,Fe)]),r("li",ke,[r("button",{class:"btn btn-link text-decoration-none p-0",onClick:a[2]||(a[2]=(...o)=>t.loadMissingRates&&t.loadMissingRates(...o)),title:t.__("Load missing rates"),disabled:s.isLoadingMissing},d(t.__("Load missing rates")),9,Te),r("button",{class:"btn btn-xs btn-success",onClick:a[3]||(a[3]=(...o)=>t.loadMissingRates&&t.loadMissingRates(...o)),title:t.__("Load missing rates"),disabled:s.isLoadingMissing},[s.isLoadingMissing?(l(),c("span",Pe)):(l(),c("span",Ee))],8,xe)])])])}const Se=h(ge,[["render",Ae]]),Me={name:"CurrencyRateTable",props:{currencyRates:{type:Array,required:!0},fromCurrency:{type:Object,required:!0},toCurrency:{type:Object,required:!0},filteredRates:{type:Array,default:null}},emits:["edit-rate","delete-rate","data-updated"],data(){return{table:null}},watch:{filteredRates:{handler(e){this.table&&(this.table.clear(),e?this.table.rows.add(e):this.table.rows.add(this.currencyRates),this.table.draw())},deep:!0}},mounted(){this.initializeTable()},beforeUnmount(){this.table&&this.table.destroy()},methods:{initializeTable(){const e=this;this.table=$("#ratesTable").DataTable({data:this.currencyRates,columns:[A.dateFromCustomField("date",this.__("Date"),window.YAFFA.locale),{data:"rate",title:this.__("Rate"),render:function(a,i){return S(i,a,window.YAFFA.locale,Object.assign({},e.toCurrency,{max_digits:4}))}},{data:"id",title:this.__("Actions"),render:function(a,i,n,s){return`
                                <button class="btn btn-xs btn-primary edit-rate" data-id="${a}" title="${e.__("Edit")}">
                                    <span class="fa fa-edit"></span>
                                </button>
                                <button class="btn btn-xs btn-danger delete-rate" data-id="${a}" title="${e.__("Delete")}">
                                    <span class="fa fa-trash"></span>
                                </button>
                            `},className:"dt-nowrap",orderable:!1,searchable:!1}],order:[[0,"desc"]],deferRender:!0,scrollY:"500px",scrollCollapse:!0,stateSave:!1,processing:!0,paging:!1,info:!1}),$("#ratesTable").on("click",".edit-rate",function(){const a=$(this).data("id"),i=e.currencyRates.find(n=>n.id===a);i&&e.$emit("edit-rate",i)}),$("#ratesTable").on("click",".delete-rate",function(){const a=$(this).data("id"),i=e.currencyRates.find(n=>n.id===a);i&&e.confirmDelete(i)})},confirmDelete(e){M.fire({animation:!1,text:this.__("Are you sure to want to delete this item?"),icon:"warning",showCancelButton:!0,cancelButtonText:this.__("Cancel"),confirmButtonText:this.__("Confirm"),buttonsStyling:!1,customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-outline-secondary ms-3"}}).then(a=>{a.isConfirmed&&this.deleteRate(e)})},async deleteRate(e){var i,n;const a=new CustomEvent("toast",{detail:{body:this.__("Deleting rate..."),toastClass:`bg-info toast-rate-${e.id}`,delay:1/0}});window.dispatchEvent(a);try{await window.axios.delete(window.route("api.currency-rate.destroy",{currency_rate:e.id}));const s=new CustomEvent("toast",{detail:{header:this.__("Success"),body:this.__("Currency rate deleted"),toastClass:"bg-success"}});window.dispatchEvent(s),this.$emit("delete-rate",e.id)}catch(s){const t=new CustomEvent("toast",{detail:{header:this.__("Error"),body:((n=(i=s.response)==null?void 0:i.data)==null?void 0:n.message)||this.__("Failed to delete rate"),toastClass:"bg-danger"}});window.dispatchEvent(t)}finally{setTimeout(()=>{const s=document.querySelector(`.toast-rate-${e.id}`);s&&new window.bootstrap.Toast(s).dispose()},250)}},updateTableData(e){this.table&&(this.table.clear(),this.table.rows.add(e),this.table.draw())},__:y}},qe={class:"card"},Le={class:"card-header"},Be={class:"card-title"};function Ue(e,a,i,n,s,t){return l(),c("div",qe,[r("div",Le,[r("div",Be,d(t.__("Currency rate values")),1)]),a[0]||(a[0]=r("div",{class:"card-body no-datatable-search"},[r("table",{class:"table table-bordered table-hover",role:"grid",id:"ratesTable"})],-1))])}const Ne=h(Me,[["render",Ue]]),Oe={name:"CurrencyRateChart",props:{currencyRates:{type:Array,required:!0},toCurrency:{type:Object,required:!0},locale:{type:String,default:()=>window.YAFFA?window.YAFFA.locale:navigator.language}},computed:{hasData(){return this.currencyRates&&this.currencyRates.length>0}},watch:{currencyRates:{handler(e){e&&e.length>0?this.chart?this.chart.data=e:this.$nextTick(()=>{this.initializeChart()}):this.chart&&(this.chart.dispose(),this.chart=null)},deep:!0}},mounted(){!this.hasData||this.initializeChart()},beforeUnmount(){this.chart&&this.chart.dispose()},methods:{initializeChart(){q(L);const e=B(this.$refs.chartRate,U);e.data=this.currencyRates,e.dateFormatter.inputDateFormat="yyyy-MM-dd";const a=e.xAxes.push(new N);a.dataFields.category="date";const i=e.yAxes.push(new O),n=new Intl.NumberFormat(this.locale,{style:"currency",currency:this.toCurrency.iso_code,currencyDisplay:"narrowSymbol",minimumFractionDigits:0,maximumFractionDigits:4});i.numberFormatter=new I,i.numberFormatter.numberFormat="#,###.####",i.numberFormatter.format.bind(i.numberFormatter),i.numberFormatter.format=function(w){return n.format(w)};const s=e.series.push(new Y);s.dataFields.valueY="rate",s.dataFields.dateX="date",s.strokeWidth=3;const o=s.bullets.push(new j).createChild(V);o.width=5,o.height=5,o.horizontalCenter="middle",o.verticalCenter="middle";const u=new z;u.series.push(s),e.scrollbarX=u,e.cursor=new X,e.cursor.behavior="zoomX",e.cursor.xAxis=a,this.chart=e},updateChart(e){this.chart&&e&&e.length>0&&(this.chart.data=e)},__:y}},Ie={class:"card"},Ye={class:"card-body"},$e={key:0},je={ref:"chartRate",style:{width:"100%",height:"500px"}},Ve={key:1},ze={class:"text-center text-muted"};function Xe(e,a,i,n,s,t){return l(),c("div",Ie,[r("div",Ye,[t.hasData?(l(),c("div",$e,[r("div",je,null,512)])):(l(),c("div",Ve,[r("div",ze,d(t.__("No data available")),1)]))])])}const We=h(Oe,[["render",Xe]]),Ge={name:"CurrencyRateModal",props:{fromCurrency:{type:Object,required:!0},toCurrency:{type:Object,required:!0},editRate:{type:Object,default:null}},emits:["saved","close"],data(){return{formData:{date:"",rate:null},errors:{},isSubmitting:!1,modal:null}},computed:{isEditMode(){return this.editRate!==null}},watch:{editRate:{immediate:!0,handler(e){e?(this.formData.date=e.date,this.formData.rate=e.rate):this.resetForm()}}},mounted(){const e=document.getElementById("currencyRateModal");window.coreui&&window.coreui.Modal?this.modal=new window.coreui.Modal(e):this.modal=new window.bootstrap.Modal(e),e.addEventListener("hidden.bs.modal",()=>{this.resetForm(),this.$emit("close")}),e.addEventListener("hidden.coreui.modal",()=>{this.resetForm(),this.$emit("close")})},methods:{show(){this.modal.show()},hide(){this.modal.hide()},resetForm(){this.formData={date:"",rate:null},this.errors={}},async submitForm(){var a,i;if(this.isSubmitting)return;this.errors={},this.isSubmitting=!0;const e={from_id:this.fromCurrency.id,to_id:this.toCurrency.id,date:this.formData.date,rate:this.formData.rate};try{let n;this.isEditMode?n=await window.axios.put(window.route("api.currency-rate.update",{currency_rate:this.editRate.id}),e):n=await window.axios.post(window.route("api.currency-rate.store"),e),this.$emit("saved",n.data.rate,n.data.message),this.hide()}catch(n){if(n.response&&n.response.status===422)this.errors=n.response.data.errors;else{const s=new CustomEvent("toast",{detail:{header:this.__("Error"),body:((i=(a=n.response)==null?void 0:a.data)==null?void 0:i.message)||this.__("An error occurred"),toastClass:"bg-danger"}});window.dispatchEvent(s)}}finally{this.isSubmitting=!1}},__:y}},Je={class:"modal fade",id:"currencyRateModal",tabindex:"-1"},Qe={class:"modal-dialog"},He={class:"modal-content"},Ke={class:"modal-header"},Ze={class:"modal-title"},et={class:"modal-body"},tt={class:"mb-3"},at={for:"rateDate",class:"form-label"},st={key:0,class:"invalid-feedback"},rt={key:0},it={key:1},nt={class:"mb-3"},ot={for:"rateValue",class:"form-label"},dt={class:"text-muted"},lt={key:0,class:"invalid-feedback"},ct={key:0},ut={key:1},ht={class:"modal-footer"},mt={type:"button",class:"btn btn-secondary","data-coreui-dismiss":"modal"},_t=["disabled"],yt={key:0,class:"spinner-border spinner-border-sm me-1"};function ft(e,a,i,n,s,t){return l(),c("div",Je,[r("div",Qe,[r("div",He,[r("div",Ke,[r("h5",Ze,d(t.isEditMode?t.__("Edit Currency Rate"):t.__("Add Currency Rate")),1),a[4]||(a[4]=r("button",{type:"button",class:"btn-close","data-coreui-dismiss":"modal","aria-label":"Close"},null,-1))]),r("div",et,[r("form",{onSubmit:a[2]||(a[2]=x((...o)=>t.submitForm&&t.submitForm(...o),["prevent"]))},[r("div",tt,[r("label",at,d(t.__("Date")),1),R(r("input",{type:"date",class:D(["form-control",{"is-invalid":s.errors.date}]),id:"rateDate","onUpdate:modelValue":a[0]||(a[0]=o=>s.formData.date=o),required:""},null,2),[[C,s.formData.date]]),s.errors.date?(l(),c("div",st,[Array.isArray(s.errors.date)?(l(),c("div",rt,[(l(!0),c(g,null,p(s.errors.date,o=>(l(),c("div",{key:o},d(o),1))),128))])):(l(),c("div",it,d(s.errors.date),1))])):f("",!0)]),r("div",nt,[r("label",ot,[b(d(t.__("Rate"))+" ",1),r("small",dt,"("+d(i.fromCurrency.iso_code)+" \u2192 "+d(i.toCurrency.iso_code)+")",1)]),R(r("input",{type:"number",step:"0.0001",min:"0.0000000001",class:D(["form-control",{"is-invalid":s.errors.rate}]),id:"rateValue","onUpdate:modelValue":a[1]||(a[1]=o=>s.formData.rate=o),required:""},null,2),[[C,s.formData.rate,void 0,{number:!0}]]),s.errors.rate?(l(),c("div",lt,[Array.isArray(s.errors.rate)?(l(),c("div",ct,[(l(!0),c(g,null,p(s.errors.rate,o=>(l(),c("div",{key:o},d(o),1))),128))])):(l(),c("div",ut,d(s.errors.rate),1))])):f("",!0)])],32)]),r("div",ht,[r("button",mt,d(t.__("Cancel")),1),r("button",{type:"button",class:"btn btn-primary",onClick:a[3]||(a[3]=(...o)=>t.submitForm&&t.submitForm(...o)),disabled:s.isSubmitting},[s.isSubmitting?(l(),c("span",yt)):f("",!0),b(" "+d(t.isEditMode?t.__("Update"):t.__("Add")),1)],8,_t)])])])])}const bt=h(Ge,[["render",ft]]),gt={name:"DateRangeSelectorWithPresets",emits:["update","dateChange"],props:{initialDateFrom:{type:String,default:null},initialDateTo:{type:String,default:null},initialPreset:{type:String,default:"none"},showUpdateButton:{type:Boolean,default:!1},presetGroups:{type:Array,default:()=>[{label:"Current period",options:[{value:"thisMonth",label:"This month"},{value:"thisQuarter",label:"This quarter"},{value:"thisYear",label:"This year"},{value:"thisMonthToDate",label:"This month to date"},{value:"thisQuarterToDate",label:"This quarter to date"},{value:"thisYearToDate",label:"This year to date"}]},{label:"Recent periods",options:[{value:"yesterday",label:"Yesterday"},{value:"previous7Days",label:"Previous 7 days"},{value:"previous30Days",label:"Previous 30 days"},{value:"previous90Days",label:"Previous 90 days"},{value:"previous180Days",label:"Previous 180 days"},{value:"previous365Days",label:"Previous 365 days"}]},{label:"Previous period",options:[{value:"previousMonth",label:"Previous month"},{value:"previousMonthToDate",label:"Previous month to date"}]}]}},data(){return{dateFrom:this.initialDateFrom,dateTo:this.initialDateTo,dateRangePicker:null,isPresetChange:!1}},mounted(){if(this.dateRangePicker=new W(this.$refs.dateRangePicker,{allowOneSidedRange:!0,weekStart:1,todayBtn:!0,todayBtnMode:1,todayHighlight:!0,language:window.YAFFA?window.YAFFA.language:"en",format:"yyyy-mm-dd",autohide:!0,buttonClass:"btn"}),this.initialDateFrom||this.initialDateTo){const i=this.initialDateFrom||{clear:!0},n=this.initialDateTo||{clear:!0};this.dateRangePicker.setDates(i,n)}if(this.initialPreset&&this.initialPreset!=="none"){const i=document.getElementById("dateRangePickerPresets");i&&(i.value=this.initialPreset,this.isPresetChange=!0,this.onPresetSelect({target:i}),this.isPresetChange=!1)}const e=this.$refs.dateRangePicker.querySelector('[name="date_from"]'),a=this.$refs.dateRangePicker.querySelector('[name="date_to"]');e&&a&&(e.addEventListener("changeDate",this.onDateChange),a.addEventListener("changeDate",this.onDateChange))},beforeUnmount(){this.dateRangePicker&&this.dateRangePicker.destroy()},methods:{clearSelection(){this.dateRangePicker.setDates({clear:!0},{clear:!0}),this.dateFrom=null,this.dateTo=null;const e=document.getElementById("dateRangePickerPresets");e&&(e.value="none"),this.emitUpdate()},onDateChange(){var a;if(!this.dateRangePicker)return;if(!this.isPresetChange){const i=document.getElementById("dateRangePickerPresets");i&&(i.value="none")}const e=this.dateRangePicker.getDates("yyyy-mm-dd");this.dateFrom=e[0]||null,this.dateTo=e[1]||null,this.showUpdateButton||this.emitUpdate(),this.$emit("dateChange",{dateFrom:this.dateFrom,dateTo:this.dateTo,preset:this.isPresetChange?(a=document.getElementById("dateRangePickerPresets"))==null?void 0:a.value:"none"})},onPresetSelect(e){this.isPresetChange=!0;const a=e.target.value,i=new Date;let n,s;const t=G[a];if(t){const o=t(i);n=o.start,s=o.end}else n={clear:!0},s={clear:!0};this.dateRangePicker.setDates(n,s),this.isPresetChange=!1,this.onDateChange()},triggerUpdate(){this.emitUpdate()},emitUpdate(){var e;this.$emit("update",{dateFrom:this.dateFrom,dateTo:this.dateTo,preset:((e=document.getElementById("dateRangePickerPresets"))==null?void 0:e.value)||"none"})},getDates(){return this.dateRangePicker?this.dateRangePicker.getDates("yyyy-mm-dd"):[this.dateFrom,this.dateTo]},__:function(e,a){return window.__(e,a)}}},pt={class:"card mb-3"},wt={class:"card-header"},vt={class:"card-title"},Rt={class:"card-body",ref:"dateRangePicker"},Ct={class:"row"},Dt={class:"col-6"},Ft={for:"date_from",class:"form-label"},kt=["placeholder"],Tt={class:"col-6"},xt={for:"date_to",class:"form-label"},Pt=["placeholder"],Et={class:"row mt-2"},At={class:"col-12"},St={value:"none"},Mt=["label"],qt=["value"],Lt={class:"card-footer text-end"};function Bt(e,a,i,n,s,t){return l(),c("div",pt,[r("div",wt,[r("div",vt,d(t.__("Date")),1)]),r("div",Rt,[r("div",Ct,[r("div",Dt,[r("label",Ft,d(t.__("Date from")),1),r("input",{type:"text",class:"form-control",name:"date_from",id:"date_from",placeholder:t.__("Select date"),autocomplete:"off"},null,8,kt)]),r("div",Tt,[r("label",xt,d(t.__("Date to")),1),r("input",{type:"text",class:"form-control",name:"date_to",id:"date_to",placeholder:t.__("Select date"),autocomplete:"off"},null,8,Pt)])]),r("div",Et,[r("div",At,[r("select",{id:"dateRangePickerPresets",class:"form-select",onChange:a[0]||(a[0]=(...o)=>t.onPresetSelect&&t.onPresetSelect(...o))},[r("option",St,d(t.__("Select preset")),1),(l(!0),c(g,null,p(i.presetGroups,o=>(l(),c("optgroup",{key:o.label,label:t.__(o.label)},[(l(!0),c(g,null,p(o.options,u=>(l(),c("option",{key:u.value,value:u.value},d(t.__(u.label)),9,qt))),128))],8,Mt))),128))],32)])])],512),r("div",Lt,[r("button",{class:"btn btn-sm btn-outline-dark",onClick:a[1]||(a[1]=(...o)=>t.clearSelection&&t.clearSelection(...o))},d(t.__("Clear selection")),1),i.showUpdateButton?(l(),c("button",{key:0,type:"button",class:"btn btn-sm btn-primary ms-2",onClick:a[2]||(a[2]=(...o)=>t.triggerUpdate&&t.triggerUpdate(...o))},d(t.__("Update")),1)):f("",!0)])])}const Ut=h(gt,[["render",Bt]]),Nt={name:"CurrencyRateManager",components:{CurrencyRateOverview:be,CurrencyRateActions:Se,CurrencyRateTable:Ne,CurrencyRateChart:We,CurrencyRateModal:bt,DateRangeSelectorWithPresets:Ut},props:{from:{type:Object,required:!0},to:{type:Object,required:!0},initialRates:{type:Array,required:!0}},data(){return{fromCurrency:this.from,toCurrency:this.to,allRates:JSON.parse(JSON.stringify(this.initialRates)),displayRates:null,dateFrom:null,dateTo:null,editingRate:null,isUpdatingFromChart:!1}},watch:{dateFrom(){this.updateDisplayRates()},dateTo(){this.updateDisplayRates()}},methods:{onDateChange({dateFrom:e,dateTo:a}){this.isUpdatingFromChart||(this.dateFrom=e,this.dateTo=a,this.updateDisplayRates())},updateDisplayRates(){if(!this.dateFrom&&!this.dateTo){this.displayRates=null;return}const e=this.allRates.filter(a=>{const i=new Date(a.date);if(this.dateFrom&&this.dateTo){const n=new Date(this.dateFrom),s=new Date(this.dateTo);return i>=n&&i<=s}else if(this.dateFrom){const n=new Date(this.dateFrom);return i>=n}else if(this.dateTo){const n=new Date(this.dateTo);return i<=n}return!0});this.displayRates=e},openAddModal(){this.editingRate=null,this.$nextTick(()=>{this.$refs.rateModal.show()})},openEditModal(e){this.editingRate=e,this.$nextTick(()=>{this.$refs.rateModal.show()})},onRateSaved(e,a){const i=new CustomEvent("toast",{detail:{header:this.__("Success"),body:a,toastClass:"bg-success"}});window.dispatchEvent(i);const n=this.allRates.findIndex(s=>s.id===e.id);n!==-1?this.allRates.splice(n,1,e):this.allRates.push(e),this.allRates.sort((s,t)=>new Date(s.date)-new Date(t.date)),this.updateDisplayRates(),this.$refs.rateTable.updateTableData(this.displayRates||this.allRates)},onRateDeleted(e){this.allRates=this.allRates.filter(a=>a.id!==e),this.updateDisplayRates(),this.$refs.rateTable.updateTableData(this.displayRates||this.allRates),this.$refs.rateChart.updateChart(this.allRates)},async reloadData(){try{const e=await window.axios.get(window.route("api.currency-rate.index",{from:this.fromCurrency.id,to:this.toCurrency.id}));this.allRates=e.data.rates,this.updateDisplayRates(),this.$refs.rateTable.updateTableData(this.displayRates||this.allRates),this.$refs.rateChart.updateChart(this.allRates)}catch(e){console.error("Failed to reload rates:",e)}},__:y}},Ot={class:"row"},It={class:"col-12 col-lg-3"},Yt={class:"col-12 col-lg-3"},$t={class:"col-md-6"};function jt(e,a,i,n,s,t){const o=m("currency-rate-overview"),u=m("currency-rate-actions"),w=m("date-range-selector-with-presets"),F=m("currency-rate-table"),k=m("currency-rate-chart"),T=m("currency-rate-modal");return l(),c("div",null,[r("div",Ot,[r("div",It,[_(o,{from:s.fromCurrency,to:s.toCurrency,"currency-rates":s.allRates},null,8,["from","to","currency-rates"]),_(u,{"from-currency":s.fromCurrency,"date-from":s.dateFrom,"date-to":s.dateTo,onAddRate:t.openAddModal,onRatesLoaded:t.reloadData},null,8,["from-currency","date-from","date-to","onAddRate","onRatesLoaded"]),_(w,{ref:"dateSelector","initial-date-from":s.dateFrom,"initial-date-to":s.dateTo,onUpdate:t.onDateChange},null,8,["initial-date-from","initial-date-to","onUpdate"])]),r("div",Yt,[_(F,{ref:"rateTable","currency-rates":s.allRates,"filtered-rates":s.displayRates,"from-currency":s.fromCurrency,"to-currency":s.toCurrency,onEditRate:t.openEditModal,onDeleteRate:t.onRateDeleted},null,8,["currency-rates","filtered-rates","from-currency","to-currency","onEditRate","onDeleteRate"])]),r("div",$t,[_(k,{ref:"rateChart","currency-rates":s.allRates,"to-currency":s.toCurrency},null,8,["currency-rates","to-currency"])])]),_(T,{ref:"rateModal","from-currency":s.fromCurrency,"to-currency":s.toCurrency,"edit-rate":s.editingRate,onSaved:t.onRateSaved,onClose:a[0]||(a[0]=zt=>s.editingRate=null)},null,8,["from-currency","to-currency","edit-rate","onSaved"])])}const Vt=h(Nt,[["render",jt]]),v=P({});v.config.globalProperties.__=window.__;v.component("currency-rate-manager",Vt);v.mount("#currencyRateApp");
