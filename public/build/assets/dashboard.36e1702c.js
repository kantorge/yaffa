import{a as b,o as i,b as l,d as r,t as c,w as p,v as T,F as C,f as D,e as h,g,n as A,a0 as k,h as _,i as Y,u as L,k as f,c as V}from"./app.1ea3d35e.js";import{h as S,t as x,_ as B,i as I}from"./helpers.0d23fc7a.js";import{u as W,t as j,c as H,X as O,C as E,V as R,d as P,S as z,I as N,b as X,e as U,p as M,f as q,g as w}from"./animated.b7973092.js";import{j as K,k as J}from"./dataTableHelper.f10b8b21.js";import{C as Q}from"./index.d8923a62.js";import{O as Z}from"./OnboardingCard.ccc4815d.js";import"./tslib.es6.598c7c7a.js";const G={components:{helpers:S},props:{locale:{type:String,default:window.YAFFA.locale}},data(){return{baseCurrency:window.YAFFA.baseCurrency,accountBalanceData:[],withClosed:!1,state:"loading",errorMessage:null,retryInterval:15e3}},created(){this.getAccountBalanceData()},computed:{accountBalanceDataByGroups(){let e={},t=this;return this.accountBalanceData.forEach(function(n){!t.withClosed&&!n.active||(e.hasOwnProperty(n.account_group_id)||(e[n.account_group_id]={name:n.account_group_name,accounts:[],sum:0}),e[n.account_group_id].accounts.push(n),e[n.account_group_id].sum+=n.sum)}),e},totalValue(){let e=this.withClosed;return this.accountBalanceData.filter(t=>e||t.active).reduce((t,n)=>t+n.sum,0)}},methods:{getAccountBalanceData:function(){if(!this.baseCurrency){this.state="error",this.errorMessage=__("Base currency is not set"),this.baseCurrency={};return}let e=this;this.state="loading",axios.get("/api/account/balance/").then(function(t){if(t.data.result==="busy"){e.state="data-not-available",e.errorMessage=t.data.message,setTimeout(function(){e.getAccountBalanceData()},e.retryInterval),e.retryInterval*=2;return}e.accountBalanceData=t.data.accountBalanceData,e.state="data-available"}).catch(function(t){e.state="error",e.errorMessage=t.message;let n=new CustomEvent("toast",{detail:{header:__("Error while fetching account balance data"),body:t.message,toastClass:"bg-danger"}});window.dispatchEvent(n)})},getRoute:function(e){return window.route("account-entity.show",{account_entity:e.id})},toggleWithInactive:function(){this.withClosed=!this.withClosed},toFormattedCurrency(e,t,n){return x(e,t,Object.assign(n,{max_digits:0}))},__:function(e,t){return B(e,t)}}},ee={class:"card mb-4",id:"widgetAccountBalance"},te={class:"card-header d-flex justify-content-between"},ae={class:"card-title"},se={key:0,class:"list-group list-group-flush"},ne={key:1,class:"list-group list-group-flush"},re={class:"list-group-item list-group-item-warning"},oe={key:2,class:"list-group list-group-flush"},ie={class:"list-group-item list-group-item-danger"},le={key:3,class:"list-group list-group-flush",id:"accordionAccountBalance"},ce={class:"d-flex justify-content-between"},de=["data-coreui-target","aria-controls"],ue=["id"],he=["href"],ye={key:0},me={class:"card-footer d-flex justify-content-between"},pe=["innerHTML"],_e=["innerHTML"],ge=["innerHTML"];function fe(e,t,n,u,a,s){return i(),l("div",ee,[r("div",te,[r("div",ae,c(s.__("Total value")),1),p(r("div",null,c(s.toFormattedCurrency(s.totalValue,n.locale,a.baseCurrency)),513),[[T,a.state==="data-available"]])]),a.state==="loading"?(i(),l("ul",se,[(i(),l(C,null,D(5,o=>r("li",{"aria-hidden":"true",class:"list-group-item placeholder-glow",key:o},[...t[1]||(t[1]=[r("span",{class:"placeholder col-12"},null,-1)])])),64))])):h("",!0),a.state==="data-not-available"?(i(),l("ul",ne,[r("li",re,c(a.errorMessage),1)])):h("",!0),a.state==="error"?(i(),l("ul",oe,[r("li",ie,c(s.__("There was an error while getting account data: "))+" "+c(a.errorMessage),1)])):h("",!0),a.state==="data-available"?(i(),l("ul",le,[(i(!0),l(C,null,D(s.accountBalanceDataByGroups,(o,y)=>(i(),l("li",{class:"list-group-item",key:y},[r("div",ce,[r("span",{"data-coreui-toggle":"collapse","data-parent":"#accordionAccountBalance","data-coreui-target":"#collapse_"+y,"aria-controls":"#collapse_"+y,class:"collapse-control collapsed","aria-expanded":"false",role:"button"},[t[2]||(t[2]=r("i",{class:"fa fa-angle-down"},null,-1)),g(" "+c(o.name),1)],8,de),r("span",{class:A({"text-danger":o.sum<0})},c(s.toFormattedCurrency(o.sum,n.locale,a.baseCurrency)),3)]),r("div",{id:"collapse_"+y,class:"list-group collapse mt-3","aria-expanded":"false"},[(i(!0),l(C,null,D(o.accounts,(d,m)=>(i(),l("a",{class:"list-group-item d-flex justify-content-between list-group-item-action",href:s.getRoute(d),key:m},[r("span",null,c(d.name),1),r("span",{class:A({"text-danger":d.sum<0})},[d.hasOwnProperty("sum_foreign")?(i(),l("span",ye,c(s.toFormattedCurrency(d.sum_foreign,n.locale,d.currency))+" / ",1)):h("",!0),g(" "+c(s.toFormattedCurrency(d.sum,n.locale,a.baseCurrency)),1)],2)],8,he))),128))],8,ue)]))),128))])):h("",!0),r("div",me,[t[3]||(t[3]=r("div",null,null,-1)),p(r("div",null,[a.withClosed?(i(),l("span",{key:0,innerHTML:s.__("Closed accounts are <strong>included</strong>")},null,8,pe)):h("",!0),a.withClosed?h("",!0):(i(),l("span",{key:1,innerHTML:s.__("Closed accounts are <strong>hidden</strong>")},null,8,_e)),r("button",{class:"btn btn-sm btn-ghost-dark ms-1",type:"button",onClick:t[0]||(t[0]=(...o)=>s.toggleWithInactive&&s.toggleWithInactive(...o)),innerHTML:a.withClosed?s.__("Hide"):s.__("Show")},null,8,ge)],512),[[T,a.state==="data-available"]])])])}const be=b(G,[["render",fe]]);W(j);const ve={props:{categoryAxisVisible:{type:Boolean,default:!1},transactionType:{type:String,default:"all"}},data(){return{available:!1,busy:!1,baseCurrency:window.YAFFA.baseCurrency,locale:window.YAFFA.locale,rawData:[],year:new Date().getFullYear(),month:new Date().getMonth()+1,transactionTypeData:this.transactionType,ready:!1}},created(){!this.baseCurrency||(this.available=!0,this.refreshData())},mounted(){if(!this.available)return;let e=H(this.$refs.chartdiv,O);e.hiddenState.properties.opacity=0,e.numberFormatter.intlLocales=this.locale,e.numberFormatter.numberFormat={style:"currency",currency:this.baseCurrency.iso_code,minimumFractionDigits:0},e.data=this.chartData;var t=e.xAxes.push(new E);t.dataFields.category="category",t.renderer.minGridDistance=40,this.categoryAxisVisible?t.events.on("sizechanged",function(y){var d=y.target,m=d.pixelWidth/(d.endIndex-d.startIndex);m<d.renderer.labels.template.maxWidth?(d.renderer.labels.template.rotation=-45,d.renderer.labels.template.horizontalCenter="right",d.renderer.labels.template.verticalCenter="middle"):(d.renderer.labels.template.rotation=0,d.renderer.labels.template.horizontalCenter="middle",d.renderer.labels.template.verticalCenter="top")}):t.hide(),e.yAxes.push(new R);var n=e.series.push(new P);n.dataFields.categoryX="category",n.dataFields.valueY="barValue",n.dataFields.openValueY="open",n.fillOpacity=.8,n.sequencedInterpolation=!0,n.interpolationDuration=1500,n.tooltipText="[bold]{categoryX}[/]: {value}";var u=n.columns.template;u.strokeOpacity=0,u.propertyFields.fill="color";var a=e.series.push(new z);a.dataFields.categoryX="category",a.dataFields.valueY="stepValue",a.noRisers=!0,a.stroke=new N().getFor("alternativeBackground"),a.strokeDasharray="3,3",a.interpolationDuration=2e3,a.sequencedInterpolation=!0,a.startLocation=.1,a.endLocation=1.1,e.cursor=new X,e.cursor.behavior="none";const s=e.chartContainer.createChild(U);s.id="noDataMessagecontainer",s.align="center",s.isMeasured=!1,s.x=M(50),s.horizontalCenter="middle",s.y=M(50),s.verticalCenter="middle",s.layout="vertical";const o=s.createChild(q);o.text=__("There is no data to show on this chart."),o.textAlign="middle",o.maxWidth=300,o.wrap=!0,this.chart=e,this.noDataMessagecontainer=s},methods:{previousMonth:function(){this.month--,this.month<1&&(this.year--,this.month=12),this.refreshData()},nextMonth:function(){this.month++,this.month>12&&(this.year++,this.month=1),this.refreshData()},refreshData(){if(this.busy)return;this.busy=!0,this.ready=!1;let e=this,t="/api/reports/waterfall/"+this.transactionTypeData+"/result/"+this.year+"/"+this.month;fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"}}).then(u=>u.json()).then(u=>{e.rawData=u.chartData,!e.rawData||e.rawData.length===0?e.noDataMessagecontainer.show():e.noDataMessagecontainer.hide(),e.ready=!0}).finally(()=>e.busy=!1).catch(function(u){console.log(u)})},__:function(e,t){return B(e,t)}},computed:{chartData(){var e=0;let t=this.rawData.sort(function(n,u){let a=n.value,s=u.value;return a<0&&s<0&&(a=a*-1,s=s*-1),a>s?-1:a<s?1:0}).map(function(n){return n.open=e,n.stepValue=e+n.value,n.barValue=e+n.value,e=n.barValue,n.color=n.value>0?w("green"):w("red"),n});return t.length>1&&t.push({category:__("Result"),open:0,stepValue:0,barValue:e,value:e,color:e>0?w("green"):w("red")}),t},dateLabel(){return new Date(this.year,this.month-1,1).toLocaleDateString(window.YAFFA.locale,{year:"numeric",month:"long"})}},beforeDestroy(){this.chart&&this.chart.dispose()},updated(){!this.chart||(this.chart.data=this.chartData,this.chart.validateData())}},we={key:0,class:"card mb-4"},Ce={class:"card-header d-flex justify-content-between"},De={class:"card-title"},Te=["title"],ke=["title"],xe={class:"card-body"},Fe={key:0,"aria-hidden":"true",class:"placeholder-glow"},Ae={id:"categoryWaterfallChart",ref:"chartdiv"},Me={class:"card-footer text-end"},Se={class:"btn-group",role:"group","aria-label":"Transaction type selector for category waterfall chart"},Be=["disabled"],Ye=["disabled"],Le=["disabled"];function Ve(e,t,n,u,a,s){return a.available?(i(),l("div",we,[r("div",Ce,[r("div",De,c(s.__("Monthly overview for top-level categories")),1),p(r("div",null,[r("button",{class:"btn btn-sm btn-info",type:"button",onClick:t[0]||(t[0]=(...o)=>s.previousMonth&&s.previousMonth(...o)),title:s.__("Previous month")},[...t[8]||(t[8]=[r("span",{class:"fa fa-fw fa-caret-left"},null,-1)])],8,Te),g(" "+c(s.dateLabel)+" ",1),r("button",{class:"btn btn-sm btn-info",type:"button",onClick:t[1]||(t[1]=(...o)=>s.nextMonth&&s.nextMonth(...o)),title:s.__("Next month")},[...t[9]||(t[9]=[r("span",{class:"fa fa-fw fa-caret-right"},null,-1)])],8,ke)],512),[[T,a.ready]])]),r("div",xe,[a.ready?h("",!0):(i(),l("p",Fe,[...t[10]||(t[10]=[r("span",{class:"placeholder col-12"},null,-1)])])),p(r("div",Ae,null,512),[[T,a.ready]])]),r("div",Me,[r("div",Se,[p(r("input",{type:"radio",class:"btn-check",name:"waterfallTransactionCategory",id:"waterfallTransactionCategory_All",value:"all",autocomplete:"off","onUpdate:modelValue":t[2]||(t[2]=o=>a.transactionTypeData=o),onChange:t[3]||(t[3]=(...o)=>s.refreshData&&s.refreshData(...o)),disabled:a.busy},null,40,Be),[[k,a.transactionTypeData]]),t[11]||(t[11]=r("label",{class:"btn btn-sm btn-outline-primary",for:"waterfallTransactionCategory_All"},"All transactions",-1)),p(r("input",{type:"radio",class:"btn-check",name:"waterfallTransactionCategory",id:"waterfallTransactionCategory_Standard",value:"standard",autocomplete:"off","onUpdate:modelValue":t[4]||(t[4]=o=>a.transactionTypeData=o),onChange:t[5]||(t[5]=(...o)=>s.refreshData&&s.refreshData(...o)),disabled:a.busy},null,40,Ye),[[k,a.transactionTypeData]]),t[12]||(t[12]=r("label",{class:"btn btn-sm btn-outline-primary",for:"waterfallTransactionCategory_Standard"},"Only standard",-1)),p(r("input",{type:"radio",class:"btn-check",name:"waterfallTransactionCategory",id:"waterfallTransactionCategory_Investment",value:"investment",autocomplete:"off","onUpdate:modelValue":t[6]||(t[6]=o=>a.transactionTypeData=o),onChange:t[7]||(t[7]=(...o)=>s.refreshData&&s.refreshData(...o)),disabled:a.busy},null,40,Le),[[k,a.transactionTypeData]]),t[13]||(t[13]=r("label",{class:"btn btn-sm btn-outline-primary",for:"waterfallTransactionCategory_Investment"},"Only investment",-1))])])])):h("",!0)}const Ie=b(ve,[["render",Ve],["__scopeId","data-v-438c9be3"]]);const We={components:{dataTableHelpers:K,helpers:S,Calendar:Q},props:{locale:{type:String,default:window.YAFFA.locale}},methods:{getTransactionTypeIcon:function(e){return e?J(e.transaction_type.type,e.transaction_type.name,this.getTransactionLabel(e)):""},getTransactionLink:function(e){return window.route("transaction.open",{transaction:e,action:"enter"})},getTransactionLabel:function(e){if(!e)return"";if(e.transaction_type.type==="standard")return e.transaction_type.name.charAt(0).toUpperCase()+e.transaction_type.name.slice(1)+" "+x(e.config.amount_to,this.locale,e.transaction_currency)+" from "+e.config.account_from.name+" to "+e.config.account_to.name},refreshTooltip:function(){I()},toFormattedCurrency(e,t,n){return x(e,t,n)},hide(){$("#widgetScheduleCalendar").hide()}},data(){return{busy:!1,transactions:[],masks:{weekdays:"WWW"},minDate:null,maxDate:null}},created(){this.busy=!0;let e=this;axios.get("/api/transactions/get_scheduled_items/schedule").then(function(t){if(e.transactions=t.data.transactions.filter(n=>n.transaction_schedule&&n.transaction_schedule.next_date).map(function(n,u){return{key:u+1,customData:n,dates:new Date(n.transaction_schedule.next_date)}}),e.transactions.length>1){const n=e.transactions.map(a=>a.dates).reduce(function(a,s){return a<s?a:s});e.minDate=new Date(n.getFullYear(),n.getMonth(),1);const u=e.transactions.map(a=>a.dates).reduce(function(a,s){return a>s?a:s});e.maxDate=new Date(u.getFullYear(),u.getMonth()+1,0)}else if(e.transactions.length===1){const n=new Date(e.transactions[0].dates);e.minDate=new Date(n.getFullYear(),n.getMonth(),1),e.maxDate=new Date(n.getFullYear(),n.getMonth()+1,0)}else{const n=new Date;e.minDate=new Date(n.getFullYear(),n.getMonth(),1),e.maxDate=new Date(n.getFullYear(),n.getMonth()+1,0)}}).finally(function(){e.busy=!1,setTimeout(()=>e.refreshTooltip(),1e3)})}},je={class:"card mb-4",id:"widgetScheduleCalendar"},He={class:"card-header d-flex justify-content-between"},Oe={class:"card-title"},Ee=["disabled"],Re={class:"card-body"},Pe={key:0,"aria-hidden":"true",class:"placeholder-glow"},ze={class:"day-label text-sm"},Ne={class:"vc-day-custom-content"},Xe=["href","innerHTML"];function Ue(e,t,n,u,a,s){const o=_("Calendar");return i(),l("div",je,[r("div",He,[r("div",Oe,c(e.__("Scheduled transaction instances")),1),r("div",null,[r("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:t[0]||(t[0]=(...y)=>s.hide&&s.hide(...y)),disabled:a.busy},null,8,Ee)])]),r("div",Re,[a.busy?(i(),l("p",Pe,[...t[1]||(t[1]=[r("span",{class:"placeholder col-12"},null,-1)])])):h("",!0),a.busy?h("",!0):(i(),Y(o,{key:1,class:"custom-calendar",masks:a.masks,attributes:a.transactions,"first-day-of-week":2,"min-date":a.minDate,"max-date":a.maxDate,"disable-page-swipe":"",expanded:"","trim-weeks":"",onTransitionEnd:s.refreshTooltip},{"day-content":L(({day:y,attributes:d})=>[r("div",null,[r("span",ze,c(y.day),1),r("div",Ne,[(i(!0),l(C,null,D(d,m=>{var v;return i(),l("a",{key:m.key,style:{margin:"0 1px"},href:s.getTransactionLink(((v=m.customData)==null?void 0:v.id)||0),innerHTML:s.getTransactionTypeIcon(m.customData)},null,8,Xe)}),128))])])]),_:1},8,["masks","attributes","min-date","max-date","onTransitionEnd"]))])])}const qe=b(We,[["render",Ue]]),Ke={data(){return{payeeSuggestion:null,error:!1,busy:!1,success:!1}},created(){axios.get("/api/assets/get_default_category_suggestion").then(e=>this.payeeSuggestion=e.data)},methods:{accept(){this.busy=!0;let e=this;axios.get("/api/assets/accept_default_category_suggestion/"+this.payeeSuggestion.payee_id+"/"+this.payeeSuggestion.max_category_id).then(function(){e.success=!0,e.error=!1}).catch(function(){e.success=!1,e.error=!0}).finally(()=>e.busy=!1)},dismiss(){this.busy=!0;let e=this;axios.get("/api/assets/dismiss_default_category_suggestion/"+this.payeeSuggestion.payee_id).finally(()=>this.hide()).catch(function(){e.success=!1,e.error=!0}),this.busy=!1},hide(){$("#widgetPayeeCategoryRecommendation").hide()}},computed:{editlink(){return window.route("account-entity.edit",{type:"payee",account_entity:this.payeeSuggestion.payee_id})}}},Je={key:0,id:"widgetPayeeCategoryRecommendation",class:"card mb-4"},Qe={class:"card-header d-flex justify-content-between"},Ze={class:"card-title"},Ge=["disabled"],$e={class:"card-body"},et=["href"],tt={key:0},at=["title","disabled"],st=["title","disabled"],nt=["title","disabled"],rt={key:0,class:"card-footer"},ot={key:0,class:"text-danger"},it={key:1,class:"text-success"};function lt(e,t,n,u,a,s){return a.payeeSuggestion?(i(),l("div",Je,[r("div",Qe,[r("div",Ze,c(e.__("Tip on your payee!")),1),r("div",null,[r("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:t[0]||(t[0]=(...o)=>s.hide&&s.hide(...o)),disabled:a.busy},null,8,Ge)])]),r("div",$e,[r("p",null,[t[4]||(t[4]=g(" Your payee ",-1)),r("strong",null,[r("a",{href:s.editlink},c(a.payeeSuggestion.payee),9,et)]),t[5]||(t[5]=g(" used category ",-1)),r("strong",null,c(a.payeeSuggestion.category),1),g(" "+c(a.payeeSuggestion.max)+" times out of "+c(a.payeeSuggestion.sum)+" transactions. It might be a good idea to set it as default category. ",1)]),a.success?h("",!0):(i(),l("div",tt,[r("button",{type:"button",class:"btn btn-success me-2",title:e.__("Accept recommendation and set it as default category for payee"),onClick:t[1]||(t[1]=(...o)=>s.accept&&s.accept(...o)),disabled:a.busy},c(e.__("OK, let's do it!")),9,at),r("button",{type:"button",class:"btn btn-primary me-2",title:e.__("Hide this recommendation, but it might be displayed later"),onClick:t[2]||(t[2]=(...o)=>s.hide&&s.hide(...o)),disabled:a.busy},c(e.__("Maybe later")),9,st),r("button",{type:"button",class:"btn btn-outline-dark me-2",title:e.__("Don't show category recommendations for this payee any more"),onClick:t[3]||(t[3]=(...o)=>s.dismiss&&s.dismiss(...o)),disabled:a.busy},c(e.__("No, thanks")),9,nt)]))]),a.error||a.success?(i(),l("div",rt,[a.error?(i(),l("span",ot,c(e.__("Something failed")),1)):h("",!0),a.success?(i(),l("span",it,c(e.__("Saved successfully")),1)):h("",!0)])):h("",!0)])):h("",!0)}const ct=b(Ke,[["render",lt]]),dt={components:{"account-balance":be,"category-waterfall":Ie,"schedule-calendar":qe,"payee-category-recommendation":ct,"onboarding-card":Z}},ut={class:"row"},ht={class:"col-md-5"},yt={class:"col-md-7"};function mt(e,t,n,u,a,s){const o=_("onboarding-card"),y=_("account-balance"),d=_("payee-category-recommendation"),m=_("category-waterfall"),v=_("schedule-calendar");return i(),l("div",ut,[r("div",ht,[f(o,{cardTitle:e.__("Welcome to YAFFA!"),cardBody:e.__("We recommend completing the following steps to have a great experience with YAFFA."),completedMessage:e.__("Congratulations! Keep using YAFFA. You can dismiss this widget."),topic:"dashboard"},null,8,["cardTitle","cardBody","completedMessage"]),f(y),f(d)]),r("div",yt,[f(m),f(v)])])}const pt=b(dt,[["render",mt]]),F=V({});F.config.globalProperties.__=window.__;F.component("dashboard",pt);F.mount("#app");
