import"./dataTables.bootstrap5.9fbefa5d.js";import"./responsive.bootstrap5.a235b38a.js";import{f as r,r as s}from"./dataTableHelper.f10b8b21.js";import"./app.1ea3d35e.js";import"./helpers.0d23fc7a.js";import"./tslib.es6.598c7c7a.js";const d="#table",c=[{property:"transactions_count",value:0,negate:!1,errorMessage:__("It is already used in transactions.")}];window.payees=window.payees.map(function(t){return t.transactions_count=t.from_count+t.to_count,t.from_min_date=t.from_min_date?new Date(Date.parse(t.from_min_date)):null,t.from_max_date=t.from_max_date?new Date(Date.parse(t.from_max_date)):null,t.to_min_date=t.to_min_date?new Date(Date.parse(t.to_min_date)):null,t.to_max_date=t.to_max_date?new Date(Date.parse(t.to_max_date)):null,t.transactions_min_date=t.from_min_date&&t.to_min_date?new Date(Math.min(t.from_min_date,t.to_min_date)):t.from_min_date||t.to_min_date,t.transactions_max_date=t.from_max_date&&t.to_max_date?new Date(Math.max(t.from_max_date,t.to_max_date)):t.from_max_date||t.to_max_date,t});window.table=$(d).DataTable({data:payees,columns:[{data:"name",title:__("Name")},{data:"active",title:__("Active"),render:function(t,e){return r(t,e)},className:"text-center activeIcon"},{data:"config.category",title:__("Default category"),render:function(t){return t?t.full_name:__("Not set")}},{data:"transactions_count",title:__("Transactions"),render:function(t,e){return e==="display"?t>0?t:__("Never used"):t},type:"num"},{data:"transactions_min_date",title:__("First transaction"),render:function(t,e){return e==="display"?t?t.toLocaleDateString(window.YAFFA.locale):__("Never used"):t||null},type:"date"},{data:"transactions_max_date",title:__("Last transaction"),render:function(t,e){return e==="display"?t?t.toLocaleDateString(window.YAFFA.locale):__("Never used"):t||null},type:"date"},{data:"alias",title:__("Import alias"),render:function(t,e){return e==="display"?t?t.replace(`
`,"<br>"):__("Not set"):t}},{data:"id",title:__("Actions"),render:function(t,e,a){return'<a href="'+window.route("account-entity.edit",{type:"payee",account_entity:t})+'" class="btn btn-xs btn-primary" title="'+__("Edit")+'"><i class="fa fa-edit"></i></a> '+s(a,c,__("This payee cannot be deleted."))+'<a href="'+window.route("payees.merge.form",{payeeSource:t})+'" class="btn btn-xs btn-primary" title="'+__("Merge into an other payee")+'"><i class="fa fa-random"></i></a> '},className:"dt-nowrap",orderable:!1,searchable:!1}],createdRow:function(t,e){e.config.category||$("td:eq(2)",t).addClass("text-muted text-italic"),e.transactions_count===0&&$("td:eq(3)",t).addClass("text-muted text-italic"),e.transactions_min_date||$("td:eq(4)",t).addClass("text-muted text-italic"),e.transactions_max_date||$("td:eq(5)",t).addClass("text-muted text-italic"),e.alias||$("td:eq(6)",t).addClass("text-muted text-italic")},order:[[0,"asc"]],deferRender:!0,scrollY:"500px",scrollCollapse:!0,stateSave:!1,processing:!0,paging:!1,responsive:!0,initComplete:function(t){$(t.nTable).on("click","td.activeIcon > i",function(){var e=$(t.nTable).DataTable().row($(this).parents("tr"));if($(this).hasClass("fa-spinner"))return!1;$(this).removeClass().addClass("fa fa-spinner fa-spin"),$.ajax({type:"PUT",url:window.route("api.accountentity.updateActive",{accountEntity:e.data().id,active:e.data().active?0:1}),data:{_token:csrfToken},dataType:"json",context:this,success:function(a){payees.filter(n=>n.id===a.id)[0].active=a.active},error:function(a){alert("Error changing payee active state")},complete:function(a){e.invalidate()}})}),$(t.nTable).on("click","td > button.deleteIcon:not(.busy)",function(){if(!confirm(__("Are you sure to want to delete this item?")))return;let e=$(t.nTable).DataTable().row($(this).parents("tr")),a=$(this);a.addClass("busy"),$.ajax({type:"DELETE",url:window.route("api.accountentity.destroy",e.data().id),data:{_token:csrfToken},dataType:"json",context:this,success:function(n){window.payees=window.payees.filter(o=>o.id!==n.accountEntity.id),e.remove().draw();let i=new CustomEvent("toast",{detail:{header:__("Success"),body:__("Payee deleted"),toastClass:"bg-success"}});window.dispatchEvent(i)},error:function(n){let i=new CustomEvent("toast",{detail:{header:__("Error"),body:__("Error while trying to delete payee"),toastClass:"bg-danger"}});window.dispatchEvent(i)},complete:function(n){a.removeClass("busy")}})})}});$("input[name=table_filter_active]").on("change",function(){table.column(1).search(this.value).draw()});$("#table_filter_search_text").keyup(function(){table.search($(this).val()).draw()});
