import{_ as S,a as m,o as h,b as e,t as o,g as q,n as J,F as R,f as E,v as U,q as K,s as $,u as Z,x as tt,y as et,z as st,A as Y,B as nt,C as at,D as it,E as ot,G as rt,r as T,d as C,c as ct}from"./app-KLFPBacJ.js";import{a as O,s as dt,_ as p,b as I}from"./helpers-C8PqwG3r.js";import{D as L}from"./dataTables.bootstrap5-Csew7iXD.js";import{S as lt}from"./sweetalert2.esm.all-BQxta0Da.js";import{t as ut,a as k}from"./dataTableHelper-BFrUsbwO.js";import{u as M,t as P,c as V,b as X,D as H,V as W,L as mt,B as ht,R as _t,X as z,S as j}from"./animated-BLhhOB8u.js";import"./tslib.es6-CZM0TROl.js";const ft={name:"InvestmentDetailsCard",props:{investment:{type:Object,required:!0}},methods:{getEditUrl(){return window.route("investment.edit",{investment:this.investment.id})}}},yt={class:"card mb-3"},vt={class:"card-header d-flex justify-content-between"},bt={class:"card-title"},gt=["href","title"],pt={class:"card-body"},wt={class:"row mb-0"},Dt={class:"col-4"},Ft={class:"col-8"},Tt={class:"col-4"},Ct={class:"col-8"},St={class:"col-4"},At={class:"col-4"},kt={class:"col-8"},qt=["title"],$t=["title"],It={class:"col-4"},xt={class:"col-8"},Qt={class:"col-4"},Nt={class:"col-8"},Rt={class:"col-4"},Et={class:"col-8"},Ut={class:"col-4"},Yt={class:"col-8"},jt=["title"],Bt=["title"],Ot={class:"col-4"},Lt={class:"col-8"};function Mt(t,n,s,r,i,a){return h(),m("div",yt,[e("div",vt,[e("div",bt,o(t.__("Investment details")),1),e("div",null,[e("a",{href:a.getEditUrl(),class:"btn btn-sm btn-outline-primary",title:t.__("Edit investment")},[...n[0]||(n[0]=[e("i",{class:"fa fa-edit"},null,-1)])],8,gt)])]),e("div",pt,[e("dl",wt,[e("dt",Dt,o(t.__("Name")),1),e("dd",Ft,o(s.investment.name),1),e("dt",Tt,o(t.__("Symbol")),1),e("dd",Ct,o(s.investment.symbol),1),e("dt",St,o(t.__("ISIN number")),1),e("dd",{class:J(["col-8",{"text-muted text-italic":!s.investment.isin}])},o(s.investment.isin||t.__("Not set")),3),e("dt",At,o(t.__("Active")),1),e("dd",kt,[s.investment.active?(h(),m("i",{key:0,class:"fa fa-check-square text-success",title:t.__("Yes")},null,8,qt)):(h(),m("i",{key:1,class:"fa fa-square text-danger",title:t.__("No")},null,8,$t))]),e("dt",It,o(t.__("Group")),1),e("dd",xt,o(s.investment.investment_group.name),1),e("dt",Qt,o(t.__("Currency")),1),e("dd",Nt,o(s.investment.currency.name),1),s.investment.comment?(h(),m(R,{key:0},[e("dt",Rt,o(t.__("Comment")),1),e("dd",Et,o(s.investment.comment),1)],64)):q("",!0),e("dt",Ut,o(t.__("Automatic update")),1),e("dd",Yt,[s.investment.auto_update?(h(),m("i",{key:0,class:"fa fa-check-square text-success",title:t.__("Yes")},null,8,jt)):(h(),m("i",{key:1,class:"fa fa-square text-danger",title:t.__("No")},null,8,Bt))]),s.investment.auto_update?(h(),m(R,{key:1},[e("dt",Ot,o(t.__("Price provider")),1),e("dd",Lt,o(s.investment.investment_price_provider_name),1)],64)):q("",!0)])])])}const Pt=S(ft,[["render",Mt]]),Vt={name:"CurrentAssetsCard",props:{investment:{type:Object,required:!0}},data(){return{locale:window.YAFFA.locale}},methods:{toFormattedCurrency:O,formatQuantity(t){return t===0?"0":t.toLocaleString(this.locale,{minimumFractionDigits:0,maximumFractionDigits:4})}}},Xt={class:"card mb-3"},Ht={class:"card-header"},Wt={class:"card-title"},zt={class:"card-body"},Gt={class:"row mb-0"},Jt={class:"col-8"},Kt={class:"col-4"},Zt={class:"col-8"},te={class:"col-4"},ee={class:"col-8"},se={class:"col-4"};function ne(t,n,s,r,i,a){return h(),m("div",Xt,[e("div",Ht,[e("div",Wt,o(t.__("Current assets")),1)]),e("div",zt,[e("dl",Gt,[e("dt",Jt,o(t.__("Owned quantity")),1),e("dd",Kt,o(a.formatQuantity(s.investment.current_quantity)),1),e("dt",Zt,o(t.__("Latest price")),1),e("dd",te,o(a.toFormattedCurrency(s.investment.latest_price,i.locale,s.investment.currency)),1),e("dt",ee,o(t.__("Latest owned value")),1),e("dd",se,o(a.toFormattedCurrency(s.investment.current_quantity*s.investment.latest_price,i.locale,s.investment.currency)),1)])])])}const ae=S(Vt,[["render",ne]]),ie={name:"ResultsCard",props:{investment:{type:Object,required:!0},transactions:{type:Array,required:!0},prices:{type:Array,required:!0},dateFrom:{type:Date,default:null},dateTo:{type:Date,default:null}},emits:["update:date-from","update:date-to"],data(){const t=this.transactions.map(r=>new Date(r.date)),n=t.length?new Date(Math.min(...t)):new Date,s=t.length?new Date(Math.max(...t)):new Date;return{locale:window.YAFFA?window.YAFFA.locale:navigator.language,internalDateFrom:this.dateFrom||n,internalDateTo:this.dateTo||s}},watch:{dateFrom(t){t&&(this.internalDateFrom=t)},dateTo(t){t&&(this.internalDateTo=t)},internalDateFrom(t){t&&this.internalDateTo&&t instanceof Date&&this.internalDateTo instanceof Date&&!isNaN(t)&&!isNaN(this.internalDateTo)&&t>this.internalDateTo&&(this.showToast(p("Warning"),this.__("The start date cannot be after the end date."),"bg-warning"),this.internalDateFrom=new Date(this.internalDateTo),this.$emit("update:date-from",this.internalDateTo))},internalDateTo(t){t&&this.internalDateFrom&&t instanceof Date&&this.internalDateFrom instanceof Date&&!isNaN(t)&&!isNaN(this.internalDateFrom)&&t<this.internalDateFrom&&(this.showToast(p("Warning"),this.__("The end date cannot be before the start date."),"bg-warning"),this.internalDateTo=new Date(this.internalDateFrom),this.$emit("update:date-to",this.internalDateFrom))}},computed:{dateFromString:{get(){return this.internalDateFrom?this.internalDateFrom.toISOString().slice(0,10):""},set(t){if(!t)return;const n=new Date(t);if(this.internalDateTo&&n>this.internalDateTo){this.showToast(this.__("Warning"),this.__("The start date cannot be after the end date."),"bg-warning"),this.$nextTick(()=>{const s=this.$el.querySelector('input[type="date"]');s&&(s.value=this.internalDateFrom.toISOString().slice(0,10))});return}this.internalDateFrom=n,this.$emit("update:date-from",n)}},dateToString:{get(){return this.internalDateTo?this.internalDateTo.toISOString().slice(0,10):""},set(t){if(!t)return;const n=new Date(t);if(this.internalDateFrom&&n<this.internalDateFrom){this.showToast(this.__("Warning"),this.__("The end date cannot be before the start date."),"bg-warning"),this.$nextTick(()=>{const s=this.$el.querySelectorAll('input[type="date"]');s&&s[1]&&(s[1].value=this.internalDateTo.toISOString().slice(0,10))});return}this.internalDateTo=n,this.$emit("update:date-to",n)}},filteredTransactions(){return this.transactions.filter(t=>{const n=new Date(t.date);return n>=this.internalDateFrom&&n<=this.internalDateTo})},summary(){const t=this.filteredTransactions,n=(f,v)=>f.reduce((b,G)=>b+v(G),0),s=(f,v)=>n(f.filter(b=>b.transaction_type.name===v),b=>b.config.quantity||0),r=(f,v)=>n(f.filter(b=>b.transaction_type.name===v),b=>(b.config.price||0)*(b.config.quantity||0)),i=(f,v)=>n(f,b=>b.config[v]||0),a=f=>n(f,v=>(v.transaction_type.quantity_multiplier||0)*(v.config.quantity||0));let y=1;if(this.prices.length>0)y=this.prices[this.prices.length-1].price;else{const f=t.filter(v=>!isNaN(v.price)).sort((v,b)=>new Date(b.date)-new Date(v.date));f.length>0&&(y=f[0].price)}const A=a(t),D=A*y,F=r(t,"Buy"),w=r(t,"Sell"),l=s(t,"Add"),c=s(t,"Remove"),u=i(t,"dividend"),_=i(t,"commission"),d=i(t,"tax"),g=w+u+D-F-_-d;return{Buying:F,Selling:w,Added:l,Removed:c,Dividend:u,Commission:_,Taxes:d,Quantity:A,Value:D,Result:g}},roi(){return this.summary.Buying===0?0:this.summary.Result/this.summary.Buying},roiString(){return(this.roi*100).toFixed(2)+"%"},aroi(){const t=this.calculateYears(this.internalDateTo,this.internalDateFrom);return t>0?Math.pow(1+this.roi,1/t)-1:0},aroiString(){return(this.aroi*100).toFixed(2)+"%"}},methods:{toFormattedCurrency:O,showToast:dt,formatQuantity(t){return t===0?"0":t.toLocaleString(this.locale,{minimumFractionDigits:0,maximumFractionDigits:4})},resetDates(){const t=this.transactions.map(n=>new Date(n.date));this.internalDateFrom=t.length?new Date(Math.min(...t)):new Date,this.internalDateTo=t.length?new Date(Math.max(...t)):new Date},calculateYears(t,n){const s=t-n,r=new Date(s);return Math.abs(r.getUTCFullYear()-1970)}}},oe={class:"card mb-3"},re={class:"card-header d-flex justify-content-between"},ce={class:"card-title"},de={class:"card-body"},le={class:"row mb-3"},ue={for:"date_from",class:"col-6 col-sm-2 col-form-label"},me={class:"col-6 col-sm-4"},he=["max"],_e={for:"date_to",class:"col-6 col-sm-2 col-form-label"},fe={class:"col-6 col-sm-4"},ye=["min"],ve={class:"row mb-0"},be={class:"col-sm-6"},ge={class:"row mb-0"},pe={class:"col-6"},we={class:"col-6"},De={class:"col-6"},Fe={class:"col-6"},Te={class:"col-6"},Ce={class:"col-6"},Se={class:"col-6"},Ae={class:"col-6"},ke={class:"col-6"},qe={class:"col-6"},$e={class:"col-6"},Ie={class:"col-6"},xe={class:"col-6"},Qe={class:"col-6"},Ne={class:"col-6"},Re={class:"col-6"},Ee={class:"col-6"},Ue={class:"col-6"},Ye={class:"col-sm-6"},je={class:"row mb-0"},Be={class:"col-6"},Oe={class:"col-6"},Le={class:"col-6"},Me={class:"col-6"},Pe={class:"col-6"},Ve={class:"col-6"};function Xe(t,n,s,r,i,a){return h(),m("div",oe,[e("div",re,[e("div",ce,o(t.__("Results")),1),e("div",null,[e("button",{class:"btn btn-sm btn-primary",onClick:n[0]||(n[0]=(...y)=>a.resetDates&&a.resetDates(...y))},o(t.__("Reset dates")),1)])]),e("div",de,[e("div",le,[e("label",ue,o(t.__("Date from")),1),e("div",me,[E(e("input",{type:"date",class:"form-control","onUpdate:modelValue":n[1]||(n[1]=y=>a.dateFromString=y),max:a.dateToString},null,8,he),[[U,a.dateFromString]])]),e("label",_e,o(t.__("Date to")),1),e("div",fe,[E(e("input",{type:"date",class:"form-control","onUpdate:modelValue":n[2]||(n[2]=y=>a.dateToString=y),min:a.dateFromString},null,8,ye),[[U,a.dateToString]])])]),e("div",ve,[e("div",be,[e("dl",ge,[e("dt",pe,o(t.__("Buying cost")),1),e("dd",we,o(a.toFormattedCurrency(a.summary.Buying,i.locale,s.investment.currency)),1),e("dt",De,o(t.__("Added quantity")),1),e("dd",Fe,o(a.formatQuantity(a.summary.Added)),1),e("dt",Te,o(t.__("Removed quantity")),1),e("dd",Ce,o(a.formatQuantity(a.summary.Removed)),1),e("dt",Se,o(t.__("Selling revenue")),1),e("dd",Ae,o(a.toFormattedCurrency(a.summary.Selling,i.locale,s.investment.currency)),1),e("dt",ke,o(t.__("Dividend")),1),e("dd",qe,o(a.toFormattedCurrency(a.summary.Dividend,i.locale,s.investment.currency)),1),e("dt",$e,o(t.__("Commissions")),1),e("dd",Ie,o(a.toFormattedCurrency(a.summary.Commission,i.locale,s.investment.currency)),1),e("dt",xe,o(t.__("Taxes")),1),e("dd",Qe,o(a.toFormattedCurrency(a.summary.Taxes,i.locale,s.investment.currency)),1),e("dt",Ne,o(t.__("Quantity")),1),e("dd",Re,o(a.formatQuantity(a.summary.Quantity)),1),e("dt",Ee,o(t.__("Value")),1),e("dd",Ue,o(a.toFormattedCurrency(a.summary.Value,i.locale,s.investment.currency)),1)])]),e("div",Ye,[e("dl",je,[e("dt",Be,o(t.__("Result")),1),e("dd",Oe,o(a.toFormattedCurrency(a.summary.Result,i.locale,s.investment.currency)),1),e("dt",Le,o(t.__("ROI")),1),e("dd",Me,o(a.roiString),1),e("dt",Pe,o(t.__("Annualized ROI")),1),e("dd",Ve,o(a.aroiString),1)])])])])])}const He=S(ie,[["render",Xe]]),B=["childRow","column-sizing","column-visibility","destroy","draw","error","init","length","order","page","preDraw","preInit","preXhr","processing","requestChild","search","stateLoadParams","stateLoaded","stateSaveParams","xhr","autoFill","preAutoFill","buttons-action","buttons-processing","column-reorder","key","key-blur","key-focus","key-refocus","key-return-submit","responsive-display","responsive-resize","rowgroup-datasrc","pre-row-reorder","row-reorder","row-reordered","dtsb-inserted","deselect","select","select-blur","selectItems","selectStyle","user-select","stateRestore-change"];let x;const We={name:"Datatables.netVue",inheritAttrs:!1,use(t){x=t}},ze=K({...We,props:{ajax:null,columns:null,data:null,options:null},emits:B,setup(t,{expose:n}){const s=t,r=$(null),i={},a=$(),y=$([]);Z(()=>s.data,l=>{let c=a.value;c&&(w(c),c.clear(),c.rows.add(l).draw(!1))},{deep:!0}),tt(()=>{var l;const c=et();let u=Object.assign({},s.options)||{};if(s.data&&(u.data=s.data,A(u.data)),s.columns&&(u.columns=s.columns),u.columns&&F(u.columns,c),s.ajax&&(u.ajax=s.ajax),u.columnDefs||(u.columnDefs=[]),c){let _=Object.keys(c.slots);for(let d=0;d<_.length;d++){let g=_[d];if(g.match(/^column\-/)){let f=g.replace("column-","");u.columnDefs.push({target:f.match(/^\d+$/)?parseInt(f):f+":name",render:"#"+g})}}F(u.columnDefs,c)}if(!x)throw new Error("DataTables library not set. See https://datatables.net/tn/19 for details.");a.value=new x(rt(r),u),(l=a.value)==null||l.on("preXhr",function(){w(a.value)});for(let _ of B)a.value&&c&&a.value.on(_,function(){var d=Array.from(arguments),g=d.shift();d.unshift({event:g,dt:a}),d.unshift(_),c.emit.apply(c,d)})}),st(()=>{var l;w(a.value),(l=a.value)==null||l.destroy(!0)});function A(l){y.value=l.value?l.value.slice():l.slice()}function D(l){return function(c,u,_,d){let g=d.settings.sTableId+","+d.row+","+d.col;if(!i[g]){let f=it("div",l({cellData:c,colIndex:d.col,rowData:_,rowIndex:d.row,type:u}));i[g]=document.createElement("div"),ot(f,i[g])}return i[g]}}function F(l,c){if(c)for(let _=0;_<l.length;_++){let d=l[_];if(typeof d.render=="string"&&d.render.charAt(0)==="#"){var u=d.render.replace("#","");c.slots[u]&&(d.render=D(c.slots[u]))}else if(typeof d.render=="object"&&typeof d.render.display=="string"&&d.render.display.charAt(0)==="#"){var u=d.render.display.replace("#","");c.slots[u]&&(d.render.display=D(c.slots[u]))}}}function w(l){let c=Object.keys(i),u=l.table().node().id;for(var _=0;_<c.length;_++)c[_].indexOf(u+",")===0&&delete i[c[_]]}return n({dt:a}),(l,c)=>c[0]||(Y(-1),c[0]=e("div",{class:"datatable"},[e("table",nt({ref_key:"table",ref:r},l.$attrs,{style:{width:"100%"}}),[at(l.$slots,"default")],16)]),Y(1),c[0])}}),Q=(()=>{const t=ze;return t.install=n=>{n.component("Datatables.netVue",t)},t})();Q.use(L);Q.use(L);const Ge={name:"TransactionHistoryCard",components:{DataTable:Q},props:{transactions:{type:Array,required:!0},investment:{type:Object,required:!0},locale:{type:String,default:()=>window.YAFFA?window.YAFFA.locale:navigator.language}},emits:["set-date-range","delete-transaction"],methods:{toIsoDateString:I,__:p,confirmDeleteTransaction(t){lt.fire({animation:!1,text:this.__("Are you sure to want to delete this item?"),icon:"warning",showCancelButton:!0,cancelButtonText:this.__("Cancel"),confirmButtonText:this.__("Confirm"),buttonsStyling:!1,customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-outline-secondary ms-3"}}).then(n=>{if(!n.isConfirmed)return;let s=new CustomEvent("toast",{detail:{body:this.__("Deleting transaction #:transactionId",{transactionId:t}),toastClass:`bg-info toast-transaction-${t}`,delay:1/0}});window.dispatchEvent(s),window.axios.delete(window.route("api.transactions.destroy",{transaction:t})).then(()=>{let r=new CustomEvent("toast",{detail:{header:this.__("Success"),body:this.__("Transaction deleted (#:transactionId)",{transactionId:t}),toastClass:"bg-success"}});window.dispatchEvent(r),this.$emit("delete-transaction",t)}).catch(r=>{let i=new CustomEvent("toast",{detail:{header:this.__("Error"),body:this.__("Error deleting transaction (#:transactionId): :error",{transactionId:t,error:r}),toastClass:"bg-danger"}});window.dispatchEvent(i)}).finally(()=>{setTimeout(()=>{let r=document.querySelector(`.toast-transaction-${t}`);r&&window.bootstrap&&window.bootstrap.Toast&&new window.bootstrap.Toast(r).hide()},250)})})}},computed:{newTransactionUrl(){return window.route?window.route("transaction.create",{type:"investment",callback:"back"}):"#"},tableOptions(){return{createdRow:(t,n)=>{t.querySelectorAll(".set-date").forEach(s=>{s.onclick=r=>{const i=s.getAttribute("data-type"),a=s.getAttribute("data-date");i&&a&&this.$emit("set-date-range",{type:i,date:a}),r.stopPropagation()}}),t.querySelectorAll(".data-delete").forEach(s=>{s.onclick=r=>{const i=s.getAttribute("data-id");i&&this.confirmDeleteTransaction(i),r.stopPropagation()}})}}},tableColumns(){const t=this;return[ut.dateFromCustomField("date",p("Date"),this.locale),{data:"transaction_type.name",title:p("Transaction")},{data:"config.quantity",title:p("Quantity"),render:function(n){return n!==null&&n!==""?Number(n).toLocaleString(t.locale):""}},{data:"config.price",title:p("Price"),render:function(n,s){return k(s,n,t.locale,t.investment.currency)}},{data:"config.dividend",title:p("Dividend"),render:function(n,s){return k(s,n,t.locale,t.investment.currency)}},{data:"config.commission",title:p("Commission"),render:function(n,s){return k(s,n,t.locale,t.investment.currency)}},{data:"config.tax",title:p("Tax"),render:function(n,s){return k(s,n,t.locale,t.investment.currency)}},{data:"cashflow_value",title:p("Cash flow value"),render:function(n,s){return isNaN(n)?0:k(s,n,t.locale,t.investment.currency)}},{data:"id",defaultContent:"",title:p("Actions"),render:function(n,s,r){let i=`<button class="btn btn-xs btn-outline-dark set-date" data-type="from" data-date="${I(r.date)}" title="${t.__("Make this the start date")}"><i class="fa fa-fw fa-caret-left"></i></button> <button class="btn btn-xs btn-outline-dark set-date" data-type="to" data-date="${I(r.date)}" title="${t.__("Make this the end date")}"><i class="fa fa-fw fa-caret-right"></i></button> `;if(!r.schedule){const a=r.id;i+=`<a href="${window.route("transaction.open",{transaction:a,action:"edit"})}" class="btn btn-xs btn-primary" title="${t.__("Edit")}"><i class="fa fa-fw fa-edit"></i></a> <a href="${window.route("transaction.open",{transaction:a,action:"clone"})}" class="btn btn-xs btn-primary" title="${t.__("Clone")}"><i class="fa fa-fw fa-clone"></i></a> <button class="btn btn-xs btn-danger data-delete" data-id="${a}" type="button" title="${t.__("Delete")}"><i class="fa fa-fw fa-trash"></i></button> `}return i},className:"dt-nowrap",orderable:!1,searchable:!1}]}}},Je={class:"card mb-3"},Ke={class:"card-header d-flex justify-content-between"},Ze={class:"card-title"},ts=["href","title"],es={class:"card-body"};function ss(t,n,s,r,i,a){const y=T("DataTable");return h(),m("div",Je,[e("div",Ke,[e("div",Ze,o(a.__("Transaction history")),1),e("div",null,[e("a",{href:a.newTransactionUrl,class:"btn btn-success btn-sm",title:a.__("New investment transaction")},[...n[0]||(n[0]=[e("i",{class:"fa fa-plus"},null,-1)])],8,ts)])]),e("div",es,[C(y,{data:s.transactions,columns:a.tableColumns,options:a.tableOptions,class:"table table-bordered table-hover",width:"100%"},null,8,["data","columns","options"])])])}const ns=S(Ge,[["render",ss]]),as={name:"PriceHistoryCard",props:{prices:{type:Array,required:!0},investment:{type:Object,required:!0},locale:{type:String,default:()=>window.YAFFA?window.YAFFA.locale:navigator.language}},computed:{hasData(){return this.prices&&this.prices.length>0},priceProviderUrl(){return window.route?window.route("investment-price.retrieve",{investment:this.investment.id}):"#"},priceListUrl(){return window.route?window.route("investment-price.list",{investment:this.investment.id}):"#"}},mounted(){if(!this.hasData)return;M(P);let t=V(this.$refs.chartPrice,X);t.data=this.prices,t.dateFormatter.inputDateFormat="yyyy-MM-dd",t.numberFormatter.intlLocales=this.locale,t.numberFormatter.numberFormat={style:"currency",currency:this.investment.currency.iso_code,minimumFractionDigits:0};let n=t.xAxes.push(new H);n.dataFields={category:"date"},t.yAxes.push(new W);let s=t.series.push(new mt);s.dataFields.valueY="price",s.dataFields.dateX="date",s.strokeWidth=3;let i=s.bullets.push(new ht).createChild(_t);i.width=5,i.height=5,i.horizontalCenter="middle",i.verticalCenter="middle";let a=new z;a.series.push(s),t.scrollbarX=a,this.chart=t},beforeUnmount(){this.chart&&this.chart.dispose()},methods:{}},is={class:"card mb-3"},os={class:"card-header d-flex justify-content-between"},rs={class:"card-title"},cs={key:0,class:"badge text-bg-warning me-2"},ds=["href","title"],ls=["href"],us=["title"],ms={class:"card-body"},hs={key:0},_s={ref:"chartPrice",style:{width:"100%",height:"300px"}},fs={key:1},ys={class:"text-center text-muted"};function vs(t,n,s,r,i,a){return h(),m("div",is,[e("div",os,[e("div",rs,o(t.__("Price history")),1),e("div",null,[a.hasData?q("",!0):(h(),m("span",cs,o(t.__("No data available")),1)),s.investment.investment_price_provider?(h(),m("a",{key:1,href:a.priceProviderUrl,class:"btn btn-sm btn-success me-2",title:t.__("Load new price data")},[...n[0]||(n[0]=[e("span",{class:"fa fa-cloud-download"},null,-1)])],8,ds)):q("",!0),e("a",{href:a.priceListUrl,class:"btn btn-sm btn-primary"},[e("span",{class:"fa fa-search",title:t.__("List prices")},null,8,us)],8,ls)])]),e("div",ms,[a.hasData?(h(),m("div",hs,[e("div",_s,null,512)])):(h(),m("div",fs,[e("div",ys,o(t.__("No data available")),1)]))])])}const bs=S(as,[["render",vs]]),gs={name:"QuantityHistoryCard",props:{quantities:{type:Array,required:!0},locale:{type:String,default:()=>window.YAFFA?window.YAFFA.locale:navigator.language}},computed:{hasData(){return this.quantities&&this.quantities.length>0}},mounted(){if(!this.hasData)return;M(P);let t=V(this.$refs.chartQuantity,X);t.data=this.quantities;let n=t.xAxes.push(new H);n.dataFields={category:"date"},t.yAxes.push(new W);let s=t.series.push(new j);s.dataFields.valueY="quantity",s.dataFields.dateX="date",s.strokeWidth=3,s.startLocation=1;let r=t.series.push(new j);r.dataFields.valueY="schedule",r.dataFields.dateX="date",r.strokeWidth=3,r.strokeDasharray="3,3",r.startLocation=1;let i=new z;i.series.push(s),i.series.push(r),t.scrollbarX=i,this.chart=t},beforeUnmount(){this.chart&&this.chart.dispose()},methods:{}},ps={class:"card mb-3"},ws={class:"card-header d-flex justify-content-between"},Ds={class:"card-title"},Fs={key:0,class:"badge text-bg-warning me-2"},Ts={class:"card-body"},Cs={key:0},Ss={ref:"chartQuantity",style:{width:"100%",height:"300px"}},As={key:1},ks={class:"text-center text-muted"};function qs(t,n,s,r,i,a){return h(),m("div",ps,[e("div",ws,[e("div",Ds,o(t.__("Quantity history")),1),e("div",null,[a.hasData?q("",!0):(h(),m("span",Fs,o(t.__("No data available")),1))])]),e("div",Ts,[a.hasData?(h(),m("div",Cs,[e("div",Ss,null,512)])):(h(),m("div",As,[e("div",ks,o(t.__("No data available")),1)]))])])}const $s=S(gs,[["render",qs]]),Is={components:{InvestmentDetailsCard:Pt,CurrentAssetsCard:ae,ResultsCard:He,TransactionHistoryCard:ns,PriceHistoryCard:bs,QuantityHistoryCard:$s},props:{investment:Object,transactions:Array,prices:Array,quantities:Array},data(){return{dateFrom:null,dateTo:null,processedTransactions:[],processedQuantities:[]}},created(){this.processedTransactions=this.transactions.map(t=>({...t,date:t.date?new Date(t.date):null})),this.processedQuantities=this.investment.quantities.map(t=>({...t,date:t.date?new Date(t.date):null})),this.processedQuantities.length>0&&(this.processedQuantities.push({...this.processedQuantities[this.processedQuantities.length-1],date:new Date(this.processedQuantities[this.processedQuantities.length-1].date.getTime()+1440*60*60*1e3)}),this.processedQuantities.unshift({quantity:0,schedule:0,date:new Date(this.processedQuantities[0].date.getTime()-1440*60*60*1e3)}))},methods:{onSetDateRange({type:t,date:n}){t==="from"?this.dateFrom=new Date(n):t==="to"&&(this.dateTo=new Date(n))},onDeleteTransaction(t){this.processedTransactions=this.processedTransactions.filter(n=>String(n.id)!==String(t))}}},xs={class:"row"},Qs={class:"col-md-8"},Ns={class:"row"},Rs={class:"col-md-5"},Es={class:"col-md-7"},Us={class:"col-md-4"};function Ys(t,n,s,r,i,a){const y=T("investment-details-card"),A=T("current-assets-card"),D=T("results-card"),F=T("transaction-history-card"),w=T("price-history-card"),l=T("quantity-history-card");return h(),m("div",xs,[e("div",Qs,[e("div",Ns,[e("div",Rs,[C(y,{investment:s.investment},null,8,["investment"]),C(A,{investment:s.investment},null,8,["investment"])]),e("div",Es,[C(D,{investment:s.investment,transactions:i.processedTransactions,prices:s.prices,"date-from":i.dateFrom,"date-to":i.dateTo,"onUpdate:dateFrom":n[0]||(n[0]=c=>i.dateFrom=c),"onUpdate:dateTo":n[1]||(n[1]=c=>i.dateTo=c)},null,8,["investment","transactions","prices","date-from","date-to"])])]),C(F,{transactions:i.processedTransactions,investment:s.investment,onSetDateRange:a.onSetDateRange,onDeleteTransaction:a.onDeleteTransaction},null,8,["transactions","investment","onSetDateRange","onDeleteTransaction"])]),e("div",Us,[C(w,{prices:s.prices,investment:s.investment,"date-from":i.dateFrom,"date-to":i.dateTo,"onUpdate:dateFrom":n[2]||(n[2]=c=>i.dateFrom=c),"onUpdate:dateTo":n[3]||(n[3]=c=>i.dateTo=c)},null,8,["prices","investment","date-from","date-to"]),C(l,{quantities:i.processedQuantities,investment:s.investment,"date-from":i.dateFrom,"date-to":i.dateTo,"onUpdate:dateFrom":n[4]||(n[4]=c=>i.dateFrom=c),"onUpdate:dateTo":n[5]||(n[5]=c=>i.dateTo=c)},null,8,["quantities","investment","date-from","date-to"])])])}const js=S(Is,[["render",Ys]]);window.calculateYears=function(t,n){const s=n-t,r=new Date(s);return Math.abs(r.getUTCFullYear()-1970)};const N=ct({});N.config.globalProperties.__=window.__;N.component("InvestmentDisplayContainer",js);N.mount("#app");
