import{u as F,c as v,D as b,g as d,V as p,d as f,L as y,a as A,h as x,b as E,t as _,X as I}from"./animated.085da57c.js";import"./select2.7201c0e6.js";import"./tslib.es6.598c7c7a.js";import"./app.ffd9927a.js";F(_);window.chartData=[];let t;t=v("chartdiv",I);t.numberFormatter.intlLocales=window.YAFFA.locale;t.dateFormatter.intlLocales=window.YAFFA.locale;t.numberFormatter.numberFormat={style:"currency",currency:window.YAFFA.baseCurrency.iso_code,currencyDisplay:"narrowSymbol",minimumFractionDigits:0};t.dateFormatter.dateFormat={year:"numeric",month:"long"};let c=t.xAxes.push(new b);c.dataFields.category="month";c.dateFormatter.intlLocales=window.YAFFA.locale;c.dateFormats.setKey("year",{year:"numeric"});c.dateFormats.setKey("month",{year:"numeric",month:"short"});c.events.on("datavalidated",function(e){let a=e.target;const l=new Date;let i=a.axisRanges.create();i.date=new Date(l.getFullYear(),l.getMonth(),1),i.endDate=new Date(l.getFullYear(),l.getMonth()+1,0),i.axisFill.fill=d("#396478"),i.axisFill.fillOpacity=.4,i.grid.strokeOpacity=0});let m=t.yAxes.push(new p),s=t.series.push(new f);s.dataFields.valueY="account_balance";s.yAxis=m;s.dataFields.dateX="month";s.name=__("Monthly balance change");s.columns.template.strokeOpacity=0;s.tooltipText="{dateX}: [b]{valueY}[/]";s.columns.template.fill=d("green");s.columns.template.adapter.add("fill",function(e,a){return a.dataItem&&a.dataItem.valueY<0?d("red"):e});let n=t.series.push(new y);n.dataFields.valueY="account_balance_running_total";n.dataFields.dateX="month";n.strokeWidth=2;n.stroke=d("black");n.name=__("Running total");n.tooltipText="{dateX}: [b]{valueY}[/]";let r=t.series.push(new y);r.dataFields.valueY="investment_value";r.dataFields.dateX="month";r.strokeWidth=2;r.stroke=d("blue");r.name=__("Investment value");r.tooltipText="{dateX}: [b]{valueY}[/]";let u=t.yAxes.push(new p);u.renderer.opposite=!0;let g=new A;g.series.push(s);t.scrollbarX=g;t.legend=new x;t.cursor=new E;function h(){const e=window.route("api.reports.cashflow",{withForecast:document.getElementById("withForecast").checked,accountEntity:$(o).val()?$(o).val():void 0});document.getElementById("btnReload").disabled=!0,fetch(e).then(a=>a.json()).then(function(a){if(a.result==="busy"){document.getElementById("placeholder").classList.remove("hidden"),document.getElementById("chartdiv").classList.add("hidden");let l=new CustomEvent("toast",{detail:{header:__("Warning"),body:a.message,toastClass:"bg-warning"}});window.dispatchEvent(l);return}t.data=a.chartData,t.invalidateData(),document.getElementById("placeholder").classList.add("hidden"),document.getElementById("chartdiv").classList.remove("hidden")}).catch(a=>console.error(a)).finally(()=>{document.getElementById("btnReload").disabled=!1})}const o="#cashflowAccount";function w(){let e=[];$(o).val()&&e.push("accountEntity="+$(o).val()),document.getElementById("withForecast").checked&&e.push("withForecast=1"),window.history.pushState("","",window.location.origin+window.location.pathname+"?"+e.join("&"))}$(o).select2({theme:"bootstrap-5",ajax:{url:"/api/assets/account",dataType:"json",delay:150,data:function(e){return{q:e.term,withInactive:!0}},processResults:function(e){return{results:e.map(function(a){return{id:a.id,text:a.name}})}},cache:!0},placeholder:__("Select account"),allowClear:!0}).on("select2:select",w).on("select2:unselect",w);document.getElementById("singleAxis").addEventListener("change",function(){n.yAxis==m?(n.yAxis=u,u.disabled=!1):(n.yAxis=m,u.disabled=!0)});document.getElementById("withForecast").addEventListener("change",w);document.getElementById("btnReload").addEventListener("click",h);window.presetAccount?$.ajax({url:"/api/assets/account/"+window.presetAccount,data:{_token:window.csrfToken}}).done(e=>{$(o).append(new Option(e.name,e.id,!0,!0)).trigger("change").trigger({type:"select2:select",params:{data:{id:e.id,name:e.name}}}),h()}):h();
