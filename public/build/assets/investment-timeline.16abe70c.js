import{u as m,t as h,c as y,X as f,j as _,C as g,D as w,g as v,d as F,p as D,k as c}from"./animated.b7973092.js";import{t as x}from"./kelly.2c029627.js";import{t as b}from"./helpers.0d23fc7a.js";import{l as E}from"./dataTableHelper.f10b8b21.js";import"./tslib.es6.598c7c7a.js";import"./app.1ea3d35e.js";m(h);m(x);window.chartData=[];let r;function u(){r=y("chart",f),r.hiddenState.properties.opacity=0,r.paddingRight=30,r.dateFormatter.inputDateFormat="yyyy-MM-dd";var t=new _;t.saturation=.4,r.data=window.chartData;var e=r.yAxes.push(new g);e.dataFields.category="name",e.renderer.labels.template.disabled=!0,e.renderer.grid.template.location=0,e.renderer.inversed=!0,e.renderer.cellStartLocation=.1,e.renderer.cellEndLocation=.9;var n=r.xAxes.push(new w);n.dateFormatter.dateFormat="yyyy-MM-dd",n.renderer.minGridDistance=70,n.baseInterval={count:1,timeUnit:"month"},n.max=new Date(window.YAFFA.end_date).getTime(),n.strictMinMax=!0,n.renderer.tooltipLocation=0,n.events.on("datavalidated",function(l){var a=l.target;const o=new Date;var s=a.axisRanges.create();s.date=new Date(o.getFullYear(),o.getMonth(),1),s.endDate=new Date(o.getFullYear(),o.getMonth()+1,0),s.axisFill.fill=v("#396478"),s.axisFill.fillOpacity=.5,s.grid.strokeOpacity=0});var i=r.series.push(new F);i.columns.template.tooltipText=`[bold]{name}[/]
----
{openDateX} - {dateX}
${__("Last quantity")}: {formatted_quantity}
${__("Estimated end value")}: {formatted_value}`,i.dataFields.openDateX="start",i.dataFields.dateX="end",i.dataFields.categoryY="name",i.columns.template.strokeOpacity=1,i.columns.template.height=D(100),r.scrollbarX=new c,r.scrollbarY=new c}function d(){const t=document.querySelector('input[name="table_filter_active"]:checked').value,e=document.querySelector('input[name="table_filter_open"]:checked').value,n=document.getElementById("table_filter_search_text").value.trim().toLowerCase(),i=$(p).jstree().get_checked().map(a=>Number(a));let l=new Date;l.setHours(0,0,0,0),r.data=window.chartData.filter(function(a){return t===""?!0:a.active===(t===__("Yes"))}).filter(function(a){if(e==="")return!0;let o=new Date(a.end);return o.setHours(0,0,0,0),e===__("Yes")?o>=l:o<l}).filter(function(a){return i.includes(a.investment_group.id)}).filter(function(a){return n===""?!0:a.name.toLowerCase().includes(n)})}document.querySelectorAll('#cardFilters input[type="radio"]').forEach(t=>{t.addEventListener("change",d)});document.getElementById("table_filter_search_text").addEventListener("keyup",d);document.getElementById("table_filter_search_text_clear").addEventListener("click",function(){document.getElementById("table_filter_search_text").value="",d()});const p="#investment-group-tree-container";E(p,window.investmentGroups,d);fetch("/api/assets/investment/timeline").then(t=>t.json()).then(function(t){window.chartData=t.map(function(e){return e.value=e.quantity*e.last_price,e.formatted_quantity=e.quantity.toLocaleString(window.YAFFA.locale,{minimumFractionDigits:0,maximumFractionDigits:4}),e.formatted_value=b(e.value,window.YAFFA.locale,e.currency),e}),u()}).then(()=>{u(),document.getElementById("chart-placeholder").style.display="none",document.getElementById("chart").style.display="block"}).catch(t=>{let e=new CustomEvent("toast",{detail:{header:__("Error"),body:t.message,toastClass:"bg-danger"}});window.dispatchEvent(e)});
