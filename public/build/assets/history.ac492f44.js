import"./dataTables.bootstrap5.509daac4.js";import"./responsive.bootstrap5.f789e6f7.js";import{t as i,a as c,d as n,b as l,c as d,e as u}from"./dataTableHelper.1c2d9edf.js";import{c as f}from"./app.ffd9927a.js";import{Q as _}from"./Modal.3b9d77d6.js";import"./helpers.35739ffe.js";import"./tslib.es6.598c7c7a.js";import"./ActionButtonBar.fefa1163.js";const p="#scheduleTable",r="#historyTable";window.transactionData=window.transactionData.map(function(t){return t.date&&(t.date=new Date(t.date)),t});window.scheduleData=window.scheduleData.map(function(t){return t.transaction_schedule.next_date&&(t.transaction_schedule.next_date=new Date(t.transaction_schedule.next_date)),t});var o={title:__("Payee"),defaultContent:"",render:function(t,a,e){if(e.transaction_type.type==="standard"){if(e.transaction_type.name==="withdrawal")return e.account_to_name;if(e.transaction_type.name==="deposit")return e.account_from_name;if(e.transaction_type.name==="transfer")return e.transactionOperator===-1?__("Transfer to :account",{account:e.account_to_name}):__("Transfer from :account",{account:e.account_from_name})}return e.transaction_type.type==="investment"?e.account_to_name:e.transaction_type.type==="Opening balance"?__("Opening balance"):""}};$(r).DataTable({data:transactionData,columns:[i.dateFromCustomField("date",__("Date"),window.YAFFA.locale),{data:"reconciled",title:'<span title="'+__("Reconciled")+'">R</span>',className:"text-center",render:function(t,a,e){return a==="filter"?!e.schedule&&(e.transaction_type.type==="standard"||e.transaction_type.type==="investment")?e.reconciled?__("Reconciled"):__("Uncleared"):__("Unavailable"):!e.schedule&&(e.transaction_type.type==="standard"||e.transaction_type.type==="investment")?e.reconciled?'<i class="fa fa-check-circle text-success reconcile" data-reconciled="true" data-id="'+e.id+'"></i>':'<i class="fa fa-circle text-info reconcile" data-reconciled="false" data-id="'+e.id+'"></i>':'<i class="fa fa-circle text-muted"></i>'},orderable:!1},o,i.category,{title:__("Withdrawal"),defaultContent:"",render:function(t,a,e){if(e.transactionOperator===-1)return c(a,e.amount_from,window.YAFFA.locale,currency)},className:"dt-nowrap"},{title:__("Deposit"),defaultContent:"",render:function(t,a,e){if(e.transactionOperator===1)return c(a,e.amount_to,window.YAFFA.locale,currency)},className:"dt-nowrap"},{data:"running_total",title:__("Running total"),defaultContent:"",render:function(t,a){return c(a,t,window.YAFFA.locale,currency)},className:"dt-nowrap",createdCell:function(t,a){a<0&&$(t).addClass("text-danger")}},i.comment,i.tags,{title:__("Actions"),defaultContent:"",render:function(t,a,e){return e.transaction_type.type==="Opening balance"?null:e.schedule?e.schedule_first_instance?'<a href="'+route("transaction.open",{transaction:e.originalId,action:"enter"})+'" class="btn btn-xs btn-success" title="'+__("Edit and insert instance")+'"><i class="fa fa-fw fa-pencil"></i></a> <button class="btn btn-xs btn-warning data-skip" data-id="'+e.originalId+'" type="button" title="'+__("Skip current schedule")+'"><i class="fa fa-fw fa-forward"></i></i></button> ':null:n(e.id,"quickView")+n(e.id,"show")+n(e.id,"edit")+n(e.id,"clone")+n(e.id,"delete")},className:"dt-nowrap",orderable:!1,searchable:!1}],createdRow:function(t,a){a.schedule&&$(t).addClass("text-muted text-italic")},initComplete:function(){var t=this.api();setTimeout(function(){t.columns.adjust().draw()},2e3)},order:[[0,"asc"]],responsive:!0,deferRender:!0,scrollY:"400px",scrollCollapse:!0,stateSave:!0,processing:!0,paging:!1});$(p).DataTable({data:scheduleData,columns:[i.dateFromCustomField("transaction_schedule.next_date",__("Next date"),window.YAFFA.locale),o,i.category,{title:"Withdrawal",defaultContent:"",render:function(t,a,e){if(e.transactionOperator===-1)return c(a,e.amount_from,window.YAFFA.locale,currency)},className:"dt-nowrap"},{title:"Deposit",defaultContent:"",render:function(t,a,e){if(e.transactionOperator===1)return c(a,e.amount_to,window.YAFFA.locale,currency)},className:"dt-nowrap"},i.comment,i.tags,{data:"id",title:__("Actions"),render:function(t,a,e){return'<a href="'+route("transaction.open",{transaction:t,action:"enter"})+'" class="btn btn-xs btn-success"><i class="fa fa-fw fa-pencil" title="'+__("Edit and insert instance")+'"></i></a> <button class="btn btn-xs btn-warning data-skip" data-id="'+t+'" type="button"><i class="fa fa-fw fa-forward" title="'+__("Skip current schedule")+'"></i></i></button> '+n(t,"edit")+n(t,"clone")+n(t,"replace")+n(t,"delete")},orderable:!1}],createdRow:function(t,a){var e=new Date(a.transaction_schedule.next_date);e<new Date(new Date().setHours(0,0,0,0))?$(t).addClass("table-danger"):e<new Date(new Date().setHours(24,0,0,0))&&$(t).addClass("table-warning")},order:[[0,"asc"]],responsive:!0,deferRender:!0,scrollY:"400px",scrollCollapse:!0,stateSave:!0,processing:!0,paging:!1});l("#historyTable, #scheduleTable");d("#historyTable, #scheduleTable");u(r);$("input[name=reconciled]").on("change",function(){$(r).DataTable().column(1).search(this.value).draw()});$(r).on("click","i.reconcile",function(){if($(this).hasClass("fa-spinner"))return!1;var t=$(this).data("reconciled");$(this).removeClass().addClass("fa fa-spinner fa-spin"),$.ajax({type:"PUT",url:"/api/transaction/"+$(this).data("id")+"/reconciled/"+(t?0:1),data:{_token:csrfToken},dataType:"json",context:this,success:function(a){t=!t,$(this).removeClass().addClass("fa reconcile").addClass(t?"fa-check-circle text-success":"fa-circle text-info").data("reconciled",t)}})});const s=f({});s.config.globalProperties.__=window.__;s.component("transaction-show-modal",_);s.mount("#app");
