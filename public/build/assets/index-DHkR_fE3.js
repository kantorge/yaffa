import"./dataTables.bootstrap5-C_qjeAEr.js";import"./responsive.bootstrap5-Ct7FWSHK.js";import{f as c,g as d,r as u,l as m}from"./dataTableHelper-DPRPCEc4.js";import{a as s}from"./helpers-uU3f7Ngr.js";import"./app-QU5FfaO6.js";import"./tslib.es6-CZM0TROl.js";const _=[{property:"transactions_count",value:0,negate:!1,errorMessage:__("It is already used in transactions.")}];let i=$("#investmentSummary").DataTable({data:window.investments,columns:[{data:"name",title:__("Name"),render:function(e,n,t){return`<a href="${window.route("investment.show",t.id)}" title="${__("View investment details")}">${e}</a>`},type:"html"},{data:"active",title:__("Active"),render:function(e,n){return c(e,n)},className:"text-center activeIcon"},{data:"investment_group.name",title:__("Group"),type:"string"},{data:"symbol",title:__("Symbol")},{data:"isin",title:__("ISIN number")},{data:"quantity",title:__("Quantity"),render:function(e,n){return n==="display"?e.toLocaleString(window.YAFFA.locale,{maximumFractionDigits:2,useGrouping:!0}):e},type:"num",className:"dt-nowrap"},{data:"price",title:__("Latest price"),render:function(e,n,t){return n==="display"&&!isNaN(e)&&typeof e=="number"?s(e,window.YAFFA.locale,t.currency):e},type:"num",className:"dt-nowrap"},{defaultContent:"",title:__("Value"),render:function(e,n,t){const a=t.quantity*t.price;return n==="display"?s(a,window.YAFFA.locale,t.currency):a},type:"num",className:"dt-nowrap"},{data:"id",title:__("Actions"),render:function(e,n,t){return'<a href="'+route("investment.show",e)+'" class="btn btn-xs btn-success"><i class="fa fa-fw fa-search" title="'+__("View investment details")+'"></i></a> <a href="'+route("investment-price.list",e)+'" class="btn btn-xs btn-primary"><i class="fa fa-fw fa-dollar" title="'+__("View investment price list")+'"></i></a> '+d(e,"edit","investment.edit")+u(t,_,__("This investment cannot be deleted."))},className:"dt-nowrap",orderable:!1,searchable:!1}],order:[[0,"asc"]],responsive:!0,initComplete:function(e){$(e.nTable).on("click","td.activeIcon > i:not(.inProgress)",function(){var n=$(e.nTable).DataTable().row($(this).parents("tr"));$(this).removeClass().addClass("fa fa-spinner fa-spin inProgress"),$.ajax({type:"PUT",url:"/api/assets/investment/"+n.data().id+"/active/"+(n.data().active?0:1),data:{_token:csrfToken},dataType:"json",context:this,success:function(t){window.investments.filter(a=>a.id===t.id)[0].active=t.active},error:function(t){alert(__("Error changing investment active state"))},complete:function(t){n.invalidate()}})}),$(e.nTable).on("click","td > button.deleteIcon:not(.busy)",function(){if(!confirm(__("Are you sure to want to delete this item?")))return;let n=$(e.nTable).DataTable().row($(this).parents("tr")),t=$(this);t.addClass("busy"),$.ajax({type:"DELETE",url:window.route("api.investment.destroy",n.data().id),data:{_token:csrfToken},dataType:"json",context:this,success:function(a){window.investments=window.investments.filter(l=>l.id!==a.investment.id),$(e.nTable).DataTable().row($(this).parents("tr")).remove().draw();let r=new CustomEvent("toast",{detail:{header:__("Success"),body:__("Investment deleted"),toastClass:"bg-success"}});window.dispatchEvent(r)},error:function(a){let r=new CustomEvent("toast",{detail:{header:__("Error"),body:__("Error while trying to delete investment"),toastClass:"bg-danger"}});window.dispatchEvent(r)},complete:function(a){t.removeClass("busy")}})})},deferRender:!0,scrollY:"500px",scrollCollapse:!0,stateSave:!1,processing:!0,paging:!1});const o="#investment-group-tree-container";m(o,window.investmentGroups,f);function f(){const n=$(o).jstree().get_checked(!0).map(t=>"^"+t.text+"$");i.column(2).search(n.join("|"),!0,!1).draw()}$("input[name=table_filter_active]").on("change",function(){i.column(1).search(this.value).draw()});$("#table_filter_search_text").keyup(function(){i.search($(this).val()).draw()});document.getElementById("table_filter_search_text_clear").addEventListener("click",function(){document.getElementById("table_filter_search_text").value="",i.search($(this).val()).draw()});
