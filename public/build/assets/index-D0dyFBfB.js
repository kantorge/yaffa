import"./dataTables.bootstrap5-C_qjeAEr.js";import"./responsive.bootstrap5-Ct7FWSHK.js";import{f as o,g as c,r as l}from"./dataTableHelper-DPRPCEc4.js";import{_ as t}from"./helpers-uU3f7Ngr.js";import"./app-QU5FfaO6.js";import"./tslib.es6-CZM0TROl.js";const d="#table";window.categories=window.categories.map(function(e){return e.transactions_min_date&&(e.transactions_min_date=new Date(e.transactions_min_date)),e.transactions_max_date&&(e.transactions_max_date=new Date(e.transactions_max_date)),e});const u=[{property:"transactions_count_total",value:0,negate:!1,errorMessage:t("It is already used in transactions.")},{property:"children_count",value:0,negate:!1,errorMessage:t("It has subcategories assigned.")},{property:"payees_defaulting_count",value:0,negate:!1,errorMessage:t("It is used as default category by some payees.")},{property:"payees_preferring_count",value:0,negate:!1,errorMessage:t("It is used as preferred category by some payees.")},{property:"payees_not_preferring_count",value:0,negate:!1,errorMessage:t("It is used as not preferred category by some payees.")}];window.table=$(d).DataTable({data:window.categories,columns:[{data:"name",title:t("Name")},{data:"parent",title:t("Parent category"),render:function(e,a){return a==="filter"?e?"_child_"+e.name:"_parent_":e?e.name:t("Not set")}},{data:"active",title:t("Active"),render:function(e,a){return o(e,a)},className:"text-center activeIcon"},{data:"transactions_count",title:t("Transactions"),render:function(e,a){return a==="display"?e>0?e:t("Never used"):e},type:"num"},{data:"transactions_min_date",title:t("First transaction"),render:function(e,a){return a==="display"?e?e.toLocaleDateString(window.YAFFA.locale):t("Never used"):e||null},type:"date"},{data:"transactions_max_date",title:t("Last transaction"),render:function(e,a){return a==="display"?e?e.toLocaleDateString(window.YAFFA.locale):t("Never used"):e||null},type:"date"},{data:"id",title:t("Actions"),render:function(e,a,n){return c(e,"edit","categories.edit")+l(n,u,t("This category cannot be deleted."))+'<a href="'+route("categories.merge.form",{categorySource:e})+'" class="btn btn-xs btn-primary" title="'+t("Merge into an other category")+'"><i class="fa fa-random"></i></a> '},className:"dt-nowrap",orderable:!1,searchable:!1}],createdRow:function(e,a){a.parent||$("td:eq(1)",e).addClass("text-muted text-italic"),a.transactions_count===0&&$("td:eq(3)",e).addClass("text-muted text-italic"),a.transactions_min_date||$("td:eq(4)",e).addClass("text-muted text-italic"),a.transactions_max_date||$("td:eq(5)",e).addClass("text-muted text-italic")},order:[[0,"asc"]],deferRender:!0,scrollY:"500px",scrollCollapse:!0,stateSave:!1,processing:!0,paging:!1,responsive:!0,initComplete:function(e){$(e.nTable).on("click","td.activeIcon > i",function(){var a=$(e.nTable).DataTable().row($(this).parents("tr"));if($(this).hasClass("fa-spinner"))return!1;$(this).removeClass().addClass("fa fa-spinner fa-spin"),$.ajax({type:"PUT",url:"/api/assets/category/"+a.data().id+"/active/"+(a.data().active?0:1),data:{_token:csrfToken},dataType:"json",context:this,success:function(n){categories.filter(s=>s.id===n.id)[0].active=n.active;let r=new CustomEvent("toast",{detail:{header:t("Success"),body:t("Category active state changed"),toastClass:"bg-success"}});window.dispatchEvent(r)},error:function(n){let r=new CustomEvent("toast",{detail:{header:t("Error"),body:t("Error while changing category active state."),toastClass:"bg-danger"}});window.dispatchEvent(r)},complete:function(n){a.invalidate()}})}),$(e.nTable).on("click","td > button.deleteIcon:not(.busy)",function(){if(!confirm(t("Are you sure to want to delete this item?")))return;let a=$(e.nTable).DataTable().row($(this).parents("tr")),n=$(this);n.addClass("busy"),$.ajax({type:"DELETE",url:window.route("api.category.destroy",a.data().id),data:{_token:csrfToken},dataType:"json",context:this,success:function(r){window.categories=window.categories.filter(i=>i.id!==r.category.id),a.remove().draw();let s=new CustomEvent("toast",{detail:{header:t("Success"),body:t("Category deleted"),toastClass:"bg-success"}});window.dispatchEvent(s)},error:function(r){let s=new CustomEvent("toast",{detail:{header:t("Error"),body:t("Error while trying to delete category: ")+r.responseJSON.error,toastClass:"bg-danger"}});window.dispatchEvent(s)},complete:function(r){n.removeClass("busy")}})})}});$("input[name=table_filter_active]").on("change",function(){table.column(2).search(this.value).draw()});$("#table_filter_search_text").keyup(function(){table.search($(this).val()).draw()});$("input[name=table_filter_category_level]").on("change",function(){this.value==="parents"?table.column(1).search("_parent_").draw():this.value==="children"?table.column(1).search("_child_").draw():table.column(1).search("").draw()});
