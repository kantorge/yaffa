var vt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);import{B as yt,z as gt}from"./app.1ea3d35e.js";var Hn=vt((Gn,pt)=>{var lt={exports:{}},H={},te={},xe={},Ke={};Object.defineProperty(Ke,"__esModule",{value:!0});function mt(t){for(var e=t.length,r=5381,n=52711,i;e--;)i=t.charCodeAt(e),r=r*33^i,n=n*33^i;return(r>>>0)*4096+(n>>>0)}var Oe="|",bt=/\[object ([HTML|SVG](.*)Element)\]/,_t={"[object Arguments]":0,"[object Array]":1,"[object ArrayBuffer]":2,"[object AsyncFunction]":3,"[object AsyncGeneratorFunction]":4,"[object BigInt]":5,"[object BigInt64Array]":6,"[object BigUint64Array]":7,"[object Boolean]":8,"[object DataView]":9,"[object Date]":10,"[object DocumentFragment]":11,"[object Error]":12,"[object Event]":13,"[object Float32Array]":14,"[object Float64Array]":15,"[object Function]":16,"[object Generator]":17,"[object GeneratorFunction]":18,"[object Int8Array]":19,"[object Int16Array]":20,"[object Map]":21,"[object Number]":22,"[object Object]":23,"[object Promise]":24,"[object RegExp]":25,"[object Set]":26,"[object SharedArrayBuffer]":27,"[object String]":28,"[object Uint8Array]":29,"[object Uint8ClampedArray]":30,"[object Uint16Array]":31,"[object Uint32Array]":32,"[object WeakMap]":33,"[object WeakRef]":34,"[object WeakSet]":35,CUSTOM:36,ELEMENT:37},wt={"[object Arguments]":1,"[object Array]":2},ct={"[object Generator]":1,"[object Promise]":2,"[object WeakMap]":3,"[object WeakRef]":4,"[object WeakSet]":5},Et={"[object AsyncFunction]":1,"[object AsyncGeneratorFunction]":2,"[object Boolean]":3,"[object Function]":4,"[object GeneratorFunction]":5,"[object Number]":6,"[object String]":7},Ot={"[object BigInt64Array]":1,"[object BigUint64Array]":2,"[object Float32Array]":3,"[object Float64Array]":4,"[object Int8Array]":5,"[object Int16Array]":6,"[object Uint8Array]":7,"[object Uint8ClampedArray]":8,"[object Uint16Array]":9,"[object Uint32Array]":10},xt={"[object Arguments]":1,"[object Array]":2,"[object ArrayBuffer]":3,"[object BigInt64Array]":4,"[object BigUint64Array]":5,"[object DataView]":6,"[object Float32Array]":7,"[object Float64Array]":8,"[object Int8Array]":9,"[object Int16Array]":10,"[object Map]":11,"[object Object]":12,"[object Set]":13,"[object SharedArrayBuffer]":14,"[object Uint8Array]":15,"[object Uint8ClampedArray]":16,"[object Uint16Array]":17,"[object Uint32Array]":18,CUSTOM:19},Ee={bigint:"i",boolean:"b",empty:"e",function:"g",number:"n",object:"o",string:"s",symbol:"s"};function At(t,e){return t[0]>e[0]}function ft(t,e){return t>e}function He(t,e){for(var r,n,i=0;i<t.length;++i){for(n=t[i],r=i-1;~r&&e(t[r],n);--r)t[r+1]=t[r];t[r+1]=n}return t}function V(t,e){return Ee.object+Oe+_t[t]+Oe+e}var rt=new WeakMap,jt=0;function Ve(t,e){var r=rt.get(t);if(r)return r;var n=V(e,"NOT_ENUMERABLE"+Oe+jt++);return rt.set(t,n),n}var Ct=Object.prototype.toString;function Pt(t,e,r){if(xt[e])return nt(e,t,r);if(e==="[object Date]")return V(e,t.getTime());if(e==="[object RegExp]")return V(e,t.toString());if(e==="[object Event]")return V(e,[t.bubbles,t.cancelBubble,t.cancelable,t.composed,t.currentTarget,t.defaultPrevented,t.eventPhase,t.isTrusted,t.returnValue,t.target,t.type].join());if(e==="[object Error]")return V(e,t.message+Oe+t.stack);if(e==="[object DocumentFragment]")return V(e,Dt(t));var n=e.match(bt);return n?V("ELEMENT",n[1]+Oe+t.outerHTML):ct[e]?Ve(t,e):Et[e]?V(e,t.toString()):nt("CUSTOM",t,r)}function nt(t,e,r){var n=r.cache.get(e);return n?V(t,"RECURSIVE~"+n):(r.cache.set(e,++r.id),t==="[object Object]"?e[Symbol.iterator]?Ve(e,t):V(t,ot(e,r)):wt[t]?V(t,Rt(e,r)):t==="[object Map]"?V(t,Mt(e,r)):t==="[object Set]"?V(t,Lt(e,r)):Ot[t]?V(t,e.join()):t==="[object ArrayBuffer]"?V(t,it(e)):t==="[object DataView]"?V(t,it(e.buffer)):ct[t]?Ve(e,t):V("CUSTOM",ot(e,r)))}function Rt(t,e){for(var r=t.length,n=new Array(r);--r>=0;)n[r]=ve(t[r],e);return n.join()}function St(t){return Buffer.from(t).toString("utf8")}function kt(t){return String.fromCharCode.apply(null,new Uint16Array(t))}function Ft(){return"UNSUPPORTED"}function Dt(t){for(var e=t.children,r=e.length,n=new Array(r);--r>=0;)n[r]=e[r].outerHTML;return n.join()}var it=typeof Buffer<"u"&&typeof Buffer.from=="function"?St:typeof Uint16Array=="function"?kt:Ft;function Mt(t,e){var r=new Array(t.size),n=0;for(t.forEach(function(i,s){r[n++]=[ve(s,e),ve(i,e)]}),He(r,At);--n>=0;)r[n]="["+r[n][0]+","+r[n][1]+"]";return"["+r.join()+"]"}function ot(t,e){for(var r=He(Object.getOwnPropertyNames(t),ft),n=r.length,i=new Array(n),s=n;--s>=0;)i[s]=r[s]+":"+ve(t[r[s]],e);return"{"+i.join()+"}"}function Lt(t,e){var r=new Array(t.size),n=0;return t.forEach(function(i){r[n++]=ve(i,e)}),"["+He(r,ft).join()+"]"}function ve(t,e){var r=typeof t;return t==null||r==="undefined"?Ee.empty+t:r==="object"?Pt(t,Ct.call(t),e||{cache:new WeakMap,id:1}):r==="function"||r==="symbol"?Ee[r]+t.toString():r==="boolean"?Ee.boolean+ +t:Ee[r]+t}function Tt(t){return mt(ve(t,void 0))}Ke.default=Tt;Object.defineProperty(xe,"__esModule",{value:!0});var It=function(){function t(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Nt=Ke,Ut=$t(Nt);function $t(t){return t&&t.__esModule?t:{default:t}}function Bt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var qe=function(){function t(e,r,n){Bt(this,t),this.id=e;var i={cache:!0};if(typeof n>"u"&&(n=i),typeof r!="function"?(this.value=r,this.type=this.constructor.CONSTANT):(this.calculationMethod=r,this.type=this.constructor.DYNAMIC),!this.id)throw new Error("factId required");return this.priority=parseInt(n.priority||1,10),this.options=Object.assign({},i,n),this.cacheKeyMethod=this.defaultCacheKeys,this}return It(t,[{key:"isConstant",value:function(){return this.type===this.constructor.CONSTANT}},{key:"isDynamic",value:function(){return this.type===this.constructor.DYNAMIC}},{key:"calculate",value:function(r,n){return Object.prototype.hasOwnProperty.call(this,"value")?this.value:this.calculationMethod(r,n)}},{key:"defaultCacheKeys",value:function(r,n){return{params:n,id:r}}},{key:"getCacheKey",value:function(r){if(this.options.cache===!0){var n=this.cacheKeyMethod(this.id,r),i=t.hashFromObject(n);return i}}}],[{key:"hashFromObject",value:function(r){return(0,Ut.default)(r)}}]),t}();qe.CONSTANT="CONSTANT";qe.DYNAMIC="DYNAMIC";xe.default=qe;var Re={},Se={},ue={};Object.defineProperty(ue,"__esModule",{value:!0});function Vt(){try{if(typeof process<"u"&&process.env&&{}.DEBUG&&{}.DEBUG.match(/json-rules-engine/)||typeof window<"u"&&window.localStorage&&window.localStorage.debug&&window.localStorage.debug.match(/json-rules-engine/))return console.debug.bind(console)}catch{}return function(){}}ue.default=Vt();Object.defineProperty(Se,"__esModule",{value:!0});var zt=function(){function t(e,r){var n=[],i=!0,s=!1,l=void 0;try{for(var p=e[Symbol.iterator](),g;!(i=(g=p.next()).done)&&(n.push(g.value),!(r&&n.length===r));i=!0);}catch(w){s=!0,l=w}finally{try{!i&&p.return&&p.return()}finally{if(s)throw l}}return n}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Kt=function(){function t(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Ht=ue,qt=Yt(Ht);function Yt(t){return t&&t.__esModule?t:{default:t}}function Xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Gt=function(){function t(e){if(Xt(this,t),!e)throw new Error("Condition: constructor options required");var r=t.booleanOperator(e);if(Object.assign(this,e),r){var n=e[r],i=Array.isArray(n);if(r!=="not"&&!i)throw new Error('"'+r+'" must be an array');if(r==="not"&&i)throw new Error('"'+r+'" cannot be an array');this.operator=r,this.priority=parseInt(e.priority,10)||1,i?this[r]=n.map(function(s){return new t(s)}):this[r]=new t(n)}else if(!Object.prototype.hasOwnProperty.call(e,"condition")){if(!Object.prototype.hasOwnProperty.call(e,"fact"))throw new Error('Condition: constructor "fact" property required');if(!Object.prototype.hasOwnProperty.call(e,"operator"))throw new Error('Condition: constructor "operator" property required');if(!Object.prototype.hasOwnProperty.call(e,"value"))throw new Error('Condition: constructor "value" property required');Object.prototype.hasOwnProperty.call(e,"priority")&&(e.priority=parseInt(e.priority,10))}}return Kt(t,[{key:"toJSON",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n={};this.priority&&(n.priority=this.priority),this.name&&(n.name=this.name);var i=t.booleanOperator(this);return i?Array.isArray(this[i])?n[i]=this[i].map(function(s){return s.toJSON(!1)}):n[i]=this[i].toJSON(!1):this.isConditionReference()?n.condition=this.condition:(n.operator=this.operator,n.value=this.value,n.fact=this.fact,this.factResult!==void 0&&(n.factResult=this.factResult),this.valueResult!==void 0&&(n.valueResult=this.valueResult),this.result!==void 0&&(n.result=this.result),this.params&&(n.params=this.params),this.path&&(n.path=this.path)),r?JSON.stringify(n):n}},{key:"evaluate",value:function(r,n){var i=this;if(!r)return Promise.reject(new Error("almanac required"));if(!n)return Promise.reject(new Error("operatorMap required"));if(this.isBooleanOperator())return Promise.reject(new Error("Cannot evaluate() a boolean condition"));var s=n.get(this.operator);return s?Promise.all([r.getValue(this.value),r.factValue(this.fact,this.params,this.path)]).then(function(l){var p=zt(l,2),g=p[0],w=p[1],O=s.evaluate(w,g);return(0,qt.default)("condition::evaluate",{leftHandSideValue:w,operator:i.operator,rightHandSideValue:g,result:O}),{result:O,leftHandSideValue:w,rightHandSideValue:g,operator:i.operator}}):Promise.reject(new Error("Unknown operator: "+this.operator))}},{key:"booleanOperator",value:function(){return t.booleanOperator(this)}},{key:"isBooleanOperator",value:function(){return t.booleanOperator(this)!==void 0}},{key:"isConditionReference",value:function(){return Object.prototype.hasOwnProperty.call(this,"condition")}}],[{key:"booleanOperator",value:function(r){if(Object.prototype.hasOwnProperty.call(r,"any"))return"any";if(Object.prototype.hasOwnProperty.call(r,"all"))return"all";if(Object.prototype.hasOwnProperty.call(r,"not"))return"not"}}]),t}();Se.default=Gt;var Ye={},Xe={exports:{}};(function(t){var e=function(){function r(x,_){return _!=null&&x instanceof _}var n;try{n=Map}catch{n=function(){}}var i;try{i=Set}catch{i=function(){}}var s;try{s=Promise}catch{s=function(){}}function l(x,_,C,E,k){typeof _=="object"&&(C=_.depth,E=_.prototype,k=_.includeNonEnumerable,_=_.circular);var F=[],I=[],q=typeof Buffer<"u";typeof _>"u"&&(_=!0),typeof C>"u"&&(C=1/0);function z(P,X){if(P===null)return null;if(X===0)return P;var D,W;if(typeof P!="object")return P;if(r(P,n))D=new n;else if(r(P,i))D=new i;else if(r(P,s))D=new s(function(J,o){P.then(function(a){J(z(a,X-1))},function(a){o(z(a,X-1))})});else if(l.__isArray(P))D=[];else if(l.__isRegExp(P))D=new RegExp(P.source,j(P)),P.lastIndex&&(D.lastIndex=P.lastIndex);else if(l.__isDate(P))D=new Date(P.getTime());else{if(q&&Buffer.isBuffer(P))return Buffer.allocUnsafe?D=Buffer.allocUnsafe(P.length):D=new Buffer(P.length),P.copy(D),D;r(P,Error)?D=Object.create(P):typeof E>"u"?(W=Object.getPrototypeOf(P),D=Object.create(W)):(D=Object.create(E),W=E)}if(_){var N=F.indexOf(P);if(N!=-1)return I[N];F.push(P),I.push(D)}r(P,n)&&P.forEach(function(J,o){var a=z(o,X-1),u=z(J,X-1);D.set(a,u)}),r(P,i)&&P.forEach(function(J){var o=z(J,X-1);D.add(o)});for(var G in P){var ce;W&&(ce=Object.getOwnPropertyDescriptor(W,G)),!(ce&&ce.set==null)&&(D[G]=z(P[G],X-1))}if(Object.getOwnPropertySymbols)for(var fe=Object.getOwnPropertySymbols(P),G=0;G<fe.length;G++){var ae=fe[G],ie=Object.getOwnPropertyDescriptor(P,ae);ie&&!ie.enumerable&&!k||(D[ae]=z(P[ae],X-1),ie.enumerable||Object.defineProperty(D,ae,{enumerable:!1}))}if(k)for(var R=Object.getOwnPropertyNames(P),G=0;G<R.length;G++){var he=R[G],ie=Object.getOwnPropertyDescriptor(P,he);ie&&ie.enumerable||(D[he]=z(P[he],X-1),Object.defineProperty(D,he,{enumerable:!1}))}return D}return z(x,C)}l.clonePrototype=function(_){if(_===null)return null;var C=function(){};return C.prototype=_,new C};function p(x){return Object.prototype.toString.call(x)}l.__objToStr=p;function g(x){return typeof x=="object"&&p(x)==="[object Date]"}l.__isDate=g;function w(x){return typeof x=="object"&&p(x)==="[object Array]"}l.__isArray=w;function O(x){return typeof x=="object"&&p(x)==="[object RegExp]"}l.__isRegExp=O;function j(x){var _="";return x.global&&(_+="g"),x.ignoreCase&&(_+="i"),x.multiline&&(_+="m"),_}return l.__getRegExpFlags=j,l}();t.exports&&(t.exports=e)})(Xe);Object.defineProperty(Ye,"__esModule",{value:!0});var Wt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qt=function(){function t(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Zt=Xe.exports,Ce=Jt(Zt);function Jt(t){return t&&t.__esModule?t:{default:t}}function er(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var tr=function(){function t(e,r,n,i){er(this,t),this.conditions=(0,Ce.default)(e),this.event=(0,Ce.default)(r),this.priority=(0,Ce.default)(n),this.name=(0,Ce.default)(i),this.result=null}return Qt(t,[{key:"setResult",value:function(r){this.result=r}},{key:"resolveEventParams",value:function(r){var n=this;if(this.event.params!==null&&Wt(this.event.params)==="object"){var i=[],s=function(g){Object.prototype.hasOwnProperty.call(n.event.params,g)&&i.push(r.getValue(n.event.params[g]).then(function(w){return n.event.params[g]=w}))};for(var l in this.event.params)s(l);return Promise.all(i)}return Promise.resolve()}},{key:"toJSON",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n={conditions:this.conditions.toJSON(!1),event:this.event,priority:this.priority,name:this.name,result:this.result};return r?JSON.stringify(n):n}}]),t}();Ye.default=tr;var Ge={exports:{}};/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */(function(t,e){(function(r){var n=Object.hasOwnProperty,i=Array.isArray?Array.isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},s=10,l=typeof process=="object"&&typeof process.nextTick=="function",p=typeof Symbol=="function",g=typeof Reflect=="object",w=typeof setImmediate=="function",O=w?setImmediate:setTimeout,j=p?g&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(o){var a=Object.getOwnPropertyNames(o);return a.push.apply(a,Object.getOwnPropertySymbols(o)),a}:Object.keys;function x(){this._events={},this._conf&&_.call(this,this._conf)}function _(o){o&&(this._conf=o,o.delimiter&&(this.delimiter=o.delimiter),o.maxListeners!==r&&(this._maxListeners=o.maxListeners),o.wildcard&&(this.wildcard=o.wildcard),o.newListener&&(this._newListener=o.newListener),o.removeListener&&(this._removeListener=o.removeListener),o.verboseMemoryLeak&&(this.verboseMemoryLeak=o.verboseMemoryLeak),o.ignoreErrors&&(this.ignoreErrors=o.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function C(o,a){var u="(node) warning: possible EventEmitter memory leak detected. "+o+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(u+=" Event name: "+a+"."),typeof process<"u"&&process.emitWarning){var c=new Error(u);c.name="MaxListenersExceededWarning",c.emitter=this,c.count=o,process.emitWarning(c)}else console.error(u),console.trace&&console.trace()}var E=function(o,a,u){var c=arguments.length;switch(c){case 0:return[];case 1:return[o];case 2:return[o,a];case 3:return[o,a,u];default:for(var h=new Array(c);c--;)h[c]=arguments[c];return h}};function k(o,a){for(var u={},c,h=o.length,d=a?a.length:0,v=0;v<h;v++)c=o[v],u[c]=v<d?a[v]:r;return u}function F(o,a,u){this._emitter=o,this._target=a,this._listeners={},this._listenersCount=0;var c,h;if((u.on||u.off)&&(c=u.on,h=u.off),a.addEventListener?(c=a.addEventListener,h=a.removeEventListener):a.addListener?(c=a.addListener,h=a.removeListener):a.on&&(c=a.on,h=a.off),!c&&!h)throw Error("target does not implement any known event API");if(typeof c!="function")throw TypeError("on method must be a function");if(typeof h!="function")throw TypeError("off method must be a function");this._on=c,this._off=h;var d=o._observers;d?d.push(this):o._observers=[this]}Object.assign(F.prototype,{subscribe:function(o,a,u){var c=this,h=this._target,d=this._emitter,v=this._listeners,b=function(){var y=E.apply(null,arguments),m={data:y,name:a,original:o};if(u){var A=u.call(h,m);A!==!1&&d.emit.apply(d,[m.name].concat(y));return}d.emit.apply(d,[a].concat(y))};if(v[o])throw Error("Event '"+o+"' is already listening");this._listenersCount++,d._newListener&&d._removeListener&&!c._onNewListener?(this._onNewListener=function(y){y===a&&v[o]===null&&(v[o]=b,c._on.call(h,o,b))},d.on("newListener",this._onNewListener),this._onRemoveListener=function(y){y===a&&!d.hasListeners(y)&&v[o]&&(v[o]=null,c._off.call(h,o,b))},v[o]=null,d.on("removeListener",this._onRemoveListener)):(v[o]=b,c._on.call(h,o,b))},unsubscribe:function(o){var a=this,u=this._listeners,c=this._emitter,h,d,v=this._off,b=this._target,y;if(o&&typeof o!="string")throw TypeError("event must be a string");function m(){a._onNewListener&&(c.off("newListener",a._onNewListener),c.off("removeListener",a._onRemoveListener),a._onNewListener=null,a._onRemoveListener=null);var A=W.call(c,a);c._observers.splice(A,1)}if(o){if(h=u[o],!h)return;v.call(b,o,h),delete u[o],--this._listenersCount||m()}else{for(d=j(u),y=d.length;y-- >0;)o=d[y],v.call(b,o,u[o]);this._listeners={},this._listenersCount=0,m()}}});function I(o,a,u,c){var h=Object.assign({},a);if(!o)return h;if(typeof o!="object")throw TypeError("options must be an object");var d=Object.keys(o),v=d.length,b,y,m;function A(M){throw Error('Invalid "'+b+'" option value'+(M?". Reason: "+M:""))}for(var B=0;B<v;B++){if(b=d[B],!c&&!n.call(a,b))throw Error('Unknown "'+b+'" option');y=o[b],y!==r&&(m=u[b],h[b]=m?m(y,A):y)}return h}function q(o,a){return(typeof o!="function"||!o.hasOwnProperty("prototype"))&&a("value must be a constructor"),o}function z(o){var a="value must be type of "+o.join("|"),u=o.length,c=o[0],h=o[1];return u===1?function(d,v){if(typeof d===c)return d;v(a)}:u===2?function(d,v){var b=typeof d;if(b===c||b===h)return d;v(a)}:function(d,v){for(var b=typeof d,y=u;y-- >0;)if(b===o[y])return d;v(a)}}var P=z(["function"]),X=z(["object","function"]);function D(o,a,u){var c,h,d=0,v,b=new o(function(y,m,A){u=I(u,{timeout:0,overload:!1},{timeout:function(U,K){return U*=1,(typeof U!="number"||U<0||!Number.isFinite(U))&&K("timeout must be a positive number"),U}}),c=!u.overload&&typeof o.prototype.cancel=="function"&&typeof A=="function";function B(){h&&(h=null),d&&(clearTimeout(d),d=0)}var M=function(U){B(),y(U)},L=function(U){B(),m(U)};c?a(M,L,A):(h=[function(U){L(U||Error("canceled"))}],a(M,L,function(U){if(v)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof U!="function")throw TypeError("onCancel callback must be a function");h.push(U)}),v=!0),u.timeout>0&&(d=setTimeout(function(){var U=Error("timeout");U.code="ETIMEDOUT",d=0,b.cancel(U),m(U)},u.timeout))});return c||(b.cancel=function(y){if(!!h){for(var m=h.length,A=1;A<m;A++)h[A](y);h[0](y),h=null}}),b}function W(o){var a=this._observers;if(!a)return-1;for(var u=a.length,c=0;c<u;c++)if(a[c]._target===o)return c;return-1}function N(o,a,u,c,h){if(!u)return null;if(c===0){var d=typeof a;if(d==="string"){var v,b,y=0,m=0,A=this.delimiter,B=A.length;if((b=a.indexOf(A))!==-1){v=new Array(5);do v[y++]=a.slice(m,b),m=b+B;while((b=a.indexOf(A,m))!==-1);v[y++]=a.slice(m),a=v,h=y}else a=[a],h=1}else d==="object"?h=a.length:(a=[a],h=1)}var M=null,L,U,K,De,Me,_e=a[c],Le=a[c+1],ee,Y;if(c===h)u._listeners&&(typeof u._listeners=="function"?(o&&o.push(u._listeners),M=[u]):(o&&o.push.apply(o,u._listeners),M=[u]));else if(_e==="*"){for(ee=j(u),b=ee.length;b-- >0;)L=ee[b],L!=="_listeners"&&(Y=N(o,a,u[L],c+1,h),Y&&(M?M.push.apply(M,Y):M=Y));return M}else if(_e==="**"){for(Me=c+1===h||c+2===h&&Le==="*",Me&&u._listeners&&(M=N(o,a,u,h,h)),ee=j(u),b=ee.length;b-- >0;)L=ee[b],L!=="_listeners"&&(L==="*"||L==="**"?(u[L]._listeners&&!Me&&(Y=N(o,a,u[L],h,h),Y&&(M?M.push.apply(M,Y):M=Y)),Y=N(o,a,u[L],c,h)):L===Le?Y=N(o,a,u[L],c+2,h):Y=N(o,a,u[L],c,h),Y&&(M?M.push.apply(M,Y):M=Y));return M}else u[_e]&&(M=N(o,a,u[_e],c+1,h));if(U=u["*"],U&&N(o,a,U,c+1,h),K=u["**"],K)if(c<h)for(K._listeners&&N(o,a,K,h,h),ee=j(K),b=ee.length;b-- >0;)L=ee[b],L!=="_listeners"&&(L===Le?N(o,a,K[L],c+2,h):L===_e?N(o,a,K[L],c+1,h):(De={},De[L]=K[L],N(o,a,{"**":De},c+1,h)));else K._listeners?N(o,a,K,h,h):K["*"]&&K["*"]._listeners&&N(o,a,K["*"],h,h);return M}function G(o,a,u){var c=0,h=0,d,v=this.delimiter,b=v.length,y;if(typeof o=="string")if((d=o.indexOf(v))!==-1){y=new Array(5);do y[c++]=o.slice(h,d),h=d+b;while((d=o.indexOf(v,h))!==-1);y[c++]=o.slice(h)}else y=[o],c=1;else y=o,c=o.length;if(c>1){for(d=0;d+1<c;d++)if(y[d]==="**"&&y[d+1]==="**")return}var m=this.listenerTree,A;for(d=0;d<c;d++)if(A=y[d],m=m[A]||(m[A]={}),d===c-1)return m._listeners?(typeof m._listeners=="function"&&(m._listeners=[m._listeners]),u?m._listeners.unshift(a):m._listeners.push(a),!m._listeners.warned&&this._maxListeners>0&&m._listeners.length>this._maxListeners&&(m._listeners.warned=!0,C.call(this,m._listeners.length,A))):m._listeners=a,!0;return!0}function ce(o,a,u,c){for(var h=j(o),d=h.length,v,b,y,m=o._listeners,A;d-- >0;)b=h[d],v=o[b],b==="_listeners"?y=u:y=u?u.concat(b):[b],A=c||typeof b=="symbol",m&&a.push(A?y:y.join(this.delimiter)),typeof v=="object"&&ce.call(this,v,a,y,A);return a}function fe(o){for(var a=j(o),u=a.length,c,h,d;u-- >0;)h=a[u],c=o[h],c&&(d=!0,h!=="_listeners"&&!fe(c)&&delete o[h]);return d}function ae(o,a,u){this.emitter=o,this.event=a,this.listener=u}ae.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function ie(o,a,u){if(u===!0)h=!0;else if(u===!1)c=!0;else{if(!u||typeof u!="object")throw TypeError("options should be an object or true");var c=u.async,h=u.promisify,d=u.nextTick,v=u.objectify}if(c||d||h){var b=a,y=a._origin||a;if(d&&!l)throw Error("process.nextTick is not supported");h===r&&(h=a.constructor.name==="AsyncFunction"),a=function(){var m=arguments,A=this,B=this.event;return h?d?Promise.resolve():new Promise(function(M){O(M)}).then(function(){return A.event=B,b.apply(A,m)}):(d?process.nextTick:O)(function(){A.event=B,b.apply(A,m)})},a._async=!0,a._origin=y}return[a,v?new ae(this,o,a):this]}function R(o){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,_.call(this,o)}R.EventEmitter2=R,R.prototype.listenTo=function(o,a,u){if(typeof o!="object")throw TypeError("target musts be an object");var c=this;u=I(u,{on:r,off:r,reducers:r},{on:P,off:P,reducers:X});function h(d){if(typeof d!="object")throw TypeError("events must be an object");var v=u.reducers,b=W.call(c,o),y;b===-1?y=new F(c,o,u):y=c._observers[b];for(var m=j(d),A=m.length,B,M=typeof v=="function",L=0;L<A;L++)B=m[L],y.subscribe(B,d[B]||B,M?v:v&&v[B])}return i(a)?h(k(a)):h(typeof a=="string"?k(a.split(/\s+/)):a),this},R.prototype.stopListeningTo=function(o,a){var u=this._observers;if(!u)return!1;var c=u.length,h,d=!1;if(o&&typeof o!="object")throw TypeError("target should be an object");for(;c-- >0;)h=u[c],(!o||h._target===o)&&(h.unsubscribe(a),d=!0);return d},R.prototype.delimiter=".",R.prototype.setMaxListeners=function(o){o!==r&&(this._maxListeners=o,this._conf||(this._conf={}),this._conf.maxListeners=o)},R.prototype.getMaxListeners=function(){return this._maxListeners},R.prototype.event="",R.prototype.once=function(o,a,u){return this._once(o,a,!1,u)},R.prototype.prependOnceListener=function(o,a,u){return this._once(o,a,!0,u)},R.prototype._once=function(o,a,u,c){return this._many(o,1,a,u,c)},R.prototype.many=function(o,a,u,c){return this._many(o,a,u,!1,c)},R.prototype.prependMany=function(o,a,u,c){return this._many(o,a,u,!0,c)},R.prototype._many=function(o,a,u,c,h){var d=this;if(typeof u!="function")throw new Error("many only accepts instances of Function");function v(){return--a===0&&d.off(o,v),u.apply(this,arguments)}return v._origin=u,this._on(o,v,c,h)},R.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||x.call(this);var o=arguments[0],a,u=this.wildcard,c,h,d,v,b;if(o==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(u&&(a=o,o!=="newListener"&&o!=="removeListener"&&typeof o=="object")){if(h=o.length,p){for(d=0;d<h;d++)if(typeof o[d]=="symbol"){b=!0;break}}b||(o=o.join(this.delimiter))}var y=arguments.length,m;if(this._all&&this._all.length)for(m=this._all.slice(),d=0,h=m.length;d<h;d++)switch(this.event=o,y){case 1:m[d].call(this,o);break;case 2:m[d].call(this,o,arguments[1]);break;case 3:m[d].call(this,o,arguments[1],arguments[2]);break;default:m[d].apply(this,arguments)}if(u)m=[],N.call(this,m,a,this.listenerTree,0,h);else if(m=this._events[o],typeof m=="function"){switch(this.event=o,y){case 1:m.call(this);break;case 2:m.call(this,arguments[1]);break;case 3:m.call(this,arguments[1],arguments[2]);break;default:for(c=new Array(y-1),v=1;v<y;v++)c[v-1]=arguments[v];m.apply(this,c)}return!0}else m&&(m=m.slice());if(m&&m.length){if(y>3)for(c=new Array(y-1),v=1;v<y;v++)c[v-1]=arguments[v];for(d=0,h=m.length;d<h;d++)switch(this.event=o,y){case 1:m[d].call(this);break;case 2:m[d].call(this,arguments[1]);break;case 3:m[d].call(this,arguments[1],arguments[2]);break;default:m[d].apply(this,c)}return!0}else if(!this.ignoreErrors&&!this._all&&o==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},R.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||x.call(this);var o=arguments[0],a=this.wildcard,u,c,h,d,v,b;if(o==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(a&&(u=o,o!=="newListener"&&o!=="removeListener"&&typeof o=="object")){if(d=o.length,p){for(v=0;v<d;v++)if(typeof o[v]=="symbol"){c=!0;break}}c||(o=o.join(this.delimiter))}var y=[],m=arguments.length,A;if(this._all)for(v=0,d=this._all.length;v<d;v++)switch(this.event=o,m){case 1:y.push(this._all[v].call(this,o));break;case 2:y.push(this._all[v].call(this,o,arguments[1]));break;case 3:y.push(this._all[v].call(this,o,arguments[1],arguments[2]));break;default:y.push(this._all[v].apply(this,arguments))}if(a?(A=[],N.call(this,A,u,this.listenerTree,0)):A=this._events[o],typeof A=="function")switch(this.event=o,m){case 1:y.push(A.call(this));break;case 2:y.push(A.call(this,arguments[1]));break;case 3:y.push(A.call(this,arguments[1],arguments[2]));break;default:for(h=new Array(m-1),b=1;b<m;b++)h[b-1]=arguments[b];y.push(A.apply(this,h))}else if(A&&A.length){if(A=A.slice(),m>3)for(h=new Array(m-1),b=1;b<m;b++)h[b-1]=arguments[b];for(v=0,d=A.length;v<d;v++)switch(this.event=o,m){case 1:y.push(A[v].call(this));break;case 2:y.push(A[v].call(this,arguments[1]));break;case 3:y.push(A[v].call(this,arguments[1],arguments[2]));break;default:y.push(A[v].apply(this,h))}}else if(!this.ignoreErrors&&!this._all&&o==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(y)},R.prototype.on=function(o,a,u){return this._on(o,a,!1,u)},R.prototype.prependListener=function(o,a,u){return this._on(o,a,!0,u)},R.prototype.onAny=function(o){return this._onAny(o,!1)},R.prototype.prependAny=function(o){return this._onAny(o,!0)},R.prototype.addListener=R.prototype.on,R.prototype._onAny=function(o,a){if(typeof o!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),a?this._all.unshift(o):this._all.push(o),this},R.prototype._on=function(o,a,u,c){if(typeof o=="function")return this._onAny(o,a),this;if(typeof a!="function")throw new Error("on only accepts instances of Function");this._events||x.call(this);var h=this,d;return c!==r&&(d=ie.call(this,o,a,c),a=d[0],h=d[1]),this._newListener&&this.emit("newListener",o,a),this.wildcard?(G.call(this,o,a,u),h):(this._events[o]?(typeof this._events[o]=="function"&&(this._events[o]=[this._events[o]]),u?this._events[o].unshift(a):this._events[o].push(a),!this._events[o].warned&&this._maxListeners>0&&this._events[o].length>this._maxListeners&&(this._events[o].warned=!0,C.call(this,this._events[o].length,o))):this._events[o]=a,h)},R.prototype.off=function(o,a){if(typeof a!="function")throw new Error("removeListener only takes instances of Function");var u,c=[];if(this.wildcard){var h=typeof o=="string"?o.split(this.delimiter):o.slice();if(c=N.call(this,null,h,this.listenerTree,0),!c)return this}else{if(!this._events[o])return this;u=this._events[o],c.push({_listeners:u})}for(var d=0;d<c.length;d++){var v=c[d];if(u=v._listeners,i(u)){for(var b=-1,y=0,m=u.length;y<m;y++)if(u[y]===a||u[y].listener&&u[y].listener===a||u[y]._origin&&u[y]._origin===a){b=y;break}if(b<0)continue;return this.wildcard?v._listeners.splice(b,1):this._events[o].splice(b,1),u.length===0&&(this.wildcard?delete v._listeners:delete this._events[o]),this._removeListener&&this.emit("removeListener",o,a),this}else(u===a||u.listener&&u.listener===a||u._origin&&u._origin===a)&&(this.wildcard?delete v._listeners:delete this._events[o],this._removeListener&&this.emit("removeListener",o,a))}return this.listenerTree&&fe(this.listenerTree),this},R.prototype.offAny=function(o){var a=0,u=0,c;if(o&&this._all&&this._all.length>0){for(c=this._all,a=0,u=c.length;a<u;a++)if(o===c[a])return c.splice(a,1),this._removeListener&&this.emit("removeListenerAny",o),this}else{if(c=this._all,this._removeListener)for(a=0,u=c.length;a<u;a++)this.emit("removeListenerAny",c[a]);this._all=[]}return this},R.prototype.removeListener=R.prototype.off,R.prototype.removeAllListeners=function(o){if(o===r)return!this._events||x.call(this),this;if(this.wildcard){var a=N.call(this,null,o,this.listenerTree,0),u,c;if(!a)return this;for(c=0;c<a.length;c++)u=a[c],u._listeners=null;this.listenerTree&&fe(this.listenerTree)}else this._events&&(this._events[o]=null);return this},R.prototype.listeners=function(o){var a=this._events,u,c,h,d,v;if(o===r){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!a)return[];for(u=j(a),d=u.length,h=[];d-- >0;)c=a[u[d]],typeof c=="function"?h.push(c):h.push.apply(h,c);return h}else{if(this.wildcard){if(v=this.listenerTree,!v)return[];var b=[],y=typeof o=="string"?o.split(this.delimiter):o.slice();return N.call(this,b,y,v,0),b}return a?(c=a[o],c?typeof c=="function"?[c]:c:[]):[]}},R.prototype.eventNames=function(o){var a=this._events;return this.wildcard?ce.call(this,this.listenerTree,[],null,o):a?j(a):[]},R.prototype.listenerCount=function(o){return this.listeners(o).length},R.prototype.hasListeners=function(o){if(this.wildcard){var a=[],u=typeof o=="string"?o.split(this.delimiter):o.slice();return N.call(this,a,u,this.listenerTree,0),a.length>0}var c=this._events,h=this._all;return!!(h&&h.length||c&&(o===r?j(c).length:c[o]))},R.prototype.listenersAny=function(){return this._all?this._all:[]},R.prototype.waitFor=function(o,a){var u=this,c=typeof a;return c==="number"?a={timeout:a}:c==="function"&&(a={filter:a}),a=I(a,{timeout:0,filter:r,handleError:!1,Promise,overload:!1},{filter:P,Promise:q}),D(a.Promise,function(h,d,v){function b(){var y=a.filter;if(!(y&&!y.apply(u,arguments)))if(u.off(o,b),a.handleError){var m=arguments[0];m?d(m):h(E.apply(null,arguments).slice(1))}else h(E.apply(null,arguments))}v(function(){u.off(o,b)}),u._on(o,b,!1)},{timeout:a.timeout,overload:a.overload})};function he(o,a,u){u=I(u,{Promise,timeout:0,overload:!1},{Promise:q});var c=u.Promise;return D(c,function(h,d,v){var b;if(typeof o.addEventListener=="function"){b=function(){h(E.apply(null,arguments))},v(function(){o.removeEventListener(a,b)}),o.addEventListener(a,b,{once:!0});return}var y=function(){m&&o.removeListener("error",m),h(E.apply(null,arguments))},m;a!=="error"&&(m=function(A){o.removeListener(a,y),d(A)},o.once("error",m)),v(function(){m&&o.removeListener("error",m),o.removeListener(a,y)}),o.once(a,y)},{timeout:u.timeout,overload:u.overload})}var J=R.prototype;Object.defineProperties(R,{defaultMaxListeners:{get:function(){return J._maxListeners},set:function(o){if(typeof o!="number"||o<0||Number.isNaN(o))throw TypeError("n must be a non-negative number");J._maxListeners=o},enumerable:!0},once:{value:he,writable:!0,configurable:!0}}),Object.defineProperties(J,{_maxListeners:{value:s,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),typeof r=="function"&&r.amd?r(function(){return R}):t.exports=R})()})(Ge);Object.defineProperty(Re,"__esModule",{value:!0});var rr=function(){function t(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),nr=Se,ir=Ae(nr),or=Ye,ar=Ae(or),sr=ue,ur=Ae(sr),lr=Xe.exports,cr=Ae(lr),fr=Ge.exports,hr=Ae(fr);function Ae(t){return t&&t.__esModule?t:{default:t}}function dr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pr(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function vr(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var yr=function(t){vr(e,t);function e(r){dr(this,e);var n=pr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));typeof r=="string"&&(r=JSON.parse(r)),r&&r.conditions&&n.setConditions(r.conditions),r&&r.onSuccess&&n.on("success",r.onSuccess),r&&r.onFailure&&n.on("failure",r.onFailure),r&&(r.name||r.name===0)&&n.setName(r.name);var i=r&&r.priority||1;n.setPriority(i);var s=r&&r.event||{type:"unknown"};return n.setEvent(s),n}return rr(e,[{key:"setPriority",value:function(n){if(n=parseInt(n,10),n<=0)throw new Error("Priority must be greater than zero");return this.priority=n,this}},{key:"setName",value:function(n){if(!n&&n!==0)throw new Error('Rule "name" must be defined');return this.name=n,this}},{key:"setConditions",value:function(n){if(!Object.prototype.hasOwnProperty.call(n,"all")&&!Object.prototype.hasOwnProperty.call(n,"any")&&!Object.prototype.hasOwnProperty.call(n,"not")&&!Object.prototype.hasOwnProperty.call(n,"condition"))throw new Error('"conditions" root must contain a single instance of "all", "any", "not", or "condition"');return this.conditions=new ir.default(n),this}},{key:"setEvent",value:function(n){if(!n)throw new Error("Rule: setEvent() requires event object");if(!Object.prototype.hasOwnProperty.call(n,"type"))throw new Error('Rule: setEvent() requires event object with "type" property');return this.ruleEvent={type:n.type},this.event=this.ruleEvent,n.params&&(this.ruleEvent.params=n.params),this}},{key:"getEvent",value:function(){return this.ruleEvent}},{key:"getPriority",value:function(){return this.priority}},{key:"getConditions",value:function(){return this.conditions}},{key:"getEngine",value:function(){return this.engine}},{key:"setEngine",value:function(n){return this.engine=n,this}},{key:"toJSON",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i={conditions:this.conditions.toJSON(!1),priority:this.priority,event:this.ruleEvent,name:this.name};return n?JSON.stringify(i):i}},{key:"prioritizeConditions",value:function(n){var i=this,s=n.reduce(function(l,p){var g=p.priority;if(!g){var w=i.engine.getFact(p.fact);g=w&&w.priority||1}return l[g]||(l[g]=[]),l[g].push(p),l},{});return Object.keys(s).sort(function(l,p){return Number(l)>Number(p)?-1:1}).map(function(l){return s[l]})}},{key:"evaluate",value:function(n){var i=this,s=new ar.default(this.conditions,this.ruleEvent,this.priority,this.name),l=function(E){if(E.isConditionReference())return x(E);if(E.isBooleanOperator()){var k=E[E.operator],F=void 0;return E.operator==="all"?F=O(k):E.operator==="any"?F=w(k):F=j(k),F.then(function(I){var q=I===!0;return E.result=q,q})}else return E.evaluate(n,i.engine.operators).then(function(I){var q=I.result;return E.factResult=I.leftHandSideValue,E.valueResult=I.rightHandSideValue,E.result=q,q})},p=function(E,k){return Array.isArray(E)||(E=[E]),Promise.all(E.map(function(F){return l(F)})).then(function(F){return(0,ur.default)("rule::evaluateConditions",{results:F}),k.call(F,function(I){return I===!0})})},g=function(E,k){if(E.length===0)return Promise.resolve(!0);if(E.length===1)return l(E[0]);for(var F=i.prioritizeConditions(E),I=Promise.resolve(k==="all"),q=function(X){var D=F[X];I=I.then(function(W){return k==="any"?W||p(D,Array.prototype.some):W&&p(D,Array.prototype.every)})},z=0;z<F.length;z++)q(z);return I},w=function(E){return g(E,"any")},O=function(E){return g(E,"all")},j=function(E){return g([E],"not").then(function(k){return!k})},x=function(E){var k=i.engine.conditions.get(E.condition);if(k)return delete E.condition,Object.assign(E,(0,cr.default)(k)),l(E);if(i.engine.allowUndefinedConditions)return E.result=!1,Promise.resolve(!1);throw new Error("No condition "+E.condition+" exists")},_=function(E){s.setResult(E);var k=Promise.resolve();i.engine.replaceFactsInEventParams&&(k=s.resolveEventParams(n));var F=E?"success":"failure";return k.then(function(){return i.emitAsync(F,s.event,n,s)}).then(function(){return s})};return s.conditions.any?w(s.conditions.any).then(function(C){return _(C)}):s.conditions.all?O(s.conditions.all).then(function(C){return _(C)}):s.conditions.not?j(s.conditions.not).then(function(C){return _(C)}):x(s.conditions).then(function(C){return _(C)})}}]),e}(hr.default);Re.default=yr;var ke={},We={};Object.defineProperty(We,"__esModule",{value:!0});function gr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mr(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function br(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}We.UndefinedFactError=function(t){br(e,t);function e(){var r;gr(this,e);for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];var l=mr(this,(r=e.__proto__||Object.getPrototypeOf(e)).call.apply(r,[this].concat(i)));return l.code="UNDEFINED_FACT",l}return e}(Error);class _r{add(e,r,n){if(typeof arguments[0]!="string")for(let i in arguments[0])this.add(i,arguments[0][i],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(i){this[i]=this[i]||[],r&&this[i][n?"unshift":"push"](r)},this)}run(e,r){this[e]=this[e]||[],this[e].forEach(function(n){n.call(r&&r.context?r.context:r,r)})}}class wr{constructor(e){this.jsep=e,this.registered={}}register(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];r.forEach(i=>{if(typeof i!="object"||!i.name||!i.init)throw new Error("Invalid JSEP plugin format");this.registered[i.name]||(i.init(this.jsep),this.registered[i.name]=i)})}}class f{static get version(){return"1.4.0"}static toString(){return"JavaScript Expression Parser (JSEP) v"+f.version}static addUnaryOp(e){return f.max_unop_len=Math.max(e.length,f.max_unop_len),f.unary_ops[e]=1,f}static addBinaryOp(e,r,n){return f.max_binop_len=Math.max(e.length,f.max_binop_len),f.binary_ops[e]=r,n?f.right_associative.add(e):f.right_associative.delete(e),f}static addIdentifierChar(e){return f.additional_identifier_chars.add(e),f}static addLiteral(e,r){return f.literals[e]=r,f}static removeUnaryOp(e){return delete f.unary_ops[e],e.length===f.max_unop_len&&(f.max_unop_len=f.getMaxKeyLen(f.unary_ops)),f}static removeAllUnaryOps(){return f.unary_ops={},f.max_unop_len=0,f}static removeIdentifierChar(e){return f.additional_identifier_chars.delete(e),f}static removeBinaryOp(e){return delete f.binary_ops[e],e.length===f.max_binop_len&&(f.max_binop_len=f.getMaxKeyLen(f.binary_ops)),f.right_associative.delete(e),f}static removeAllBinaryOps(){return f.binary_ops={},f.max_binop_len=0,f}static removeLiteral(e){return delete f.literals[e],f}static removeAllLiterals(){return f.literals={},f}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new f(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(r=>r.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return f.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!f.binary_ops[String.fromCharCode(e)]||f.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return f.isIdentifierStart(e)||f.isDecimalDigit(e)}throwError(e){const r=new Error(e+" at character "+this.index);throw r.index=this.index,r.description=e,r}runHook(e,r){if(f.hooks[e]){const n={context:this,node:r};return f.hooks.run(e,n),n.node}return r}searchHook(e){if(f.hooks[e]){const r={context:this};return f.hooks[e].find(function(n){return n.call(r.context,r),r.node}),r.node}}gobbleSpaces(){let e=this.code;for(;e===f.SPACE_CODE||e===f.TAB_CODE||e===f.LF_CODE||e===f.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");const e=this.gobbleExpressions(),r=e.length===1?e[0]:{type:f.COMPOUND,body:e};return this.runHook("after-all",r)}gobbleExpressions(e){let r=[],n,i;for(;this.index<this.expr.length;)if(n=this.code,n===f.SEMCOL_CODE||n===f.COMMA_CODE)this.index++;else if(i=this.gobbleExpression())r.push(i);else if(this.index<this.expr.length){if(n===e)break;this.throwError('Unexpected "'+this.char+'"')}return r}gobbleExpression(){const e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,f.max_binop_len),r=e.length;for(;r>0;){if(f.binary_ops.hasOwnProperty(e)&&(!f.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!f.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=r,e;e=e.substr(0,--r)}return!1}gobbleBinaryExpression(){let e,r,n,i,s,l,p,g,w;if(l=this.gobbleToken(),!l||(r=this.gobbleBinaryOp(),!r))return l;for(s={value:r,prec:f.binaryPrecedence(r),right_a:f.right_associative.has(r)},p=this.gobbleToken(),p||this.throwError("Expected expression after "+r),i=[l,s,p];r=this.gobbleBinaryOp();){if(n=f.binaryPrecedence(r),n===0){this.index-=r.length;break}s={value:r,prec:n,right_a:f.right_associative.has(r)},w=r;const O=j=>s.right_a&&j.right_a?n>j.prec:n<=j.prec;for(;i.length>2&&O(i[i.length-2]);)p=i.pop(),r=i.pop().value,l=i.pop(),e={type:f.BINARY_EXP,operator:r,left:l,right:p},i.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+w),i.push(s,e)}for(g=i.length-1,e=i[g];g>1;)e={type:f.BINARY_EXP,operator:i[g-1].value,left:i[g-2],right:e},g-=2;return e}gobbleToken(){let e,r,n,i;if(this.gobbleSpaces(),i=this.searchHook("gobble-token"),i)return this.runHook("after-token",i);if(e=this.code,f.isDecimalDigit(e)||e===f.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===f.SQUOTE_CODE||e===f.DQUOTE_CODE)i=this.gobbleStringLiteral();else if(e===f.OBRACK_CODE)i=this.gobbleArray();else{for(r=this.expr.substr(this.index,f.max_unop_len),n=r.length;n>0;){if(f.unary_ops.hasOwnProperty(r)&&(!f.isIdentifierStart(this.code)||this.index+r.length<this.expr.length&&!f.isIdentifierPart(this.expr.charCodeAt(this.index+r.length)))){this.index+=n;const s=this.gobbleToken();return s||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:f.UNARY_EXP,operator:r,argument:s,prefix:!0})}r=r.substr(0,--n)}f.isIdentifierStart(e)?(i=this.gobbleIdentifier(),f.literals.hasOwnProperty(i.name)?i={type:f.LITERAL,value:f.literals[i.name],raw:i.name}:i.name===f.this_str&&(i={type:f.THIS_EXP})):e===f.OPAREN_CODE&&(i=this.gobbleGroup())}return i?(i=this.gobbleTokenProperty(i),this.runHook("after-token",i)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let r=this.code;for(;r===f.PERIOD_CODE||r===f.OBRACK_CODE||r===f.OPAREN_CODE||r===f.QUMARK_CODE;){let n;if(r===f.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==f.PERIOD_CODE)break;n=!0,this.index+=2,this.gobbleSpaces(),r=this.code}this.index++,r===f.OBRACK_CODE?(e={type:f.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},e.property||this.throwError('Unexpected "'+this.char+'"'),this.gobbleSpaces(),r=this.code,r!==f.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):r===f.OPAREN_CODE?e={type:f.CALL_EXP,arguments:this.gobbleArguments(f.CPAREN_CODE),callee:e}:(r===f.PERIOD_CODE||n)&&(n&&this.index--,this.gobbleSpaces(),e={type:f.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),n&&(e.optional=!0),this.gobbleSpaces(),r=this.code}return e}gobbleNumericLiteral(){let e="",r,n;for(;f.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===f.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);f.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(r=this.char,r==="e"||r==="E"){for(e+=this.expr.charAt(this.index++),r=this.char,(r==="+"||r==="-")&&(e+=this.expr.charAt(this.index++));f.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);f.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return n=this.code,f.isIdentifierStart(n)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(n===f.PERIOD_CODE||e.length===1&&e.charCodeAt(0)===f.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:f.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="";const r=this.index,n=this.expr.charAt(this.index++);let i=!1;for(;this.index<this.expr.length;){let s=this.expr.charAt(this.index++);if(s===n){i=!0;break}else if(s==="\\")switch(s=this.expr.charAt(this.index++),s){case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=s}else e+=s}return i||this.throwError('Unclosed quote after "'+e+'"'),{type:f.LITERAL,value:e,raw:this.expr.substring(r,this.index)}}gobbleIdentifier(){let e=this.code,r=this.index;for(f.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,f.isIdentifierPart(e));)this.index++;return{type:f.IDENTIFIER,name:this.expr.slice(r,this.index)}}gobbleArguments(e){const r=[];let n=!1,i=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let s=this.code;if(s===e){n=!0,this.index++,e===f.CPAREN_CODE&&i&&i>=r.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}else if(s===f.COMMA_CODE){if(this.index++,i++,i!==r.length){if(e===f.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===f.CBRACK_CODE)for(let l=r.length;l<i;l++)r.push(null)}}else if(r.length!==i&&i!==0)this.throwError("Expected comma");else{const l=this.gobbleExpression();(!l||l.type===f.COMPOUND)&&this.throwError("Expected comma"),r.push(l)}}return n||this.throwError("Expected "+String.fromCharCode(e)),r}gobbleGroup(){this.index++;let e=this.gobbleExpressions(f.CPAREN_CODE);if(this.code===f.CPAREN_CODE)return this.index++,e.length===1?e[0]:e.length?{type:f.SEQUENCE_EXP,expressions:e}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:f.ARRAY_EXP,elements:this.gobbleArguments(f.CBRACK_CODE)}}}const Er=new _r;Object.assign(f,{hooks:Er,plugins:new wr(f),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"??":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10,"**":11},right_associative:new Set(["**"]),additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});f.max_unop_len=f.getMaxKeyLen(f.unary_ops);f.max_binop_len=f.getMaxKeyLen(f.binary_ops);const re=t=>new f(t).parse(),Or=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(f).filter(t=>!Or.includes(t)&&re[t]===void 0).forEach(t=>{re[t]=f[t]});re.Jsep=f;const xr="ConditionalExpression";var Ar={name:"ternary",init(t){t.hooks.add("after-expression",function(r){if(r.node&&this.code===t.QUMARK_CODE){this.index++;const n=r.node,i=this.gobbleExpression();if(i||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===t.COLON_CODE){this.index++;const s=this.gobbleExpression();if(s||this.throwError("Expected expression"),r.node={type:xr,test:n,consequent:i,alternate:s},n.operator&&t.binary_ops[n.operator]<=.9){let l=n;for(;l.right.operator&&t.binary_ops[l.right.operator]<=.9;)l=l.right;r.node.test=l.right,l.right=r.node,r.node=n}}else this.throwError("Expected :")}})}};re.plugins.register(Ar);const at=47,jr=92;var Cr={name:"regex",init(t){t.hooks.add("gobble-token",function(r){if(this.code===at){const n=++this.index;let i=!1;for(;this.index<this.expr.length;){if(this.code===at&&!i){const s=this.expr.slice(n,this.index);let l="";for(;++this.index<this.expr.length;){const g=this.code;if(g>=97&&g<=122||g>=65&&g<=90||g>=48&&g<=57)l+=this.char;else break}let p;try{p=new RegExp(s,l)}catch(g){this.throwError(g.message)}return r.node={type:t.LITERAL,value:p,raw:this.expr.slice(n-1,this.index)},r.node=this.gobbleTokenProperty(r.node),r.node}this.code===t.OBRACK_CODE?i=!0:i&&this.code===t.CBRACK_CODE&&(i=!1),this.index+=this.code===jr?2:1}this.throwError("Unclosed Regex")}})}};const Te=43,Pr=45,pe={name:"assignment",assignmentOperators:new Set(["=","*=","**=","/=","%=","+=","-=","<<=",">>=",">>>=","&=","^=","|=","||=","&&=","??="]),updateOperators:[Te,Pr],assignmentPrecedence:.9,init(t){const e=[t.IDENTIFIER,t.MEMBER_EXP];pe.assignmentOperators.forEach(n=>t.addBinaryOp(n,pe.assignmentPrecedence,!0)),t.hooks.add("gobble-token",function(i){const s=this.code;pe.updateOperators.some(l=>l===s&&l===this.expr.charCodeAt(this.index+1))&&(this.index+=2,i.node={type:"UpdateExpression",operator:s===Te?"++":"--",argument:this.gobbleTokenProperty(this.gobbleIdentifier()),prefix:!0},(!i.node.argument||!e.includes(i.node.argument.type))&&this.throwError(`Unexpected ${i.node.operator}`))}),t.hooks.add("after-token",function(i){if(i.node){const s=this.code;pe.updateOperators.some(l=>l===s&&l===this.expr.charCodeAt(this.index+1))&&(e.includes(i.node.type)||this.throwError(`Unexpected ${i.node.operator}`),this.index+=2,i.node={type:"UpdateExpression",operator:s===Te?"++":"--",argument:i.node,prefix:!1})}}),t.hooks.add("after-expression",function(i){i.node&&r(i.node)});function r(n){pe.assignmentOperators.has(n.operator)?(n.type="AssignmentExpression",r(n.left),r(n.right)):n.operator||Object.values(n).forEach(i=>{i&&typeof i=="object"&&r(i)})}}};re.plugins.register(Cr,pe);re.addUnaryOp("typeof");re.addLiteral("null",null);re.addLiteral("undefined",void 0);const Rr=new Set(["constructor","__proto__","__defineGetter__","__defineSetter__"]),T={evalAst(t,e){switch(t.type){case"BinaryExpression":case"LogicalExpression":return T.evalBinaryExpression(t,e);case"Compound":return T.evalCompound(t,e);case"ConditionalExpression":return T.evalConditionalExpression(t,e);case"Identifier":return T.evalIdentifier(t,e);case"Literal":return T.evalLiteral(t,e);case"MemberExpression":return T.evalMemberExpression(t,e);case"UnaryExpression":return T.evalUnaryExpression(t,e);case"ArrayExpression":return T.evalArrayExpression(t,e);case"CallExpression":return T.evalCallExpression(t,e);case"AssignmentExpression":return T.evalAssignmentExpression(t,e);default:throw SyntaxError("Unexpected expression",t)}},evalBinaryExpression(t,e){return{"||":(n,i)=>n||i(),"&&":(n,i)=>n&&i(),"|":(n,i)=>n|i(),"^":(n,i)=>n^i(),"&":(n,i)=>n&i(),"==":(n,i)=>n==i(),"!=":(n,i)=>n!=i(),"===":(n,i)=>n===i(),"!==":(n,i)=>n!==i(),"<":(n,i)=>n<i(),">":(n,i)=>n>i(),"<=":(n,i)=>n<=i(),">=":(n,i)=>n>=i(),"<<":(n,i)=>n<<i(),">>":(n,i)=>n>>i(),">>>":(n,i)=>n>>>i(),"+":(n,i)=>n+i(),"-":(n,i)=>n-i(),"*":(n,i)=>n*i(),"/":(n,i)=>n/i(),"%":(n,i)=>n%i()}[t.operator](T.evalAst(t.left,e),()=>T.evalAst(t.right,e))},evalCompound(t,e){let r;for(let n=0;n<t.body.length;n++){t.body[n].type==="Identifier"&&["var","let","const"].includes(t.body[n].name)&&t.body[n+1]&&t.body[n+1].type==="AssignmentExpression"&&(n+=1);const i=t.body[n];r=T.evalAst(i,e)}return r},evalConditionalExpression(t,e){return T.evalAst(t.test,e)?T.evalAst(t.consequent,e):T.evalAst(t.alternate,e)},evalIdentifier(t,e){if(Object.hasOwn(e,t.name))return e[t.name];throw ReferenceError(`${t.name} is not defined`)},evalLiteral(t){return t.value},evalMemberExpression(t,e){const r=String(t.computed?T.evalAst(t.property):t.property.name),n=T.evalAst(t.object,e);if(n==null)throw TypeError(`Cannot read properties of ${n} (reading '${r}')`);if(!Object.hasOwn(n,r)&&Rr.has(r))throw TypeError(`Cannot read properties of ${n} (reading '${r}')`);const i=n[r];return typeof i=="function"?i.bind(n):i},evalUnaryExpression(t,e){return{"-":n=>-T.evalAst(n,e),"!":n=>!T.evalAst(n,e),"~":n=>~T.evalAst(n,e),"+":n=>+T.evalAst(n,e),typeof:n=>typeof T.evalAst(n,e)}[t.operator](t.argument)},evalArrayExpression(t,e){return t.elements.map(r=>T.evalAst(r,e))},evalCallExpression(t,e){const r=t.arguments.map(i=>T.evalAst(i,e));return T.evalAst(t.callee,e)(...r)},evalAssignmentExpression(t,e){if(t.left.type!=="Identifier")throw SyntaxError("Invalid left-hand side in assignment");const r=t.left.name,n=T.evalAst(t.right,e);return e[r]=n,e[r]}};class Sr{constructor(e){this.code=e,this.ast=re(this.code)}runInNewContext(e){const r=Object.assign(Object.create(null),e);return T.evalAst(this.ast,r)}}function oe(t,e){return t=t.slice(),t.push(e),t}function ze(t,e){return e=e.slice(),e.unshift(t),e}class kr extends Error{constructor(e){super('JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)'),this.avoidNew=!0,this.value=e,this.name="NewError"}}function S(t,e,r,n,i){if(!(this instanceof S))try{return new S(t,e,r,n,i)}catch(l){if(!l.avoidNew)throw l;return l.value}typeof t=="string"&&(i=n,n=r,r=e,e=t,t=null);const s=t&&typeof t=="object";if(t=t||{},this.json=t.json||r,this.path=t.path||e,this.resultType=t.resultType||"value",this.flatten=t.flatten||!1,this.wrap=Object.hasOwn(t,"wrap")?t.wrap:!0,this.sandbox=t.sandbox||{},this.eval=t.eval===void 0?"safe":t.eval,this.ignoreEvalErrors=typeof t.ignoreEvalErrors>"u"?!1:t.ignoreEvalErrors,this.parent=t.parent||null,this.parentProperty=t.parentProperty||null,this.callback=t.callback||n||null,this.otherTypeCallback=t.otherTypeCallback||i||function(){throw new TypeError("You must supply an otherTypeCallback callback option with the @other() operator.")},t.autostart!==!1){const l={path:s?t.path:e};s?"json"in t&&(l.json=t.json):l.json=r;const p=this.evaluate(l);if(!p||typeof p!="object")throw new kr(p);return p}}S.prototype.evaluate=function(t,e,r,n){let i=this.parent,s=this.parentProperty,{flatten:l,wrap:p}=this;if(this.currResultType=this.resultType,this.currEval=this.eval,this.currSandbox=this.sandbox,r=r||this.callback,this.currOtherTypeCallback=n||this.otherTypeCallback,e=e||this.json,t=t||this.path,t&&typeof t=="object"&&!Array.isArray(t)){if(!t.path&&t.path!=="")throw new TypeError('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');if(!Object.hasOwn(t,"json"))throw new TypeError('You must supply a "json" property when providing an object argument to JSONPath.evaluate().');({json:e}=t),l=Object.hasOwn(t,"flatten")?t.flatten:l,this.currResultType=Object.hasOwn(t,"resultType")?t.resultType:this.currResultType,this.currSandbox=Object.hasOwn(t,"sandbox")?t.sandbox:this.currSandbox,p=Object.hasOwn(t,"wrap")?t.wrap:p,this.currEval=Object.hasOwn(t,"eval")?t.eval:this.currEval,r=Object.hasOwn(t,"callback")?t.callback:r,this.currOtherTypeCallback=Object.hasOwn(t,"otherTypeCallback")?t.otherTypeCallback:this.currOtherTypeCallback,i=Object.hasOwn(t,"parent")?t.parent:i,s=Object.hasOwn(t,"parentProperty")?t.parentProperty:s,t=t.path}if(i=i||null,s=s||null,Array.isArray(t)&&(t=S.toPathString(t)),!t&&t!==""||!e)return;const g=S.toPathArray(t);g[0]==="$"&&g.length>1&&g.shift(),this._hasParentSelector=null;const w=this._trace(g,e,["$"],i,s,r).filter(function(O){return O&&!O.isParentSelector});return w.length?!p&&w.length===1&&!w[0].hasArrExpr?this._getPreferredOutput(w[0]):w.reduce((O,j)=>{const x=this._getPreferredOutput(j);return l&&Array.isArray(x)?O=O.concat(x):O.push(x),O},[]):p?[]:void 0};S.prototype._getPreferredOutput=function(t){const e=this.currResultType;switch(e){case"all":{const r=Array.isArray(t.path)?t.path:S.toPathArray(t.path);return t.pointer=S.toPointer(r),t.path=typeof t.path=="string"?t.path:S.toPathString(t.path),t}case"value":case"parent":case"parentProperty":return t[e];case"path":return S.toPathString(t[e]);case"pointer":return S.toPointer(t.path);default:throw new TypeError("Unknown result type")}};S.prototype._handleCallback=function(t,e,r){if(e){const n=this._getPreferredOutput(t);t.path=typeof t.path=="string"?t.path:S.toPathString(t.path),e(n,r,t)}};S.prototype._trace=function(t,e,r,n,i,s,l,p){let g;if(!t.length)return g={path:r,value:e,parent:n,parentProperty:i,hasArrExpr:l},this._handleCallback(g,s,"value"),g;const w=t[0],O=t.slice(1),j=[];function x(_){Array.isArray(_)?_.forEach(C=>{j.push(C)}):j.push(_)}if((typeof w!="string"||p)&&e&&Object.hasOwn(e,w))x(this._trace(O,e[w],oe(r,w),e,w,s,l));else if(w==="*")this._walk(e,_=>{x(this._trace(O,e[_],oe(r,_),e,_,s,!0,!0))});else if(w==="..")x(this._trace(O,e,r,n,i,s,l)),this._walk(e,_=>{typeof e[_]=="object"&&x(this._trace(t.slice(),e[_],oe(r,_),e,_,s,!0))});else{if(w==="^")return this._hasParentSelector=!0,{path:r.slice(0,-1),expr:O,isParentSelector:!0};if(w==="~")return g={path:oe(r,w),value:i,parent:n,parentProperty:null},this._handleCallback(g,s,"property"),g;if(w==="$")x(this._trace(O,e,r,null,null,s,l));else if(/^(-?\d*):(-?\d*):?(\d*)$/u.test(w))x(this._slice(w,O,e,r,n,i,s));else if(w.indexOf("?(")===0){if(this.currEval===!1)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");const _=w.replace(/^\?\((.*?)\)$/u,"$1"),C=/@.?([^?]*)[['](\??\(.*?\))(?!.\)\])[\]']/gu.exec(_);C?this._walk(e,E=>{const k=[C[2]],F=C[1]?e[E][C[1]]:e[E];this._trace(k,F,r,n,i,s,!0).length>0&&x(this._trace(O,e[E],oe(r,E),e,E,s,!0))}):this._walk(e,E=>{this._eval(_,e[E],E,r,n,i)&&x(this._trace(O,e[E],oe(r,E),e,E,s,!0))})}else if(w[0]==="("){if(this.currEval===!1)throw new Error("Eval [(expr)] prevented in JSONPath expression.");x(this._trace(ze(this._eval(w,e,r.at(-1),r.slice(0,-1),n,i),O),e,r,n,i,s,l))}else if(w[0]==="@"){let _=!1;const C=w.slice(1,-2);switch(C){case"scalar":(!e||!["object","function"].includes(typeof e))&&(_=!0);break;case"boolean":case"string":case"undefined":case"function":typeof e===C&&(_=!0);break;case"integer":Number.isFinite(e)&&!(e%1)&&(_=!0);break;case"number":Number.isFinite(e)&&(_=!0);break;case"nonFinite":typeof e=="number"&&!Number.isFinite(e)&&(_=!0);break;case"object":e&&typeof e===C&&(_=!0);break;case"array":Array.isArray(e)&&(_=!0);break;case"other":_=this.currOtherTypeCallback(e,r,n,i);break;case"null":e===null&&(_=!0);break;default:throw new TypeError("Unknown value type "+C)}if(_)return g={path:r,value:e,parent:n,parentProperty:i},this._handleCallback(g,s,"value"),g}else if(w[0]==="`"&&e&&Object.hasOwn(e,w.slice(1))){const _=w.slice(1);x(this._trace(O,e[_],oe(r,_),e,_,s,l,!0))}else if(w.includes(",")){const _=w.split(",");for(const C of _)x(this._trace(ze(C,O),e,r,n,i,s,!0))}else!p&&e&&Object.hasOwn(e,w)&&x(this._trace(O,e[w],oe(r,w),e,w,s,l,!0))}if(this._hasParentSelector)for(let _=0;_<j.length;_++){const C=j[_];if(C&&C.isParentSelector){const E=this._trace(C.expr,e,C.path,n,i,s,l);if(Array.isArray(E)){j[_]=E[0];const k=E.length;for(let F=1;F<k;F++)_++,j.splice(_,0,E[F])}else j[_]=E}}return j};S.prototype._walk=function(t,e){if(Array.isArray(t)){const r=t.length;for(let n=0;n<r;n++)e(n)}else t&&typeof t=="object"&&Object.keys(t).forEach(r=>{e(r)})};S.prototype._slice=function(t,e,r,n,i,s,l){if(!Array.isArray(r))return;const p=r.length,g=t.split(":"),w=g[2]&&Number.parseInt(g[2])||1;let O=g[0]&&Number.parseInt(g[0])||0,j=g[1]&&Number.parseInt(g[1])||p;O=O<0?Math.max(0,O+p):Math.min(p,O),j=j<0?Math.max(0,j+p):Math.min(p,j);const x=[];for(let _=O;_<j;_+=w)this._trace(ze(_,e),r,n,i,s,l,!0).forEach(E=>{x.push(E)});return x};S.prototype._eval=function(t,e,r,n,i,s){this.currSandbox._$_parentProperty=s,this.currSandbox._$_parent=i,this.currSandbox._$_property=r,this.currSandbox._$_root=this.json,this.currSandbox._$_v=e;const l=t.includes("@path");l&&(this.currSandbox._$_path=S.toPathString(n.concat([r])));const p=this.currEval+"Script:"+t;if(!S.cache[p]){let g=t.replaceAll("@parentProperty","_$_parentProperty").replaceAll("@parent","_$_parent").replaceAll("@property","_$_property").replaceAll("@root","_$_root").replaceAll(/@([.\s)[])/gu,"_$_v$1");if(l&&(g=g.replaceAll("@path","_$_path")),this.currEval==="safe"||this.currEval===!0||this.currEval===void 0)S.cache[p]=new this.safeVm.Script(g);else if(this.currEval==="native")S.cache[p]=new this.vm.Script(g);else if(typeof this.currEval=="function"&&this.currEval.prototype&&Object.hasOwn(this.currEval.prototype,"runInNewContext")){const w=this.currEval;S.cache[p]=new w(g)}else if(typeof this.currEval=="function")S.cache[p]={runInNewContext:w=>this.currEval(g,w)};else throw new TypeError(`Unknown "eval" property "${this.currEval}"`)}try{return S.cache[p].runInNewContext(this.currSandbox)}catch(g){if(this.ignoreEvalErrors)return!1;throw new Error("jsonPath: "+g.message+": "+t)}};S.cache={};S.toPathString=function(t){const e=t,r=e.length;let n="$";for(let i=1;i<r;i++)/^(~|\^|@.*?\(\))$/u.test(e[i])||(n+=/^[0-9*]+$/u.test(e[i])?"["+e[i]+"]":"['"+e[i]+"']");return n};S.toPointer=function(t){const e=t,r=e.length;let n="";for(let i=1;i<r;i++)/^(~|\^|@.*?\(\))$/u.test(e[i])||(n+="/"+e[i].toString().replaceAll("~","~0").replaceAll("/","~1"));return n};S.toPathArray=function(t){const{cache:e}=S;if(e[t])return e[t].concat();const r=[],i=t.replaceAll(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/gu,";$&;").replaceAll(/[['](\??\(.*?\))[\]'](?!.\])/gu,function(s,l){return"[#"+(r.push(l)-1)+"]"}).replaceAll(/\[['"]([^'\]]*)['"]\]/gu,function(s,l){return"['"+l.replaceAll(".","%@%").replaceAll("~","%%@@%%")+"']"}).replaceAll("~",";~;").replaceAll(/['"]?\.['"]?(?![^[]*\])|\[['"]?/gu,";").replaceAll("%@%",".").replaceAll("%%@@%%","~").replaceAll(/(?:;)?(\^+)(?:;)?/gu,function(s,l){return";"+l.split("").join(";")+";"}).replaceAll(/;;;|;;/gu,";..;").replaceAll(/;$|'?\]|'$/gu,"").split(";").map(function(s){const l=s.match(/#(\d+)/u);return!l||!l[1]?s:r[l[1]]});return e[t]=i,e[t].concat()};S.prototype.safeVm={Script:Sr};const Fr=function(t,e,r){const n=t.length;for(let i=0;i<n;i++){const s=t[i];r(s)&&e.push(t.splice(i--,1)[0])}};class Dr{constructor(e){this.code=e}runInNewContext(e){let r=this.code;const n=Object.keys(e),i=[];Fr(n,i,w=>typeof e[w]=="function");const s=n.map(w=>e[w]);r=i.reduce((w,O)=>{let j=e[O].toString();return/function/u.test(j)||(j="function "+j),"var "+O+"="+j+";"+w},"")+r,!/(['"])use strict\1/u.test(r)&&!n.includes("arguments")&&(r="var arguments = undefined;"+r),r=r.replace(/;\s*$/u,"");const p=r.lastIndexOf(";"),g=p!==-1?r.slice(0,p+1)+" return "+r.slice(p+1):" return "+r;return new Function(...n,g)(...s)}}S.prototype.vm={Script:Dr};const Mr=Object.freeze(Object.defineProperty({__proto__:null,JSONPath:S},Symbol.toStringTag,{value:"Module"})),Lr=yt(Mr);Object.defineProperty(ke,"__esModule",{value:!0});var Ie=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tr=function(){function t(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Ir=xe,Ne=ht(Ir),Nr=We,Ur=ue,se=ht(Ur),$r=Lr;function ht(t){return t&&t.__esModule?t:{default:t}}function Br(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vr(t,e){return(0,$r.JSONPath)({path:e,json:t,wrap:!1})}var zr=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Br(this,t),this.factMap=new Map,this.factResultsCache=new Map,this.allowUndefinedFacts=Boolean(e.allowUndefinedFacts),this.pathResolver=e.pathResolver||Vr,this.events={success:[],failure:[]},this.ruleResults=[]}return Tr(t,[{key:"addEvent",value:function(r,n){if(!n)throw new Error('outcome required: "success" | "failure"]');this.events[n].push(r)}},{key:"getEvents",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return r?this.events[r]:this.events.success.concat(this.events.failure)}},{key:"addResult",value:function(r){this.ruleResults.push(r)}},{key:"getResults",value:function(){return this.ruleResults}},{key:"_getFact",value:function(r){return this.factMap.get(r)}},{key:"_addConstantFact",value:function(r){this.factMap.set(r.id,r),this._setFactValue(r,{},r.value)}},{key:"_setFactValue",value:function(r,n,i){var s=r.getCacheKey(n),l=Promise.resolve(i);return s&&this.factResultsCache.set(s,l),l}},{key:"addFact",value:function(r,n,i){var s=r,l=void 0;return r instanceof Ne.default?(s=r.id,l=r):l=new Ne.default(r,n,i),(0,se.default)("almanac::addFact",{id:s}),this.factMap.set(s,l),l.isConstant()&&this._setFactValue(l,{},l.value),this}},{key:"addRuntimeFact",value:function(r,n){(0,se.default)("almanac::addRuntimeFact",{id:r});var i=new Ne.default(r,n);return this._addConstantFact(i)}},{key:"factValue",value:function(r){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"",l=void 0,p=this._getFact(r);if(p===void 0)return this.allowUndefinedFacts?Promise.resolve(void 0):Promise.reject(new Nr.UndefinedFactError("Undefined fact: "+r));if(p.isConstant())l=Promise.resolve(p.calculate(i,this));else{var g=p.getCacheKey(i),w=g&&this.factResultsCache.get(g);w?(l=Promise.resolve(w),(0,se.default)("almanac::factValue cache hit for fact",{id:r})):((0,se.default)("almanac::factValue cache miss, calculating",{id:r}),l=this._setFactValue(p,i,p.calculate(i,this)))}return s?((0,se.default)("condition::evaluate extracting object",{property:s}),l.then(function(O){if(O!=null&&(typeof O>"u"?"undefined":Ie(O))==="object"){var j=n.pathResolver(O,s);return(0,se.default)("condition::evaluate extracting object",{property:s,received:j}),j}else return(0,se.default)("condition::evaluate could not compute object path of non-object",{path:s,factValue:O,type:typeof O>"u"?"undefined":Ie(O)}),O})):l}},{key:"getValue",value:function(r){return r!=null&&(typeof r>"u"?"undefined":Ie(r))==="object"&&Object.prototype.hasOwnProperty.call(r,"fact")?this.factValue(r.fact,r.params,r.path):Promise.resolve(r)}}]),t}();ke.default=zr;var Qe={},ye={};Object.defineProperty(ye,"__esModule",{value:!0});var Kr=function(){function t(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function Hr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var qr=function(){function t(e,r,n){if(Hr(this,t),this.name=String(e),!e)throw new Error("Missing operator name");if(typeof r!="function")throw new Error("Missing operator callback");this.cb=r,this.factValueValidator=n,this.factValueValidator||(this.factValueValidator=function(){return!0})}return Kr(t,[{key:"evaluate",value:function(r,n){return this.factValueValidator(r)&&this.cb(r,n)}}]),t}();ye.default=qr;Object.defineProperty(Qe,"__esModule",{value:!0});var Yr=ye,Z=Xr(Yr);function Xr(t){return t&&t.__esModule?t:{default:t}}var Q=[];Q.push(new Z.default("equal",function(t,e){return t===e}));Q.push(new Z.default("notEqual",function(t,e){return t!==e}));Q.push(new Z.default("in",function(t,e){return e.indexOf(t)>-1}));Q.push(new Z.default("notIn",function(t,e){return e.indexOf(t)===-1}));Q.push(new Z.default("contains",function(t,e){return t.indexOf(e)>-1},Array.isArray));Q.push(new Z.default("doesNotContain",function(t,e){return t.indexOf(e)===-1},Array.isArray));function Fe(t){return Number.parseFloat(t).toString()!=="NaN"}Q.push(new Z.default("lessThan",function(t,e){return t<e},Fe));Q.push(new Z.default("lessThanInclusive",function(t,e){return t<=e},Fe));Q.push(new Z.default("greaterThan",function(t,e){return t>e},Fe));Q.push(new Z.default("greaterThanInclusive",function(t,e){return t>=e},Fe));Qe.default=Q;var Ze={},je={};Object.defineProperty(je,"__esModule",{value:!0});var Gr=function(){function t(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Wr=ye,Qr=Zr(Wr);function Zr(t){return t&&t.__esModule?t:{default:t}}function Jr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var en=function(){function t(e,r,n){if(Jr(this,t),this.name=String(e),!e)throw new Error("Missing decorator name");if(typeof r!="function")throw new Error("Missing decorator callback");this.cb=r,this.factValueValidator=n,this.factValueValidator||(this.factValueValidator=function(){return!0})}return Gr(t,[{key:"decorate",value:function(r){var n=this,i=r.evaluate.bind(r);return new Qr.default(this.name+":"+r.name,function(s,l){return n.cb(s,l,i)},this.factValueValidator)}}]),t}();je.default=en;Object.defineProperty(Ze,"__esModule",{value:!0});var tn=je,ge=rn(tn);function rn(t){return t&&t.__esModule?t:{default:t}}var le=[];le.push(new ge.default("someFact",function(t,e,r){return t.some(function(n){return r(n,e)})},Array.isArray));le.push(new ge.default("someValue",function(t,e,r){return e.some(function(n){return r(t,n)})}));le.push(new ge.default("everyFact",function(t,e,r){return t.every(function(n){return r(n,e)})},Array.isArray));le.push(new ge.default("everyValue",function(t,e,r){return e.every(function(n){return r(t,n)})}));le.push(new ge.default("swap",function(t,e,r){return r(e,t)}));le.push(new ge.default("not",function(t,e,r){return!r(t,e)}));Ze.default=le;var Je={};Object.defineProperty(Je,"__esModule",{value:!0});var nn=function(){function t(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),on=ye,Ue=et(on),an=je,$e=et(an),sn=ue,Pe=et(sn);function et(t){return t&&t.__esModule?t:{default:t}}function un(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var ln=function(){function t(){un(this,t),this.operators=new Map,this.decorators=new Map}return nn(t,[{key:"addOperator",value:function(r,n){var i=void 0;r instanceof Ue.default?i=r:i=new Ue.default(r,n),(0,Pe.default)("operatorMap::addOperator",{name:i.name}),this.operators.set(i.name,i)}},{key:"removeOperator",value:function(r){var n=void 0;r instanceof Ue.default?n=r.name:n=r;for(var i=":"+n,s=Array.from(this.operators.keys()),l=0;l<s.length;l++)s[l].endsWith(i)&&this.operators.delete(s[l]);return this.operators.delete(n)}},{key:"addOperatorDecorator",value:function(r,n){var i=void 0;r instanceof $e.default?i=r:i=new $e.default(r,n),(0,Pe.default)("operatorMap::addOperatorDecorator",{name:i.name}),this.decorators.set(i.name,i)}},{key:"removeOperatorDecorator",value:function(r){var n=void 0;r instanceof $e.default?n=r.name:n=r;for(var i=n+":",s=Array.from(this.operators.keys()),l=0;l<s.length;l++)s[l].includes(i)&&this.operators.delete(s[l]);return this.decorators.delete(n)}},{key:"get",value:function(r){for(var n=[],i=r;!this.operators.has(i);){var s=i.indexOf(":");if(s>0){var l=i.slice(0,s),p=this.decorators.get(l);if(!p)return(0,Pe.default)("operatorMap::get invalid decorator",{name:l}),null;n.unshift(p),i=i.slice(s+1)}else return(0,Pe.default)("operatorMap::get no operator",{name:i}),null}for(var g=this.operators.get(i),w=0;w<n.length;w++)g=n[w].decorate(g),this.operators.set(g.name,g);return g}}]),t}();Je.default=ln;Object.defineProperty(te,"__esModule",{value:!0});te.FINISHED=te.RUNNING=te.READY=void 0;var cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fn=function(){function t(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),hn=xe,we=ne(hn),dn=Re,Be=ne(dn),pn=ke,vn=ne(pn),yn=Ge.exports,gn=ne(yn),mn=Qe,bn=ne(mn),_n=Ze,wn=ne(_n),En=ue,de=ne(En),On=Se,xn=ne(On),An=Je,jn=ne(An);function ne(t){return t&&t.__esModule?t:{default:t}}function Cn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function Rn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var Sn=te.READY="READY",st=te.RUNNING="RUNNING",ut=te.FINISHED="FINISHED",kn=function(t){Rn(e,t);function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Cn(this,e);var i=Pn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.rules=[],i.allowUndefinedFacts=n.allowUndefinedFacts||!1,i.allowUndefinedConditions=n.allowUndefinedConditions||!1,i.replaceFactsInEventParams=n.replaceFactsInEventParams||!1,i.pathResolver=n.pathResolver,i.operators=new jn.default,i.facts=new Map,i.conditions=new Map,i.status=Sn,r.map(function(s){return i.addRule(s)}),bn.default.map(function(s){return i.addOperator(s)}),wn.default.map(function(s){return i.addOperatorDecorator(s)}),i}return fn(e,[{key:"addRule",value:function(n){if(!n)throw new Error("Engine: addRule() requires options");var i=void 0;if(n instanceof Be.default)i=n;else{if(!Object.prototype.hasOwnProperty.call(n,"event"))throw new Error('Engine: addRule() argument requires "event" property');if(!Object.prototype.hasOwnProperty.call(n,"conditions"))throw new Error('Engine: addRule() argument requires "conditions" property');i=new Be.default(n)}return i.setEngine(this),this.rules.push(i),this.prioritizedRules=null,this}},{key:"updateRule",value:function(n){var i=this.rules.findIndex(function(s){return s.name===n.name});if(i>-1)this.rules.splice(i,1),this.addRule(n),this.prioritizedRules=null;else throw new Error("Engine: updateRule() rule not found")}},{key:"removeRule",value:function(n){var i=!1;if(n instanceof Be.default){var l=this.rules.indexOf(n);l>-1&&(i=Boolean(this.rules.splice(l,1).length))}else{var s=this.rules.filter(function(p){return p.name!==n});i=s.length!==this.rules.length,this.rules=s}return i&&(this.prioritizedRules=null),i}},{key:"setCondition",value:function(n,i){if(!n)throw new Error("Engine: setCondition() requires name");if(!i)throw new Error("Engine: setCondition() requires conditions");if(!Object.prototype.hasOwnProperty.call(i,"all")&&!Object.prototype.hasOwnProperty.call(i,"any")&&!Object.prototype.hasOwnProperty.call(i,"not")&&!Object.prototype.hasOwnProperty.call(i,"condition"))throw new Error('"conditions" root must contain a single instance of "all", "any", "not", or "condition"');return this.conditions.set(n,new xn.default(i)),this}},{key:"removeCondition",value:function(n){return this.conditions.delete(n)}},{key:"addOperator",value:function(n,i){this.operators.addOperator(n,i)}},{key:"removeOperator",value:function(n){return this.operators.removeOperator(n)}},{key:"addOperatorDecorator",value:function(n,i){this.operators.addOperatorDecorator(n,i)}},{key:"removeOperatorDecorator",value:function(n){return this.operators.removeOperatorDecorator(n)}},{key:"addFact",value:function(n,i,s){var l=n,p=void 0;return n instanceof we.default?(l=n.id,p=n):p=new we.default(n,i,s),(0,de.default)("engine::addFact",{id:l}),this.facts.set(l,p),this}},{key:"removeFact",value:function(n){var i=void 0;return n instanceof we.default?i=n.id:i=n,this.facts.delete(i)}},{key:"prioritizeRules",value:function(){if(!this.prioritizedRules){var n=this.rules.reduce(function(i,s){var l=s.priority;return i[l]||(i[l]=[]),i[l].push(s),i},{});this.prioritizedRules=Object.keys(n).sort(function(i,s){return Number(i)>Number(s)?-1:1}).map(function(i){return n[i]})}return this.prioritizedRules}},{key:"stop",value:function(){return this.status=ut,this}},{key:"getFact",value:function(n){return this.facts.get(n)}},{key:"evaluateRules",value:function(n,i){var s=this;return Promise.all(n.map(function(l){return s.status!==st?((0,de.default)("engine::run, skipping remaining rules",{status:s.status}),Promise.resolve()):l.evaluate(i).then(function(p){return(0,de.default)("engine::run",{ruleResult:p.result}),i.addResult(p),p.result?(i.addEvent(p.event,"success"),s.emitAsync("success",p.event,i,p).then(function(){return s.emitAsync(p.event.type,p.event.params,i,p)})):(i.addEvent(p.event,"failure"),s.emitAsync("failure",p.event,i,p))})}))}},{key:"run",value:function(){var n=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,de.default)("engine::run started"),this.status=st;var l=s.almanac||new vn.default({allowUndefinedFacts:this.allowUndefinedFacts,pathResolver:this.pathResolver});this.facts.forEach(function(j){l.addFact(j)});for(var p in i){var g=void 0;i[p]instanceof we.default?g=i[p]:g=new we.default(p,i[p]),l.addFact(g),(0,de.default)("engine::run initialized runtime fact",{id:g.id,value:g.value,type:cn(g.value)})}var w=this.prioritizeRules(),O=Promise.resolve();return new Promise(function(j,x){w.map(function(_){return O=O.then(function(){return n.evaluateRules(_,l)}).catch(x),O}),O.then(function(){n.status=ut,(0,de.default)("engine::run completed");var _=l.getResults(),C=_.reduce(function(F,I){var q=I.result?"results":"failureResults";return F[q].push(I),F},{results:[],failureResults:[]}),E=C.results,k=C.failureResults;j({almanac:l,results:E,failureResults:k,events:l.getEvents("success"),failureEvents:l.getEvents("failure")})}).catch(x)})}}]),e}(gn.default);te.default=kn;Object.defineProperty(H,"__esModule",{value:!0});H.OperatorDecorator=H.Almanac=H.Engine=H.Operator=H.Rule=H.Fact=void 0;H.default=function(t,e){return new dt.default(t,e)};var Fn=te,dt=me(Fn),Dn=xe,Mn=me(Dn),Ln=Re,Tn=me(Ln),In=ye,Nn=me(In),Un=ke,$n=me(Un),Bn=je,Vn=me(Bn);function me(t){return t&&t.__esModule?t:{default:t}}H.Fact=Mn.default;H.Rule=Tn.default;H.Operator=Nn.default;H.Engine=dt.default;H.Almanac=$n.default;H.OperatorDecorator=Vn.default;(function(t){t.exports=H})(lt);const zn=gt(lt.exports);let be=new zn;function tt(t,e){for(let r of window.payees)if(new RegExp(r.name,"i").test(t))return r;for(let r of window.payees.filter(n=>n.alias))for(let n of r.alias.split(`\r
`))if(new RegExp(n,"i").test(t))return r;return window.payees.find(r=>r.name===e)}const Kn=function(t,e){return t.length?new RegExp(e).test(t):!1};be.addOperator("matchesRegex",Kn);be.addRule({conditions:{all:[{fact:"T\xEDpus",operator:"equal",value:"K\xE1rtyatranzakci\xF3"},{fact:"K\xF6zlem\xE9ny/3",operator:"matchesRegex",value:" V\xE1s\xE1rl\xE1s$"}]},event:{type:"Card payment",params:{processingRules:[{transactionField:"date",customFunction:function(t,e){let n=new RegExp(/\w+ (\d{4})(\d{2})(\d{2}) \w+/).exec(t["K\xF6zlem\xE9ny/1"]);if(n)return new Date(n[1]+"-"+n[2]+"-"+n[3])}},{transactionField:"transaction_config_type",customValue:"standard"},{transactionField:"transaction_type_id",customValue:1},{transactionField:"transaction_type.name",customValue:"withdrawal"},{transactionField:"transaction_type.amount_multiplier",customValue:1},{transactionField:"config.amount_from",customFunction:function(t,e){let n=new RegExp(/^-((\d+\s)*\d+,\d+) HUF$/).exec(t.\u00D6sszeg);if(n)return parseFloat(n[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.amount_to",customFunction:function(t,e){let n=new RegExp(/^-((\d+\s)*\d+,\d+) HUF$/).exec(t.\u00D6sszeg);if(n)return parseFloat(n[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.account_to",customFunction:function(t,e){return tt(t["K\xF6zlem\xE9ny/2"],"Egy\xE9b")}},{transactionField:"config.account_from",customFunction:function(t,e){return{id:$("#account").val(),name:$("#account option:selected").text()}}},{transactionField:"comment",customFunction:function(t,e){var r;if(((r=e.config.account_to)==null?void 0:r.name)==="Egy\xE9b")return t["K\xF6zlem\xE9ny/2"]}}]}}});be.addRule({conditions:{all:[{fact:"\xD6sszeg",operator:"matchesRegex",value:"^-\\d+"},{fact:"T\xEDpus",operator:"in",value:["Elektronikus bankon bel\xFCli \xE1tutal\xE1s","Elektronikus forint \xE1tutal\xE1s","\xC1lland\xF3 \xE1tutal\xE1s","Csoportos beszed\xE9si megb\xEDz\xE1s","Forint \xE1tutal\xE1s"]}]},event:{type:"Outgoing wire transfer",params:{processingRules:[{transactionField:"date",customFunction:function(t,e){let n=new RegExp(/(\d{4})\.(\d{2})\.(\d{2})\./).exec(t.\u00C9rt\u00E9knap);if(n)return new Date(n[1]+"-"+n[2]+"-"+n[3])}},{transactionField:"transaction_config_type",customValue:"standard"},{transactionField:"transaction_type_id",customValue:1},{transactionField:"transaction_type.name",customValue:"withdrawal"},{transactionField:"transaction_type.amount_multiplier",customValue:1},{transactionField:"config.amount_from",customFunction:function(t,e){let n=new RegExp(/^-((\d+\s)*\d+,\d+) HUF$/).exec(t.\u00D6sszeg);if(n)return parseFloat(n[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.amount_to",customFunction:function(t,e){let n=new RegExp(/^-((\d+\s)*\d+,\d+) HUF$/).exec(t.\u00D6sszeg);if(n)return parseFloat(n[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.account_to",customFunction:function(t,e){return tt(t["K\xF6zlem\xE9ny/2"],"Egy\xE9b")}},{transactionField:"config.account_from",customFunction:function(t,e){return{id:$("#account").val(),name:$("#account option:selected").text()}}},{transactionField:"comment",customFunction:function(t,e){var r;if(((r=e.config.account_to)==null?void 0:r.name)==="Egy\xE9b")return t["K\xF6zlem\xE9ny/2"]}}]}}});be.addRule({conditions:{all:[{fact:"\xD6sszeg",operator:"matchesRegex",value:"^\\d+"},{fact:"T\xEDpus",operator:"in",value:["Forint \xE1tutal\xE1s","Deviza \xE1tutal\xE1s","Csoportos \xE1tutal\xE1s j\xF3v\xE1\xEDr\xE1sa"]}]},event:{type:"Incoming wire transfer",params:{processingRules:[{transactionField:"date",customFunction:function(t,e){let n=new RegExp(/(\d{4})\.(\d{2})\.(\d{2})\./).exec(t.\u00C9rt\u00E9knap);if(n)return new Date(n[1]+"-"+n[2]+"-"+n[3])}},{transactionField:"transaction_config_type",customValue:"standard"},{transactionField:"transaction_type_id",customValue:2},{transactionField:"transaction_type.name",customValue:"deposit"},{transactionField:"transaction_type.amount_multiplier",customValue:1},{transactionField:"config.amount_from",customFunction:function(t,e){let n=new RegExp(/^((\d+\s)*\d+,\d+) HUF$/).exec(t.\u00D6sszeg);if(n)return parseFloat(n[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.amount_to",customFunction:function(t,e){let n=new RegExp(/^((\d+\s)*\d+,\d+) HUF$/).exec(t.\u00D6sszeg);if(n)return parseFloat(n[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.account_from",customFunction:function(t,e){return tt(t["K\xF6zlem\xE9ny/2"],"Egy\xE9b")}},{transactionField:"config.account_to",customFunction:function(t,e){return{id:$("#account").val(),name:$("#account option:selected").text()}}},{transactionField:"comment",customFunction:function(t,e){var r;if(((r=e.config.account_to)==null?void 0:r.name)==="Egy\xE9b")return t["K\xF6zlem\xE9ny/2"]}}]}}});be.addRule({conditions:{any:[{all:[{fact:"T\xEDpus",operator:"equal",value:"Elektronik. saj\xE1t sz\xE1ml\xE1s \xE1tvezet\xE9s"},{fact:"K\xF6zlem\xE9ny/3",operator:"in",value:["Hitelk\xE1rtya felt\xF6lt\xE9s","Pay off credit card"]}]},{all:[{fact:"T\xEDpus",operator:"equal",value:"K\xE1rtyatranzakci\xF3"},{fact:"K\xF6zlem\xE9ny/3",operator:"matchesRegex",value:" Kp felv\xE9t$"}]}]},event:{type:"Cash withdrawal",params:{processingRules:[{transactionField:"date",customFunction:function(t,e){let n=new RegExp(/(\d{4})\.(\d{2})\.(\d{2})\./).exec(t.\u00C9rt\u00E9knap);if(n)return new Date(n[1]+"-"+n[2]+"-"+n[3])}},{transactionField:"transaction_config_type",customValue:"standard"},{transactionField:"transaction_type_id",customValue:3},{transactionField:"transaction_type.name",customValue:"transfer"},{transactionField:"transaction_type.amount_multiplier",customValue:""},{transactionField:"config.amount_from",customFunction:function(t,e){let n=new RegExp(/^-((\d+\s)*\d+,\d+) HUF$/).exec(t.\u00D6sszeg);if(n)return parseFloat(n[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.amount_to",customFunction:function(t,e){let n=new RegExp(/^-((\d+\s)*\d+,\d+) HUF$/).exec(t.\u00D6sszeg);if(n)return parseFloat(n[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.account_to",customValue:void 0},{transactionField:"config.account_from",customFunction:function(t,e){return{id:$("#account").val(),name:$("#account option:selected").text()}}},{transactionField:"comment",customFunction:function(t,e){return t["K\xF6zlem\xE9ny/3"]}}]}}});pt.exports=be});export default Hn();
