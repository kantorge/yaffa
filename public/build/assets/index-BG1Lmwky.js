import"./responsive.bootstrap5-Ct7FWSHK.js";import{f as s,d as l,e as u}from"./dataTableHelper-DPRPCEc4.js";import{c as f}from"./app-QU5FfaO6.js";import{Q as p}from"./Modal-ByczzkQD.js";import"./dataTables.bootstrap5-C_qjeAEr.js";import"./helpers-uU3f7Ngr.js";import"./tslib.es6-CZM0TROl.js";import"./ActionButtonBar-Cvu4hr7f.js";const d="#table";window.mails=window.mails.map(function(t){return t.date=new Date(t.created_at),t});window.table=$(d).DataTable({data:window.mails,columns:[{data:"date",title:__("Received at"),render:function(t,e){return e==="display"&&t&&t.toLocaleDateString?t.toLocaleString(window.YAFFA.locale):t},className:"dt-nowrap",type:"date"},{data:"subject",title:__("Subject"),render:function(t,e,a){return e==="display"?'<a href="'+window.route("received-mail.show",{received_mail:a.id})+'" title="'+__("Show details")+'">'+t+"</a>":t}},{data:"processed",title:__("Processed"),render:function(t,e){return s(t,e)},className:"text-center"},{data:"handled",title:__("Handled"),render:function(t,e){return s(t,e)},className:"text-center"},{data:"transaction_id",title:__("Linked transaction"),render:function(t,e,a){return t?l(t,"quickView")+l(t,"show"):__("Not available")},className:"dt-nowrap",orderable:!1,searchable:!1},{data:"id",title:__("Actions"),render:function(t,e,a){return'<a href="'+window.route("received-mail.show",{received_mail:t})+'" class="btn btn-xs btn-success" title="'+__("Show details")+'"><i class="fa fa-magnifying-glass"></i></a> '+(a.processed&&!a.handled?'<button class="btn btn-xs btn-primary finalizeIcon" data-id="'+t+'" type="button" title="'+__("Finalize transaction")+'"><i class="fa fa-fw fa-edit"></i></button> ':"")+'<button class="btn btn-xs btn-danger deleteIcon" data-id="'+t+'" type="button" title="'+__("Delete")+'"><i class="fa fa-fw fa-trash"></i></button> '},className:"dt-nowrap",orderable:!1,searchable:!1}],createdRow:function(t,e){e.transaction_id||$("td:eq(4)",t).addClass("text-muted text-italic")},order:[[0,"asc"]],deferRender:!0,scrollY:"500px",scrollCollapse:!0,stateSave:!1,processing:!0,paging:!1,responsive:!0,initComplete:function(t){$(t.nTable).on("click","td > button.finalizeIcon:not(.busy)",function(){let e=$(t.nTable).DataTable().row($(this).parents("tr")),a=document.createElement("form");a.setAttribute("method","POST"),a.setAttribute("action",window.route("transactions.createFromDraft"));let i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name","_token"),i.setAttribute("value",csrfToken),a.appendChild(i);let r=window.mails.find(c=>c.id===e.data().id),n=document.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("name","transaction"),n.setAttribute("value",JSON.stringify(r.transaction_data)),a.appendChild(n),n=document.createElement("input"),n.setAttribute("type","hidden"),n.setAttribute("name","mail_id"),n.setAttribute("value",r.id),a.appendChild(n),document.body.appendChild(a),a.submit()}),$(t.nTable).on("click","td > button.deleteIcon:not(.busy)",function(){if(!confirm(__("Are you sure to want to delete this item?")))return;let e=$(t.nTable).DataTable().row($(this).parents("tr"));$(this).addClass("busy"),$(this).children("i").removeClass().addClass("fa fa-fw fa-spinner fa-spin"),$.ajax({type:"DELETE",url:window.route("api.received-mail.destroy",+e.data().id),data:{_token:csrfToken},dataType:"json",context:this,success:function(a){window.mails=window.mails.filter(r=>r.id!==a.receivedMail.id),e.remove().draw();let i=new CustomEvent("toast",{detail:{header:__("Success"),body:__("Email deleted"),toastClass:"bg-success",delay:2e3}});window.dispatchEvent(i)},error:function(a){let i=new CustomEvent("toast",{detail:{header:__("Error"),body:__("Error while trying to delete email"),toastClass:"bg-danger"}});window.dispatchEvent(i)}})})}});$("input[name=table_filter_processed]").on("change",function(){table.column(2).search(this.value).draw()});$("input[name=table_filter_handled]").on("change",function(){table.column(3).search(this.value).draw()});$("#table_filter_search_text").keyup(function(){table.search($(this).val()).draw()});u(d);const o=f({});o.config.globalProperties.__=window.__;o.component("transaction-show-modal",p);o.mount("#app");
