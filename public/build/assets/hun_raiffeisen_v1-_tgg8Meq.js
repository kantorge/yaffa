var ot=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);import{m as st,p as ut}from"./app-KLFPBacJ.js";var It=ot((qt,at)=>{var Z={},re={},ce={},fe={},Le;function lt(){if(Le)return fe;Le=1,Object.defineProperty(fe,"__esModule",{value:!0});function n(s){for(var f=s.length,O=5381,t=52711,o;f--;)o=s.charCodeAt(f),O=O*33^o,t=t*33^o;return(O>>>0)*4096+(t>>>0)}var e="|",i=/\[object ([HTML|SVG](.*)Element)\]/,r={"[object Arguments]":0,"[object Array]":1,"[object ArrayBuffer]":2,"[object AsyncFunction]":3,"[object AsyncGeneratorFunction]":4,"[object BigInt]":5,"[object BigInt64Array]":6,"[object BigUint64Array]":7,"[object Boolean]":8,"[object DataView]":9,"[object Date]":10,"[object DocumentFragment]":11,"[object Error]":12,"[object Event]":13,"[object Float32Array]":14,"[object Float64Array]":15,"[object Function]":16,"[object Generator]":17,"[object GeneratorFunction]":18,"[object Int8Array]":19,"[object Int16Array]":20,"[object Map]":21,"[object Number]":22,"[object Object]":23,"[object Promise]":24,"[object RegExp]":25,"[object Set]":26,"[object SharedArrayBuffer]":27,"[object String]":28,"[object Uint8Array]":29,"[object Uint8ClampedArray]":30,"[object Uint16Array]":31,"[object Uint32Array]":32,"[object WeakMap]":33,"[object WeakRef]":34,"[object WeakSet]":35,CUSTOM:36,ELEMENT:37},a={"[object Arguments]":1,"[object Array]":2},c={"[object Generator]":1,"[object Promise]":2,"[object WeakMap]":3,"[object WeakRef]":4,"[object WeakSet]":5},u={"[object AsyncFunction]":1,"[object AsyncGeneratorFunction]":2,"[object Boolean]":3,"[object Function]":4,"[object GeneratorFunction]":5,"[object Number]":6,"[object String]":7},d={"[object BigInt64Array]":1,"[object BigUint64Array]":2,"[object Float32Array]":3,"[object Float64Array]":4,"[object Int8Array]":5,"[object Int16Array]":6,"[object Uint8Array]":7,"[object Uint8ClampedArray]":8,"[object Uint16Array]":9,"[object Uint32Array]":10},p={"[object Arguments]":1,"[object Array]":2,"[object ArrayBuffer]":3,"[object BigInt64Array]":4,"[object BigUint64Array]":5,"[object DataView]":6,"[object Float32Array]":7,"[object Float64Array]":8,"[object Int8Array]":9,"[object Int16Array]":10,"[object Map]":11,"[object Object]":12,"[object Set]":13,"[object SharedArrayBuffer]":14,"[object Uint8Array]":15,"[object Uint8ClampedArray]":16,"[object Uint16Array]":17,"[object Uint32Array]":18,CUSTOM:19},y={bigint:"i",boolean:"b",empty:"e",function:"g",number:"n",object:"o",string:"s",symbol:"s"};function b(s,f){return s[0]>f[0]}function x(s,f){return s>f}function w(s,f){for(var O,t,o=0;o<s.length;++o){for(t=s[o],O=o-1;~O&&f(s[O],t);--O)s[O+1]=s[O];s[O+1]=t}return s}function h(s,f){return y.object+e+r[s]+e+f}var _=new WeakMap,P=0;function S(s,f){var O=_.get(s);if(O)return O;var t=h(f,"NOT_ENUMERABLE"+e+P++);return _.set(s,t),t}var M=Object.prototype.toString;function k(s,f,O){if(p[f])return D(f,s,O);if(f==="[object Date]")return h(f,s.getTime());if(f==="[object RegExp]")return h(f,s.toString());if(f==="[object Event]")return h(f,[s.bubbles,s.cancelBubble,s.cancelable,s.composed,s.currentTarget,s.defaultPrevented,s.eventPhase,s.isTrusted,s.returnValue,s.target,s.type].join());if(f==="[object Error]")return h(f,s.message+e+s.stack);if(f==="[object DocumentFragment]")return h(f,X(s));var t=f.match(i);return t?h("ELEMENT",t[1]+e+s.outerHTML):c[f]?S(s,f):u[f]?h(f,s.toString()):D("CUSTOM",s,O)}function D(s,f,O){var t=O.cache.get(f);return t?h(s,"RECURSIVE~"+t):(O.cache.set(f,++O.id),s==="[object Object]"?f[Symbol.iterator]?S(f,s):h(s,ee(f,O)):a[s]?h(s,I(f,O)):s==="[object Map]"?h(s,W(f,O)):s==="[object Set]"?h(s,B(f,O)):d[s]?h(s,f.join()):s==="[object ArrayBuffer]"?h(s,V(f)):s==="[object DataView]"?h(s,V(f.buffer)):c[s]?S(f,s):h("CUSTOM",ee(f,O)))}function I(s,f){for(var O=s.length,t=new Array(O);--O>=0;)t[O]=N(s[O],f);return t.join()}function F(s){return Buffer.from(s).toString("utf8")}function q(s){return String.fromCharCode.apply(null,new Uint16Array(s))}function U(){return"UNSUPPORTED"}function X(s){for(var f=s.children,O=f.length,t=new Array(O);--O>=0;)t[O]=f[O].outerHTML;return t.join()}var V=typeof Buffer<"u"&&typeof Buffer.from=="function"?F:typeof Uint16Array=="function"?q:U;function W(s,f){var O=new Array(s.size),t=0;for(s.forEach(function(o,l){O[t++]=[N(l,f),N(o,f)]}),w(O,b);--t>=0;)O[t]="["+O[t][0]+","+O[t][1]+"]";return"["+O.join()+"]"}function ee(s,f){for(var O=w(Object.getOwnPropertyNames(s),x),t=O.length,o=new Array(t),l=t;--l>=0;)o[l]=O[l]+":"+N(s[O[l]],f);return"{"+o.join()+"}"}function B(s,f){var O=new Array(s.size),t=0;return s.forEach(function(o){O[t++]=N(o,f)}),"["+w(O,x).join()+"]"}function N(s,f){var O=typeof s;return s==null||O==="undefined"?y.empty+s:O==="object"?k(s,M.call(s),f||{cache:new WeakMap,id:1}):O==="function"||O==="symbol"?y[O]+s.toString():O==="boolean"?y.boolean+ +s:y[O]+s}function T(s){return n(N(s,void 0))}return fe.default=T,fe}var Te;function De(){if(Te)return ce;Te=1,Object.defineProperty(ce,"__esModule",{value:!0});var n=(function(){function u(d,p){for(var y=0;y<p.length;y++){var b=p[y];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(d,b.key,b)}}return function(d,p,y){return p&&u(d.prototype,p),y&&u(d,y),d}})(),e=lt(),i=r(e);function r(u){return u&&u.__esModule?u:{default:u}}function a(u,d){if(!(u instanceof d))throw new TypeError("Cannot call a class as a function")}var c=(function(){function u(d,p,y){a(this,u),this.id=d;var b={cache:!0};if(typeof y>"u"&&(y=b),typeof p!="function"?(this.value=p,this.type=this.constructor.CONSTANT):(this.calculationMethod=p,this.type=this.constructor.DYNAMIC),!this.id)throw new Error("factId required");return this.priority=parseInt(y.priority||1,10),this.options=Object.assign({},b,y),this.cacheKeyMethod=this.defaultCacheKeys,this}return n(u,[{key:"isConstant",value:function(){return this.type===this.constructor.CONSTANT}},{key:"isDynamic",value:function(){return this.type===this.constructor.DYNAMIC}},{key:"calculate",value:function(p,y){return Object.prototype.hasOwnProperty.call(this,"value")?this.value:this.calculationMethod(p,y)}},{key:"defaultCacheKeys",value:function(p,y){return{params:y,id:p}}},{key:"getCacheKey",value:function(p){if(this.options.cache===!0){var y=this.cacheKeyMethod(this.id,p),b=u.hashFromObject(y);return b}}}],[{key:"hashFromObject",value:function(p){return(0,i.default)(p)}}]),u})();return c.CONSTANT="CONSTANT",c.DYNAMIC="DYNAMIC",ce.default=c,ce}var he={},de={},pe={},Ie;function le(){if(Ie)return pe;Ie=1;var n={};Object.defineProperty(pe,"__esModule",{value:!0});function e(){try{if(typeof process<"u"&&n&&n.DEBUG&&n.DEBUG.match(/json-rules-engine/)||typeof window<"u"&&window.localStorage&&window.localStorage.debug&&window.localStorage.debug.match(/json-rules-engine/))return console.debug.bind(console)}catch{}return function(){}}return pe.default=e(),pe}var Ne;function et(){if(Ne)return de;Ne=1,Object.defineProperty(de,"__esModule",{value:!0});var n=(function(){function d(p,y){var b=[],x=!0,w=!1,h=void 0;try{for(var _=p[Symbol.iterator](),P;!(x=(P=_.next()).done)&&(b.push(P.value),!(y&&b.length===y));x=!0);}catch(S){w=!0,h=S}finally{try{!x&&_.return&&_.return()}finally{if(w)throw h}}return b}return function(p,y){if(Array.isArray(p))return p;if(Symbol.iterator in Object(p))return d(p,y);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),e=(function(){function d(p,y){for(var b=0;b<y.length;b++){var x=y[b];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(p,x.key,x)}}return function(p,y,b){return y&&d(p.prototype,y),b&&d(p,b),p}})(),i=le(),r=a(i);function a(d){return d&&d.__esModule?d:{default:d}}function c(d,p){if(!(d instanceof p))throw new TypeError("Cannot call a class as a function")}var u=(function(){function d(p){if(c(this,d),!p)throw new Error("Condition: constructor options required");var y=d.booleanOperator(p);if(Object.assign(this,p),y){var b=p[y],x=Array.isArray(b);if(y!=="not"&&!x)throw new Error('"'+y+'" must be an array');if(y==="not"&&x)throw new Error('"'+y+'" cannot be an array');this.operator=y,this.priority=parseInt(p.priority,10)||1,x?this[y]=b.map(function(w){return new d(w)}):this[y]=new d(b)}else if(!Object.prototype.hasOwnProperty.call(p,"condition")){if(!Object.prototype.hasOwnProperty.call(p,"fact"))throw new Error('Condition: constructor "fact" property required');if(!Object.prototype.hasOwnProperty.call(p,"operator"))throw new Error('Condition: constructor "operator" property required');if(!Object.prototype.hasOwnProperty.call(p,"value"))throw new Error('Condition: constructor "value" property required');Object.prototype.hasOwnProperty.call(p,"priority")&&(p.priority=parseInt(p.priority,10))}}return e(d,[{key:"toJSON",value:function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,b={};this.priority&&(b.priority=this.priority),this.name&&(b.name=this.name);var x=d.booleanOperator(this);return x?Array.isArray(this[x])?b[x]=this[x].map(function(w){return w.toJSON(!1)}):b[x]=this[x].toJSON(!1):this.isConditionReference()?b.condition=this.condition:(b.operator=this.operator,b.value=this.value,b.fact=this.fact,this.factResult!==void 0&&(b.factResult=this.factResult),this.valueResult!==void 0&&(b.valueResult=this.valueResult),this.result!==void 0&&(b.result=this.result),this.params&&(b.params=this.params),this.path&&(b.path=this.path)),y?JSON.stringify(b):b}},{key:"evaluate",value:function(y,b){var x=this;if(!y)return Promise.reject(new Error("almanac required"));if(!b)return Promise.reject(new Error("operatorMap required"));if(this.isBooleanOperator())return Promise.reject(new Error("Cannot evaluate() a boolean condition"));var w=b.get(this.operator);return w?Promise.all([y.getValue(this.value),y.factValue(this.fact,this.params,this.path)]).then(function(h){var _=n(h,2),P=_[0],S=_[1],M=w.evaluate(S,P);return(0,r.default)("condition::evaluate",{leftHandSideValue:S,operator:x.operator,rightHandSideValue:P,result:M}),{result:M,leftHandSideValue:S,rightHandSideValue:P,operator:x.operator}}):Promise.reject(new Error("Unknown operator: "+this.operator))}},{key:"booleanOperator",value:function(){return d.booleanOperator(this)}},{key:"isBooleanOperator",value:function(){return d.booleanOperator(this)!==void 0}},{key:"isConditionReference",value:function(){return Object.prototype.hasOwnProperty.call(this,"condition")}}],[{key:"booleanOperator",value:function(y){if(Object.prototype.hasOwnProperty.call(y,"any"))return"any";if(Object.prototype.hasOwnProperty.call(y,"all"))return"all";if(Object.prototype.hasOwnProperty.call(y,"not"))return"not"}}]),d})();return de.default=u,de}var ve={},je={exports:{}},Ue;function tt(){return Ue||(Ue=1,(function(n){var e=(function(){function i(w,h){return h!=null&&w instanceof h}var r;try{r=Map}catch{r=function(){}}var a;try{a=Set}catch{a=function(){}}var c;try{c=Promise}catch{c=function(){}}function u(w,h,_,P,S){typeof h=="object"&&(_=h.depth,P=h.prototype,S=h.includeNonEnumerable,h=h.circular);var M=[],k=[],D=typeof Buffer<"u";typeof h>"u"&&(h=!0),typeof _>"u"&&(_=1/0);function I(F,q){if(F===null)return null;if(q===0)return F;var U,X;if(typeof F!="object")return F;if(i(F,r))U=new r;else if(i(F,a))U=new a;else if(i(F,c))U=new c(function(O,t){F.then(function(o){O(I(o,q-1))},function(o){t(I(o,q-1))})});else if(u.__isArray(F))U=[];else if(u.__isRegExp(F))U=new RegExp(F.source,x(F)),F.lastIndex&&(U.lastIndex=F.lastIndex);else if(u.__isDate(F))U=new Date(F.getTime());else{if(D&&Buffer.isBuffer(F))return Buffer.allocUnsafe?U=Buffer.allocUnsafe(F.length):U=new Buffer(F.length),F.copy(U),U;i(F,Error)?U=Object.create(F):typeof P>"u"?(X=Object.getPrototypeOf(F),U=Object.create(X)):(U=Object.create(P),X=P)}if(h){var V=M.indexOf(F);if(V!=-1)return k[V];M.push(F),k.push(U)}i(F,r)&&F.forEach(function(O,t){var o=I(t,q-1),l=I(O,q-1);U.set(o,l)}),i(F,a)&&F.forEach(function(O){var t=I(O,q-1);U.add(t)});for(var W in F){var ee;X&&(ee=Object.getOwnPropertyDescriptor(X,W)),!(ee&&ee.set==null)&&(U[W]=I(F[W],q-1))}if(Object.getOwnPropertySymbols)for(var B=Object.getOwnPropertySymbols(F),W=0;W<B.length;W++){var N=B[W],T=Object.getOwnPropertyDescriptor(F,N);T&&!T.enumerable&&!S||(U[N]=I(F[N],q-1),T.enumerable||Object.defineProperty(U,N,{enumerable:!1}))}if(S)for(var s=Object.getOwnPropertyNames(F),W=0;W<s.length;W++){var f=s[W],T=Object.getOwnPropertyDescriptor(F,f);T&&T.enumerable||(U[f]=I(F[f],q-1),Object.defineProperty(U,f,{enumerable:!1}))}return U}return I(w,_)}u.clonePrototype=function(h){if(h===null)return null;var _=function(){};return _.prototype=h,new _};function d(w){return Object.prototype.toString.call(w)}u.__objToStr=d;function p(w){return typeof w=="object"&&d(w)==="[object Date]"}u.__isDate=p;function y(w){return typeof w=="object"&&d(w)==="[object Array]"}u.__isArray=y;function b(w){return typeof w=="object"&&d(w)==="[object RegExp]"}u.__isRegExp=b;function x(w){var h="";return w.global&&(h+="g"),w.ignoreCase&&(h+="i"),w.multiline&&(h+="m"),h}return u.__getRegExpFlags=x,u})();n.exports&&(n.exports=e)})(je)),je.exports}var Be;function ct(){if(Be)return ve;Be=1,Object.defineProperty(ve,"__esModule",{value:!0});var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},e=(function(){function d(p,y){for(var b=0;b<y.length;b++){var x=y[b];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(p,x.key,x)}}return function(p,y,b){return y&&d(p.prototype,y),b&&d(p,b),p}})(),i=tt(),r=a(i);function a(d){return d&&d.__esModule?d:{default:d}}function c(d,p){if(!(d instanceof p))throw new TypeError("Cannot call a class as a function")}var u=(function(){function d(p,y,b,x){c(this,d),this.conditions=(0,r.default)(p),this.event=(0,r.default)(y),this.priority=(0,r.default)(b),this.name=(0,r.default)(x),this.result=null}return e(d,[{key:"setResult",value:function(y){this.result=y}},{key:"resolveEventParams",value:function(y){var b=this;if(this.event.params!==null&&n(this.event.params)==="object"){var x=[],w=function(P){Object.prototype.hasOwnProperty.call(b.event.params,P)&&x.push(y.getValue(b.event.params[P]).then(function(S){return b.event.params[P]=S}))};for(var h in this.event.params)w(h);return Promise.all(x)}return Promise.resolve()}},{key:"toJSON",value:function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,b={conditions:this.conditions.toJSON(!1),event:this.event,priority:this.priority,name:this.name,result:this.result};return y?JSON.stringify(b):b}}]),d})();return ve.default=u,ve}var Ce={exports:{}};var qe;function rt(){return qe||(qe=1,(function(n,e){(function(i){var r=Object.hasOwnProperty,a=Array.isArray?Array.isArray:function(o){return Object.prototype.toString.call(o)==="[object Array]"},c=10,u=typeof process=="object"&&typeof process.nextTick=="function",d=typeof Symbol=="function",p=typeof Reflect=="object",y=typeof setImmediate=="function",b=y?setImmediate:setTimeout,x=d?p&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(t){var o=Object.getOwnPropertyNames(t);return o.push.apply(o,Object.getOwnPropertySymbols(t)),o}:Object.keys;function w(){this._events={},this._conf&&h.call(this,this._conf)}function h(t){t&&(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),t.maxListeners!==i&&(this._maxListeners=t.maxListeners),t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this._newListener=t.newListener),t.removeListener&&(this._removeListener=t.removeListener),t.verboseMemoryLeak&&(this.verboseMemoryLeak=t.verboseMemoryLeak),t.ignoreErrors&&(this.ignoreErrors=t.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function _(t,o){var l="(node) warning: possible EventEmitter memory leak detected. "+t+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(l+=" Event name: "+o+"."),typeof process<"u"&&process.emitWarning){var v=new Error(l);v.name="MaxListenersExceededWarning",v.emitter=this,v.count=t,process.emitWarning(v)}else console.error(l),console.trace&&console.trace()}var P=function(t,o,l){var v=arguments.length;switch(v){case 0:return[];case 1:return[t];case 2:return[t,o];case 3:return[t,o,l];default:for(var g=new Array(v);v--;)g[v]=arguments[v];return g}};function S(t,o){for(var l={},v,g=t.length,E=0,A=0;A<g;A++)v=t[A],l[v]=A<E?o[A]:i;return l}function M(t,o,l){this._emitter=t,this._target=o,this._listeners={},this._listenersCount=0;var v,g;if((l.on||l.off)&&(v=l.on,g=l.off),o.addEventListener?(v=o.addEventListener,g=o.removeEventListener):o.addListener?(v=o.addListener,g=o.removeListener):o.on&&(v=o.on,g=o.off),!v&&!g)throw Error("target does not implement any known event API");if(typeof v!="function")throw TypeError("on method must be a function");if(typeof g!="function")throw TypeError("off method must be a function");this._on=v,this._off=g;var E=t._observers;E?E.push(this):t._observers=[this]}Object.assign(M.prototype,{subscribe:function(t,o,l){var v=this,g=this._target,E=this._emitter,A=this._listeners,C=function(){var R=P.apply(null,arguments),j={data:R,name:o,original:t};if(l){var L=l.call(g,j);L!==!1&&E.emit.apply(E,[j.name].concat(R));return}E.emit.apply(E,[o].concat(R))};if(A[t])throw Error("Event '"+t+"' is already listening");this._listenersCount++,E._newListener&&E._removeListener&&!v._onNewListener?(this._onNewListener=function(R){R===o&&A[t]===null&&(A[t]=C,v._on.call(g,t,C))},E.on("newListener",this._onNewListener),this._onRemoveListener=function(R){R===o&&!E.hasListeners(R)&&A[t]&&(A[t]=null,v._off.call(g,t,C))},A[t]=null,E.on("removeListener",this._onRemoveListener)):(A[t]=C,v._on.call(g,t,C))},unsubscribe:function(t){var o=this,l=this._listeners,v=this._emitter,g,E,A=this._off,C=this._target,R;if(t&&typeof t!="string")throw TypeError("event must be a string");function j(){o._onNewListener&&(v.off("newListener",o._onNewListener),v.off("removeListener",o._onRemoveListener),o._onNewListener=null,o._onRemoveListener=null);var L=X.call(v,o);v._observers.splice(L,1)}if(t){if(g=l[t],!g)return;A.call(C,t,g),delete l[t],--this._listenersCount||j()}else{for(E=x(l),R=E.length;R-- >0;)t=E[R],A.call(C,t,l[t]);this._listeners={},this._listenersCount=0,j()}}});function k(t,o,l,v){var g=Object.assign({},o);if(!t)return g;if(typeof t!="object")throw TypeError("options must be an object");var E=Object.keys(t),A=E.length,C,R,j;function L(z){throw Error('Invalid "'+C+'" option value'+(z?". Reason: "+z:""))}for(var Q=0;Q<A;Q++){if(C=E[Q],!r.call(o,C))throw Error('Unknown "'+C+'" option');R=t[C],R!==i&&(j=l[C],g[C]=j?j(R,L):R)}return g}function D(t,o){return(typeof t!="function"||!t.hasOwnProperty("prototype"))&&o("value must be a constructor"),t}function I(t){var o="value must be type of "+t.join("|"),l=t.length,v=t[0],g=t[1];return l===1?function(E,A){if(typeof E===v)return E;A(o)}:l===2?function(E,A){var C=typeof E;if(C===v||C===g)return E;A(o)}:function(E,A){for(var C=typeof E,R=l;R-- >0;)if(C===t[R])return E;A(o)}}var F=I(["function"]),q=I(["object","function"]);function U(t,o,l){var v,g,E=0,A,C=new t(function(R,j,L){l=k(l,{timeout:0,overload:!1},{timeout:function(G,J){return G*=1,(typeof G!="number"||G<0||!Number.isFinite(G))&&J("timeout must be a positive number"),G}}),v=!l.overload&&typeof t.prototype.cancel=="function"&&typeof L=="function";function Q(){g&&(g=null),E&&(clearTimeout(E),E=0)}var z=function(G){Q(),R(G)},H=function(G){Q(),j(G)};v?o(z,H,L):(g=[function(G){H(G||Error("canceled"))}],o(z,H,function(G){if(A)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof G!="function")throw TypeError("onCancel callback must be a function");g.push(G)}),A=!0),l.timeout>0&&(E=setTimeout(function(){var G=Error("timeout");G.code="ETIMEDOUT",E=0,C.cancel(G),j(G)},l.timeout))});return v||(C.cancel=function(R){if(g){for(var j=g.length,L=1;L<j;L++)g[L](R);g[0](R),g=null}}),C}function X(t){var o=this._observers;if(!o)return-1;for(var l=o.length,v=0;v<l;v++)if(o[v]._target===t)return v;return-1}function V(t,o,l,v,g){if(!l)return null;if(v===0){var E=typeof o;if(E==="string"){var A,C,R=0,j=0,L=this.delimiter,Q=L.length;if((C=o.indexOf(L))!==-1){A=new Array(5);do A[R++]=o.slice(j,C),j=C+Q;while((C=o.indexOf(L,j))!==-1);A[R++]=o.slice(j),o=A,g=R}else o=[o],g=1}else E==="object"?g=o.length:(o=[o],g=1)}var z=null,H,G,J,xe,Ae,ue=o[v],Re=o[v+1],ne,te;if(v===g)l._listeners&&(typeof l._listeners=="function"?(t&&t.push(l._listeners),z=[l]):(t&&t.push.apply(t,l._listeners),z=[l]));else if(ue==="*"){for(ne=x(l),C=ne.length;C-- >0;)H=ne[C],H!=="_listeners"&&(te=V(t,o,l[H],v+1,g),te&&(z?z.push.apply(z,te):z=te));return z}else if(ue==="**"){for(Ae=v+1===g||v+2===g&&Re==="*",Ae&&l._listeners&&(z=V(t,o,l,g,g)),ne=x(l),C=ne.length;C-- >0;)H=ne[C],H!=="_listeners"&&(H==="*"||H==="**"?(l[H]._listeners&&!Ae&&(te=V(t,o,l[H],g,g),te&&(z?z.push.apply(z,te):z=te)),te=V(t,o,l[H],v,g)):H===Re?te=V(t,o,l[H],v+2,g):te=V(t,o,l[H],v,g),te&&(z?z.push.apply(z,te):z=te));return z}else l[ue]&&(z=V(t,o,l[ue],v+1,g));if(G=l["*"],G&&V(t,o,G,v+1,g),J=l["**"],J)if(v<g)for(J._listeners&&V(t,o,J,g,g),ne=x(J),C=ne.length;C-- >0;)H=ne[C],H!=="_listeners"&&(H===Re?V(t,o,J[H],v+2,g):H===ue?V(t,o,J[H],v+1,g):(xe={},xe[H]=J[H],V(t,o,{"**":xe},v+1,g)));else J._listeners?V(t,o,J,g,g):J["*"]&&J["*"]._listeners&&V(t,o,J["*"],g,g);return z}function W(t,o,l){var v=0,g=0,E,A=this.delimiter,C=A.length,R;if(typeof t=="string")if((E=t.indexOf(A))!==-1){R=new Array(5);do R[v++]=t.slice(g,E),g=E+C;while((E=t.indexOf(A,g))!==-1);R[v++]=t.slice(g)}else R=[t],v=1;else R=t,v=t.length;if(v>1){for(E=0;E+1<v;E++)if(R[E]==="**"&&R[E+1]==="**")return}var j=this.listenerTree,L;for(E=0;E<v;E++)if(L=R[E],j=j[L]||(j[L]={}),E===v-1)return j._listeners?(typeof j._listeners=="function"&&(j._listeners=[j._listeners]),l?j._listeners.unshift(o):j._listeners.push(o),!j._listeners.warned&&this._maxListeners>0&&j._listeners.length>this._maxListeners&&(j._listeners.warned=!0,_.call(this,j._listeners.length,L))):j._listeners=o,!0;return!0}function ee(t,o,l,v){for(var g=x(t),E=g.length,A,C,R,j=t._listeners,L;E-- >0;)C=g[E],A=t[C],C==="_listeners"?R=l:R=l?l.concat(C):[C],L=v||typeof C=="symbol",j&&o.push(L?R:R.join(this.delimiter)),typeof A=="object"&&ee.call(this,A,o,R,L);return o}function B(t){for(var o=x(t),l=o.length,v,g,E;l-- >0;)g=o[l],v=t[g],v&&(E=!0,g!=="_listeners"&&!B(v)&&delete t[g]);return E}function N(t,o,l){this.emitter=t,this.event=o,this.listener=l}N.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function T(t,o,l){if(l===!0)g=!0;else if(l===!1)v=!0;else{if(!l||typeof l!="object")throw TypeError("options should be an object or true");var v=l.async,g=l.promisify,E=l.nextTick,A=l.objectify}if(v||E||g){var C=o,R=o._origin||o;if(E&&!u)throw Error("process.nextTick is not supported");g===i&&(g=o.constructor.name==="AsyncFunction"),o=function(){var j=arguments,L=this,Q=this.event;return g?E?Promise.resolve():new Promise(function(z){b(z)}).then(function(){return L.event=Q,C.apply(L,j)}):(E?process.nextTick:b)(function(){L.event=Q,C.apply(L,j)})},o._async=!0,o._origin=R}return[o,A?new N(this,t,o):this]}function s(t){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,h.call(this,t)}s.EventEmitter2=s,s.prototype.listenTo=function(t,o,l){if(typeof t!="object")throw TypeError("target musts be an object");var v=this;l=k(l,{on:i,off:i,reducers:i},{on:F,off:F,reducers:q});function g(E){if(typeof E!="object")throw TypeError("events must be an object");var A=l.reducers,C=X.call(v,t),R;C===-1?R=new M(v,t,l):R=v._observers[C];for(var j=x(E),L=j.length,Q,z=typeof A=="function",H=0;H<L;H++)Q=j[H],R.subscribe(Q,E[Q]||Q,z?A:A&&A[Q])}return a(o)?g(S(o)):g(typeof o=="string"?S(o.split(/\s+/)):o),this},s.prototype.stopListeningTo=function(t,o){var l=this._observers;if(!l)return!1;var v=l.length,g,E=!1;if(t&&typeof t!="object")throw TypeError("target should be an object");for(;v-- >0;)g=l[v],(!t||g._target===t)&&(g.unsubscribe(o),E=!0);return E},s.prototype.delimiter=".",s.prototype.setMaxListeners=function(t){t!==i&&(this._maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t)},s.prototype.getMaxListeners=function(){return this._maxListeners},s.prototype.event="",s.prototype.once=function(t,o,l){return this._once(t,o,!1,l)},s.prototype.prependOnceListener=function(t,o,l){return this._once(t,o,!0,l)},s.prototype._once=function(t,o,l,v){return this._many(t,1,o,l,v)},s.prototype.many=function(t,o,l,v){return this._many(t,o,l,!1,v)},s.prototype.prependMany=function(t,o,l,v){return this._many(t,o,l,!0,v)},s.prototype._many=function(t,o,l,v,g){var E=this;if(typeof l!="function")throw new Error("many only accepts instances of Function");function A(){return--o===0&&E.off(t,A),l.apply(this,arguments)}return A._origin=l,this._on(t,A,v,g)},s.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||w.call(this);var t=arguments[0],o,l=this.wildcard,v,g,E,A,C;if(t==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(l&&(o=t,t!=="newListener"&&t!=="removeListener"&&typeof t=="object")){if(g=t.length,d){for(E=0;E<g;E++)if(typeof t[E]=="symbol"){C=!0;break}}C||(t=t.join(this.delimiter))}var R=arguments.length,j;if(this._all&&this._all.length)for(j=this._all.slice(),E=0,g=j.length;E<g;E++)switch(this.event=t,R){case 1:j[E].call(this,t);break;case 2:j[E].call(this,t,arguments[1]);break;case 3:j[E].call(this,t,arguments[1],arguments[2]);break;default:j[E].apply(this,arguments)}if(l)j=[],V.call(this,j,o,this.listenerTree,0,g);else if(j=this._events[t],typeof j=="function"){switch(this.event=t,R){case 1:j.call(this);break;case 2:j.call(this,arguments[1]);break;case 3:j.call(this,arguments[1],arguments[2]);break;default:for(v=new Array(R-1),A=1;A<R;A++)v[A-1]=arguments[A];j.apply(this,v)}return!0}else j&&(j=j.slice());if(j&&j.length){if(R>3)for(v=new Array(R-1),A=1;A<R;A++)v[A-1]=arguments[A];for(E=0,g=j.length;E<g;E++)switch(this.event=t,R){case 1:j[E].call(this);break;case 2:j[E].call(this,arguments[1]);break;case 3:j[E].call(this,arguments[1],arguments[2]);break;default:j[E].apply(this,v)}return!0}else if(!this.ignoreErrors&&!this._all&&t==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},s.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||w.call(this);var t=arguments[0],o=this.wildcard,l,v,g,E,A,C;if(t==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(o&&(l=t,t!=="newListener"&&t!=="removeListener"&&typeof t=="object")){if(E=t.length,d){for(A=0;A<E;A++)if(typeof t[A]=="symbol"){v=!0;break}}v||(t=t.join(this.delimiter))}var R=[],j=arguments.length,L;if(this._all)for(A=0,E=this._all.length;A<E;A++)switch(this.event=t,j){case 1:R.push(this._all[A].call(this,t));break;case 2:R.push(this._all[A].call(this,t,arguments[1]));break;case 3:R.push(this._all[A].call(this,t,arguments[1],arguments[2]));break;default:R.push(this._all[A].apply(this,arguments))}if(o?(L=[],V.call(this,L,l,this.listenerTree,0)):L=this._events[t],typeof L=="function")switch(this.event=t,j){case 1:R.push(L.call(this));break;case 2:R.push(L.call(this,arguments[1]));break;case 3:R.push(L.call(this,arguments[1],arguments[2]));break;default:for(g=new Array(j-1),C=1;C<j;C++)g[C-1]=arguments[C];R.push(L.apply(this,g))}else if(L&&L.length){if(L=L.slice(),j>3)for(g=new Array(j-1),C=1;C<j;C++)g[C-1]=arguments[C];for(A=0,E=L.length;A<E;A++)switch(this.event=t,j){case 1:R.push(L[A].call(this));break;case 2:R.push(L[A].call(this,arguments[1]));break;case 3:R.push(L[A].call(this,arguments[1],arguments[2]));break;default:R.push(L[A].apply(this,g))}}else if(!this.ignoreErrors&&!this._all&&t==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(R)},s.prototype.on=function(t,o,l){return this._on(t,o,!1,l)},s.prototype.prependListener=function(t,o,l){return this._on(t,o,!0,l)},s.prototype.onAny=function(t){return this._onAny(t,!1)},s.prototype.prependAny=function(t){return this._onAny(t,!0)},s.prototype.addListener=s.prototype.on,s.prototype._onAny=function(t,o){if(typeof t!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),o?this._all.unshift(t):this._all.push(t),this},s.prototype._on=function(t,o,l,v){if(typeof t=="function")return this._onAny(t,o),this;if(typeof o!="function")throw new Error("on only accepts instances of Function");this._events||w.call(this);var g=this,E;return v!==i&&(E=T.call(this,t,o,v),o=E[0],g=E[1]),this._newListener&&this.emit("newListener",t,o),this.wildcard?(W.call(this,t,o,l),g):(this._events[t]?(typeof this._events[t]=="function"&&(this._events[t]=[this._events[t]]),l?this._events[t].unshift(o):this._events[t].push(o),!this._events[t].warned&&this._maxListeners>0&&this._events[t].length>this._maxListeners&&(this._events[t].warned=!0,_.call(this,this._events[t].length,t))):this._events[t]=o,g)},s.prototype.off=function(t,o){if(typeof o!="function")throw new Error("removeListener only takes instances of Function");var l,v=[];if(this.wildcard){var g=typeof t=="string"?t.split(this.delimiter):t.slice();if(v=V.call(this,null,g,this.listenerTree,0),!v)return this}else{if(!this._events[t])return this;l=this._events[t],v.push({_listeners:l})}for(var E=0;E<v.length;E++){var A=v[E];if(l=A._listeners,a(l)){for(var C=-1,R=0,j=l.length;R<j;R++)if(l[R]===o||l[R].listener&&l[R].listener===o||l[R]._origin&&l[R]._origin===o){C=R;break}if(C<0)continue;return this.wildcard?A._listeners.splice(C,1):this._events[t].splice(C,1),l.length===0&&(this.wildcard?delete A._listeners:delete this._events[t]),this._removeListener&&this.emit("removeListener",t,o),this}else(l===o||l.listener&&l.listener===o||l._origin&&l._origin===o)&&(this.wildcard?delete A._listeners:delete this._events[t],this._removeListener&&this.emit("removeListener",t,o))}return this.listenerTree&&B(this.listenerTree),this},s.prototype.offAny=function(t){var o=0,l=0,v;if(t&&this._all&&this._all.length>0){for(v=this._all,o=0,l=v.length;o<l;o++)if(t===v[o])return v.splice(o,1),this._removeListener&&this.emit("removeListenerAny",t),this}else{if(v=this._all,this._removeListener)for(o=0,l=v.length;o<l;o++)this.emit("removeListenerAny",v[o]);this._all=[]}return this},s.prototype.removeListener=s.prototype.off,s.prototype.removeAllListeners=function(t){if(t===i)return!this._events||w.call(this),this;if(this.wildcard){var o=V.call(this,null,t,this.listenerTree,0),l,v;if(!o)return this;for(v=0;v<o.length;v++)l=o[v],l._listeners=null;this.listenerTree&&B(this.listenerTree)}else this._events&&(this._events[t]=null);return this},s.prototype.listeners=function(t){var o=this._events,l,v,g,E,A;if(t===i){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!o)return[];for(l=x(o),E=l.length,g=[];E-- >0;)v=o[l[E]],typeof v=="function"?g.push(v):g.push.apply(g,v);return g}else{if(this.wildcard){if(A=this.listenerTree,!A)return[];var C=[],R=typeof t=="string"?t.split(this.delimiter):t.slice();return V.call(this,C,R,A,0),C}return o?(v=o[t],v?typeof v=="function"?[v]:v:[]):[]}},s.prototype.eventNames=function(t){var o=this._events;return this.wildcard?ee.call(this,this.listenerTree,[],null,t):o?x(o):[]},s.prototype.listenerCount=function(t){return this.listeners(t).length},s.prototype.hasListeners=function(t){if(this.wildcard){var o=[],l=typeof t=="string"?t.split(this.delimiter):t.slice();return V.call(this,o,l,this.listenerTree,0),o.length>0}var v=this._events,g=this._all;return!!(g&&g.length||v&&(t===i?x(v).length:v[t]))},s.prototype.listenersAny=function(){return this._all?this._all:[]},s.prototype.waitFor=function(t,o){var l=this,v=typeof o;return v==="number"?o={timeout:o}:v==="function"&&(o={filter:o}),o=k(o,{timeout:0,filter:i,handleError:!1,Promise,overload:!1},{filter:F,Promise:D}),U(o.Promise,function(g,E,A){function C(){var R=o.filter;if(!(R&&!R.apply(l,arguments)))if(l.off(t,C),o.handleError){var j=arguments[0];j?E(j):g(P.apply(null,arguments).slice(1))}else g(P.apply(null,arguments))}A(function(){l.off(t,C)}),l._on(t,C,!1)},{timeout:o.timeout,overload:o.overload})};function f(t,o,l){l=k(l,{Promise,timeout:0,overload:!1},{Promise:D});var v=l.Promise;return U(v,function(g,E,A){var C;if(typeof t.addEventListener=="function"){C=function(){g(P.apply(null,arguments))},A(function(){t.removeEventListener(o,C)}),t.addEventListener(o,C,{once:!0});return}var R=function(){j&&t.removeListener("error",j),g(P.apply(null,arguments))},j;o!=="error"&&(j=function(L){t.removeListener(o,R),E(L)},t.once("error",j)),A(function(){j&&t.removeListener("error",j),t.removeListener(o,R)}),t.once(o,R)},{timeout:l.timeout,overload:l.overload})}var O=s.prototype;Object.defineProperties(s,{defaultMaxListeners:{get:function(){return O._maxListeners},set:function(t){if(typeof t!="number"||t<0||Number.isNaN(t))throw TypeError("n must be a non-negative number");O._maxListeners=t},enumerable:!0},once:{value:f,writable:!0,configurable:!0}}),Object.defineProperties(O,{_maxListeners:{value:c,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),n.exports=s})()})(Ce)),Ce.exports}var Ve;function nt(){if(Ve)return he;Ve=1,Object.defineProperty(he,"__esModule",{value:!0});var n=(function(){function S(M,k){for(var D=0;D<k.length;D++){var I=k[D];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(M,I.key,I)}}return function(M,k,D){return k&&S(M.prototype,k),D&&S(M,D),M}})(),e=et(),i=x(e),r=ct(),a=x(r),c=le(),u=x(c),d=tt(),p=x(d),y=rt(),b=x(y);function x(S){return S&&S.__esModule?S:{default:S}}function w(S,M){if(!(S instanceof M))throw new TypeError("Cannot call a class as a function")}function h(S,M){if(!S)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M&&(typeof M=="object"||typeof M=="function")?M:S}function _(S,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof M);S.prototype=Object.create(M&&M.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}),M&&(Object.setPrototypeOf?Object.setPrototypeOf(S,M):S.__proto__=M)}var P=(function(S){_(M,S);function M(k){w(this,M);var D=h(this,(M.__proto__||Object.getPrototypeOf(M)).call(this));typeof k=="string"&&(k=JSON.parse(k)),k&&k.conditions&&D.setConditions(k.conditions),k&&k.onSuccess&&D.on("success",k.onSuccess),k&&k.onFailure&&D.on("failure",k.onFailure),k&&(k.name||k.name===0)&&D.setName(k.name);var I=k&&k.priority||1;D.setPriority(I);var F=k&&k.event||{type:"unknown"};return D.setEvent(F),D}return n(M,[{key:"setPriority",value:function(D){if(D=parseInt(D,10),D<=0)throw new Error("Priority must be greater than zero");return this.priority=D,this}},{key:"setName",value:function(D){if(!D&&D!==0)throw new Error('Rule "name" must be defined');return this.name=D,this}},{key:"setConditions",value:function(D){if(!Object.prototype.hasOwnProperty.call(D,"all")&&!Object.prototype.hasOwnProperty.call(D,"any")&&!Object.prototype.hasOwnProperty.call(D,"not")&&!Object.prototype.hasOwnProperty.call(D,"condition"))throw new Error('"conditions" root must contain a single instance of "all", "any", "not", or "condition"');return this.conditions=new i.default(D),this}},{key:"setEvent",value:function(D){if(!D)throw new Error("Rule: setEvent() requires event object");if(!Object.prototype.hasOwnProperty.call(D,"type"))throw new Error('Rule: setEvent() requires event object with "type" property');return this.ruleEvent={type:D.type},this.event=this.ruleEvent,D.params&&(this.ruleEvent.params=D.params),this}},{key:"getEvent",value:function(){return this.ruleEvent}},{key:"getPriority",value:function(){return this.priority}},{key:"getConditions",value:function(){return this.conditions}},{key:"getEngine",value:function(){return this.engine}},{key:"setEngine",value:function(D){return this.engine=D,this}},{key:"toJSON",value:function(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,I={conditions:this.conditions.toJSON(!1),priority:this.priority,event:this.ruleEvent,name:this.name};return D?JSON.stringify(I):I}},{key:"prioritizeConditions",value:function(D){var I=this,F=D.reduce(function(q,U){var X=U.priority;if(!X){var V=I.engine.getFact(U.fact);X=V&&V.priority||1}return q[X]||(q[X]=[]),q[X].push(U),q},{});return Object.keys(F).sort(function(q,U){return Number(q)>Number(U)?-1:1}).map(function(q){return F[q]})}},{key:"evaluate",value:function(D){var I=this,F=new a.default(this.conditions,this.ruleEvent,this.priority,this.name),q=function(s){if(s.isConditionReference())return B(s);if(s.isBooleanOperator()){var f=s[s.operator],O=void 0;return s.operator==="all"?O=W(f):s.operator==="any"?O=V(f):O=ee(f),O.then(function(t){var o=t===!0;return s.result=o,o})}else return s.evaluate(D,I.engine.operators).then(function(t){var o=t.result;return s.factResult=t.leftHandSideValue,s.valueResult=t.rightHandSideValue,s.result=o,o})},U=function(s,f){return Array.isArray(s)||(s=[s]),Promise.all(s.map(function(O){return q(O)})).then(function(O){return(0,u.default)("rule::evaluateConditions",{results:O}),f.call(O,function(t){return t===!0})})},X=function(s,f){if(s.length===0)return Promise.resolve(!0);if(s.length===1)return q(s[0]);for(var O=I.prioritizeConditions(s),t=Promise.resolve(f==="all"),o=function(g){var E=O[g];t=t.then(function(A){return f==="any"?A||U(E,Array.prototype.some):A&&U(E,Array.prototype.every)})},l=0;l<O.length;l++)o(l);return t},V=function(s){return X(s,"any")},W=function(s){return X(s,"all")},ee=function(s){return X([s],"not").then(function(f){return!f})},B=function(s){var f=I.engine.conditions.get(s.condition);if(f)return delete s.condition,Object.assign(s,(0,p.default)(f)),q(s);if(I.engine.allowUndefinedConditions)return s.result=!1,Promise.resolve(!1);throw new Error("No condition "+s.condition+" exists")},N=function(s){F.setResult(s);var f=Promise.resolve();I.engine.replaceFactsInEventParams&&(f=F.resolveEventParams(D));var O=s?"success":"failure";return f.then(function(){return I.emitAsync(O,F.event,D,F)}).then(function(){return F})};return F.conditions.any?V(F.conditions.any).then(function(T){return N(T)}):F.conditions.all?W(F.conditions.all).then(function(T){return N(T)}):F.conditions.not?ee(F.conditions.not).then(function(T){return N(T)}):B(F.conditions).then(function(T){return N(T)})}}]),M})(b.default);return he.default=P,he}var ye={},ge={},ze;function ft(){if(ze)return ge;ze=1,Object.defineProperty(ge,"__esModule",{value:!0});function n(r,a){if(!(r instanceof a))throw new TypeError("Cannot call a class as a function")}function e(r,a){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&(typeof a=="object"||typeof a=="function")?a:r}function i(r,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);r.prototype=Object.create(a&&a.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(r,a):r.__proto__=a)}return ge.UndefinedFactError=(function(r){i(a,r);function a(){var c;n(this,a);for(var u=arguments.length,d=Array(u),p=0;p<u;p++)d[p]=arguments[p];var y=e(this,(c=a.__proto__||Object.getPrototypeOf(a)).call.apply(c,[this].concat(d)));return y.code="UNDEFINED_FACT",y}return a})(Error),ge}class ht{add(e,i,r){if(typeof arguments[0]!="string")for(let a in arguments[0])this.add(a,arguments[0][a],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(a){this[a]=this[a]||[],i&&this[a][r?"unshift":"push"](i)},this)}run(e,i){this[e]=this[e]||[],this[e].forEach(function(r){r.call(i&&i.context?i.context:i,i)})}}class dt{constructor(e){this.jsep=e,this.registered={}}register(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];i.forEach(a=>{if(typeof a!="object"||!a.name||!a.init)throw new Error("Invalid JSEP plugin format");this.registered[a.name]||(a.init(this.jsep),this.registered[a.name]=a)})}}class m{static get version(){return"1.4.0"}static toString(){return"JavaScript Expression Parser (JSEP) v"+m.version}static addUnaryOp(e){return m.max_unop_len=Math.max(e.length,m.max_unop_len),m.unary_ops[e]=1,m}static addBinaryOp(e,i,r){return m.max_binop_len=Math.max(e.length,m.max_binop_len),m.binary_ops[e]=i,r?m.right_associative.add(e):m.right_associative.delete(e),m}static addIdentifierChar(e){return m.additional_identifier_chars.add(e),m}static addLiteral(e,i){return m.literals[e]=i,m}static removeUnaryOp(e){return delete m.unary_ops[e],e.length===m.max_unop_len&&(m.max_unop_len=m.getMaxKeyLen(m.unary_ops)),m}static removeAllUnaryOps(){return m.unary_ops={},m.max_unop_len=0,m}static removeIdentifierChar(e){return m.additional_identifier_chars.delete(e),m}static removeBinaryOp(e){return delete m.binary_ops[e],e.length===m.max_binop_len&&(m.max_binop_len=m.getMaxKeyLen(m.binary_ops)),m.right_associative.delete(e),m}static removeAllBinaryOps(){return m.binary_ops={},m.max_binop_len=0,m}static removeLiteral(e){return delete m.literals[e],m}static removeAllLiterals(){return m.literals={},m}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new m(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(i=>i.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return m.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!m.binary_ops[String.fromCharCode(e)]||m.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return m.isIdentifierStart(e)||m.isDecimalDigit(e)}throwError(e){const i=new Error(e+" at character "+this.index);throw i.index=this.index,i.description=e,i}runHook(e,i){if(m.hooks[e]){const r={context:this,node:i};return m.hooks.run(e,r),r.node}return i}searchHook(e){if(m.hooks[e]){const i={context:this};return m.hooks[e].find(function(r){return r.call(i.context,i),i.node}),i.node}}gobbleSpaces(){let e=this.code;for(;e===m.SPACE_CODE||e===m.TAB_CODE||e===m.LF_CODE||e===m.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");const e=this.gobbleExpressions(),i=e.length===1?e[0]:{type:m.COMPOUND,body:e};return this.runHook("after-all",i)}gobbleExpressions(e){let i=[],r,a;for(;this.index<this.expr.length;)if(r=this.code,r===m.SEMCOL_CODE||r===m.COMMA_CODE)this.index++;else if(a=this.gobbleExpression())i.push(a);else if(this.index<this.expr.length){if(r===e)break;this.throwError('Unexpected "'+this.char+'"')}return i}gobbleExpression(){const e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,m.max_binop_len),i=e.length;for(;i>0;){if(m.binary_ops.hasOwnProperty(e)&&(!m.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!m.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=i,e;e=e.substr(0,--i)}return!1}gobbleBinaryExpression(){let e,i,r,a,c,u,d,p,y;if(u=this.gobbleToken(),!u||(i=this.gobbleBinaryOp(),!i))return u;for(c={value:i,prec:m.binaryPrecedence(i),right_a:m.right_associative.has(i)},d=this.gobbleToken(),d||this.throwError("Expected expression after "+i),a=[u,c,d];i=this.gobbleBinaryOp();){if(r=m.binaryPrecedence(i),r===0){this.index-=i.length;break}c={value:i,prec:r,right_a:m.right_associative.has(i)},y=i;const b=x=>c.right_a&&x.right_a?r>x.prec:r<=x.prec;for(;a.length>2&&b(a[a.length-2]);)d=a.pop(),i=a.pop().value,u=a.pop(),e={type:m.BINARY_EXP,operator:i,left:u,right:d},a.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+y),a.push(c,e)}for(p=a.length-1,e=a[p];p>1;)e={type:m.BINARY_EXP,operator:a[p-1].value,left:a[p-2],right:e},p-=2;return e}gobbleToken(){let e,i,r,a;if(this.gobbleSpaces(),a=this.searchHook("gobble-token"),a)return this.runHook("after-token",a);if(e=this.code,m.isDecimalDigit(e)||e===m.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===m.SQUOTE_CODE||e===m.DQUOTE_CODE)a=this.gobbleStringLiteral();else if(e===m.OBRACK_CODE)a=this.gobbleArray();else{for(i=this.expr.substr(this.index,m.max_unop_len),r=i.length;r>0;){if(m.unary_ops.hasOwnProperty(i)&&(!m.isIdentifierStart(this.code)||this.index+i.length<this.expr.length&&!m.isIdentifierPart(this.expr.charCodeAt(this.index+i.length)))){this.index+=r;const c=this.gobbleToken();return c||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:m.UNARY_EXP,operator:i,argument:c,prefix:!0})}i=i.substr(0,--r)}m.isIdentifierStart(e)?(a=this.gobbleIdentifier(),m.literals.hasOwnProperty(a.name)?a={type:m.LITERAL,value:m.literals[a.name],raw:a.name}:a.name===m.this_str&&(a={type:m.THIS_EXP})):e===m.OPAREN_CODE&&(a=this.gobbleGroup())}return a?(a=this.gobbleTokenProperty(a),this.runHook("after-token",a)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let i=this.code;for(;i===m.PERIOD_CODE||i===m.OBRACK_CODE||i===m.OPAREN_CODE||i===m.QUMARK_CODE;){let r;if(i===m.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==m.PERIOD_CODE)break;r=!0,this.index+=2,this.gobbleSpaces(),i=this.code}this.index++,i===m.OBRACK_CODE?(e={type:m.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},e.property||this.throwError('Unexpected "'+this.char+'"'),this.gobbleSpaces(),i=this.code,i!==m.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):i===m.OPAREN_CODE?e={type:m.CALL_EXP,arguments:this.gobbleArguments(m.CPAREN_CODE),callee:e}:(i===m.PERIOD_CODE||r)&&(r&&this.index--,this.gobbleSpaces(),e={type:m.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),r&&(e.optional=!0),this.gobbleSpaces(),i=this.code}return e}gobbleNumericLiteral(){let e="",i,r;for(;m.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===m.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);m.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(i=this.char,i==="e"||i==="E"){for(e+=this.expr.charAt(this.index++),i=this.char,(i==="+"||i==="-")&&(e+=this.expr.charAt(this.index++));m.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);m.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return r=this.code,m.isIdentifierStart(r)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(r===m.PERIOD_CODE||e.length===1&&e.charCodeAt(0)===m.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:m.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="";const i=this.index,r=this.expr.charAt(this.index++);let a=!1;for(;this.index<this.expr.length;){let c=this.expr.charAt(this.index++);if(c===r){a=!0;break}else if(c==="\\")switch(c=this.expr.charAt(this.index++),c){case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=c}else e+=c}return a||this.throwError('Unclosed quote after "'+e+'"'),{type:m.LITERAL,value:e,raw:this.expr.substring(i,this.index)}}gobbleIdentifier(){let e=this.code,i=this.index;for(m.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,m.isIdentifierPart(e));)this.index++;return{type:m.IDENTIFIER,name:this.expr.slice(i,this.index)}}gobbleArguments(e){const i=[];let r=!1,a=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let c=this.code;if(c===e){r=!0,this.index++,e===m.CPAREN_CODE&&a&&a>=i.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}else if(c===m.COMMA_CODE){if(this.index++,a++,a!==i.length){if(e===m.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===m.CBRACK_CODE)for(let u=i.length;u<a;u++)i.push(null)}}else if(i.length!==a&&a!==0)this.throwError("Expected comma");else{const u=this.gobbleExpression();(!u||u.type===m.COMPOUND)&&this.throwError("Expected comma"),i.push(u)}}return r||this.throwError("Expected "+String.fromCharCode(e)),i}gobbleGroup(){this.index++;let e=this.gobbleExpressions(m.CPAREN_CODE);if(this.code===m.CPAREN_CODE)return this.index++,e.length===1?e[0]:e.length?{type:m.SEQUENCE_EXP,expressions:e}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:m.ARRAY_EXP,elements:this.gobbleArguments(m.CBRACK_CODE)}}}const pt=new ht;Object.assign(m,{hooks:pt,plugins:new dt(m),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"??":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10,"**":11},right_associative:new Set(["**"]),additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});m.max_unop_len=m.getMaxKeyLen(m.unary_ops);m.max_binop_len=m.getMaxKeyLen(m.binary_ops);const ie=n=>new m(n).parse(),vt=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(m).filter(n=>!vt.includes(n)&&ie[n]===void 0).forEach(n=>{ie[n]=m[n]});ie.Jsep=m;const yt="ConditionalExpression";var gt={name:"ternary",init(n){n.hooks.add("after-expression",function(i){if(i.node&&this.code===n.QUMARK_CODE){this.index++;const r=i.node,a=this.gobbleExpression();if(a||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===n.COLON_CODE){this.index++;const c=this.gobbleExpression();if(c||this.throwError("Expected expression"),i.node={type:yt,test:r,consequent:a,alternate:c},r.operator&&n.binary_ops[r.operator]<=.9){let u=r;for(;u.right.operator&&n.binary_ops[u.right.operator]<=.9;)u=u.right;i.node.test=u.right,u.right=i.node,i.node=r}}else this.throwError("Expected :")}})}};ie.plugins.register(gt);const $e=47,mt=92;var bt={name:"regex",init(n){n.hooks.add("gobble-token",function(i){if(this.code===$e){const r=++this.index;let a=!1;for(;this.index<this.expr.length;){if(this.code===$e&&!a){const c=this.expr.slice(r,this.index);let u="";for(;++this.index<this.expr.length;){const p=this.code;if(p>=97&&p<=122||p>=65&&p<=90||p>=48&&p<=57)u+=this.char;else break}let d;try{d=new RegExp(c,u)}catch(p){this.throwError(p.message)}return i.node={type:n.LITERAL,value:d,raw:this.expr.slice(r-1,this.index)},i.node=this.gobbleTokenProperty(i.node),i.node}this.code===n.OBRACK_CODE?a=!0:a&&this.code===n.CBRACK_CODE&&(a=!1),this.index+=this.code===mt?2:1}this.throwError("Unclosed Regex")}})}};const Pe=43,_t=45,oe={name:"assignment",assignmentOperators:new Set(["=","*=","**=","/=","%=","+=","-=","<<=",">>=",">>>=","&=","^=","|=","||=","&&=","??="]),updateOperators:[Pe,_t],assignmentPrecedence:.9,init(n){const e=[n.IDENTIFIER,n.MEMBER_EXP];oe.assignmentOperators.forEach(r=>n.addBinaryOp(r,oe.assignmentPrecedence,!0)),n.hooks.add("gobble-token",function(a){const c=this.code;oe.updateOperators.some(u=>u===c&&u===this.expr.charCodeAt(this.index+1))&&(this.index+=2,a.node={type:"UpdateExpression",operator:c===Pe?"++":"--",argument:this.gobbleTokenProperty(this.gobbleIdentifier()),prefix:!0},(!a.node.argument||!e.includes(a.node.argument.type))&&this.throwError(`Unexpected ${a.node.operator}`))}),n.hooks.add("after-token",function(a){if(a.node){const c=this.code;oe.updateOperators.some(u=>u===c&&u===this.expr.charCodeAt(this.index+1))&&(e.includes(a.node.type)||this.throwError(`Unexpected ${a.node.operator}`),this.index+=2,a.node={type:"UpdateExpression",operator:c===Pe?"++":"--",argument:a.node,prefix:!1})}}),n.hooks.add("after-expression",function(a){a.node&&i(a.node)});function i(r){oe.assignmentOperators.has(r.operator)?(r.type="AssignmentExpression",i(r.left),i(r.right)):r.operator||Object.values(r).forEach(a=>{a&&typeof a=="object"&&i(a)})}}};ie.plugins.register(bt,oe);ie.addUnaryOp("typeof");ie.addLiteral("null",null);ie.addLiteral("undefined",void 0);const wt=new Set(["constructor","__proto__","__defineGetter__","__defineSetter__"]),Y={evalAst(n,e){switch(n.type){case"BinaryExpression":case"LogicalExpression":return Y.evalBinaryExpression(n,e);case"Compound":return Y.evalCompound(n,e);case"ConditionalExpression":return Y.evalConditionalExpression(n,e);case"Identifier":return Y.evalIdentifier(n,e);case"Literal":return Y.evalLiteral(n,e);case"MemberExpression":return Y.evalMemberExpression(n,e);case"UnaryExpression":return Y.evalUnaryExpression(n,e);case"ArrayExpression":return Y.evalArrayExpression(n,e);case"CallExpression":return Y.evalCallExpression(n,e);case"AssignmentExpression":return Y.evalAssignmentExpression(n,e);default:throw SyntaxError("Unexpected expression",n)}},evalBinaryExpression(n,e){return{"||":(r,a)=>r||a(),"&&":(r,a)=>r&&a(),"|":(r,a)=>r|a(),"^":(r,a)=>r^a(),"&":(r,a)=>r&a(),"==":(r,a)=>r==a(),"!=":(r,a)=>r!=a(),"===":(r,a)=>r===a(),"!==":(r,a)=>r!==a(),"<":(r,a)=>r<a(),">":(r,a)=>r>a(),"<=":(r,a)=>r<=a(),">=":(r,a)=>r>=a(),"<<":(r,a)=>r<<a(),">>":(r,a)=>r>>a(),">>>":(r,a)=>r>>>a(),"+":(r,a)=>r+a(),"-":(r,a)=>r-a(),"*":(r,a)=>r*a(),"/":(r,a)=>r/a(),"%":(r,a)=>r%a()}[n.operator](Y.evalAst(n.left,e),()=>Y.evalAst(n.right,e))},evalCompound(n,e){let i;for(let r=0;r<n.body.length;r++){n.body[r].type==="Identifier"&&["var","let","const"].includes(n.body[r].name)&&n.body[r+1]&&n.body[r+1].type==="AssignmentExpression"&&(r+=1);const a=n.body[r];i=Y.evalAst(a,e)}return i},evalConditionalExpression(n,e){return Y.evalAst(n.test,e)?Y.evalAst(n.consequent,e):Y.evalAst(n.alternate,e)},evalIdentifier(n,e){if(Object.hasOwn(e,n.name))return e[n.name];throw ReferenceError(`${n.name} is not defined`)},evalLiteral(n){return n.value},evalMemberExpression(n,e){const i=String(n.computed?Y.evalAst(n.property):n.property.name),r=Y.evalAst(n.object,e);if(r==null)throw TypeError(`Cannot read properties of ${r} (reading '${i}')`);if(!Object.hasOwn(r,i)&&wt.has(i))throw TypeError(`Cannot read properties of ${r} (reading '${i}')`);const a=r[i];return typeof a=="function"?a.bind(r):a},evalUnaryExpression(n,e){return{"-":r=>-Y.evalAst(r,e),"!":r=>!Y.evalAst(r,e),"~":r=>~Y.evalAst(r,e),"+":r=>+Y.evalAst(r,e),typeof:r=>typeof Y.evalAst(r,e)}[n.operator](n.argument)},evalArrayExpression(n,e){return n.elements.map(i=>Y.evalAst(i,e))},evalCallExpression(n,e){const i=n.arguments.map(a=>Y.evalAst(a,e));return Y.evalAst(n.callee,e)(...i)},evalAssignmentExpression(n,e){if(n.left.type!=="Identifier")throw SyntaxError("Invalid left-hand side in assignment");const i=n.left.name,r=Y.evalAst(n.right,e);return e[i]=r,e[i]}};class Et{constructor(e){this.code=e,this.ast=ie(this.code)}runInNewContext(e){const i=Object.assign(Object.create(null),e);return Y.evalAst(this.ast,i)}}function ae(n,e){return n=n.slice(),n.push(e),n}function ke(n,e){return e=e.slice(),e.unshift(n),e}class Ot extends Error{constructor(e){super('JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)'),this.avoidNew=!0,this.value=e,this.name="NewError"}}function K(n,e,i,r,a){if(!(this instanceof K))try{return new K(n,e,i,r,a)}catch(u){if(!u.avoidNew)throw u;return u.value}typeof n=="string"&&(a=r,r=i,i=e,e=n,n=null);const c=n&&typeof n=="object";if(n=n||{},this.json=n.json||i,this.path=n.path||e,this.resultType=n.resultType||"value",this.flatten=n.flatten||!1,this.wrap=Object.hasOwn(n,"wrap")?n.wrap:!0,this.sandbox=n.sandbox||{},this.eval=n.eval===void 0?"safe":n.eval,this.ignoreEvalErrors=typeof n.ignoreEvalErrors>"u"?!1:n.ignoreEvalErrors,this.parent=n.parent||null,this.parentProperty=n.parentProperty||null,this.callback=n.callback||r||null,this.otherTypeCallback=n.otherTypeCallback||a||function(){throw new TypeError("You must supply an otherTypeCallback callback option with the @other() operator.")},n.autostart!==!1){const u={path:c?n.path:e};c?"json"in n&&(u.json=n.json):u.json=i;const d=this.evaluate(u);if(!d||typeof d!="object")throw new Ot(d);return d}}K.prototype.evaluate=function(n,e,i,r){let a=this.parent,c=this.parentProperty,{flatten:u,wrap:d}=this;if(this.currResultType=this.resultType,this.currEval=this.eval,this.currSandbox=this.sandbox,i=i||this.callback,this.currOtherTypeCallback=r||this.otherTypeCallback,e=e||this.json,n=n||this.path,n&&typeof n=="object"&&!Array.isArray(n)){if(!n.path&&n.path!=="")throw new TypeError('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');if(!Object.hasOwn(n,"json"))throw new TypeError('You must supply a "json" property when providing an object argument to JSONPath.evaluate().');({json:e}=n),u=Object.hasOwn(n,"flatten")?n.flatten:u,this.currResultType=Object.hasOwn(n,"resultType")?n.resultType:this.currResultType,this.currSandbox=Object.hasOwn(n,"sandbox")?n.sandbox:this.currSandbox,d=Object.hasOwn(n,"wrap")?n.wrap:d,this.currEval=Object.hasOwn(n,"eval")?n.eval:this.currEval,i=Object.hasOwn(n,"callback")?n.callback:i,this.currOtherTypeCallback=Object.hasOwn(n,"otherTypeCallback")?n.otherTypeCallback:this.currOtherTypeCallback,a=Object.hasOwn(n,"parent")?n.parent:a,c=Object.hasOwn(n,"parentProperty")?n.parentProperty:c,n=n.path}if(a=a||null,c=c||null,Array.isArray(n)&&(n=K.toPathString(n)),!n&&n!==""||!e)return;const p=K.toPathArray(n);p[0]==="$"&&p.length>1&&p.shift(),this._hasParentSelector=null;const y=this._trace(p,e,["$"],a,c,i).filter(function(b){return b&&!b.isParentSelector});return y.length?!d&&y.length===1&&!y[0].hasArrExpr?this._getPreferredOutput(y[0]):y.reduce((b,x)=>{const w=this._getPreferredOutput(x);return u&&Array.isArray(w)?b=b.concat(w):b.push(w),b},[]):d?[]:void 0};K.prototype._getPreferredOutput=function(n){const e=this.currResultType;switch(e){case"all":{const i=Array.isArray(n.path)?n.path:K.toPathArray(n.path);return n.pointer=K.toPointer(i),n.path=typeof n.path=="string"?n.path:K.toPathString(n.path),n}case"value":case"parent":case"parentProperty":return n[e];case"path":return K.toPathString(n[e]);case"pointer":return K.toPointer(n.path);default:throw new TypeError("Unknown result type")}};K.prototype._handleCallback=function(n,e,i){if(e){const r=this._getPreferredOutput(n);n.path=typeof n.path=="string"?n.path:K.toPathString(n.path),e(r,i,n)}};K.prototype._trace=function(n,e,i,r,a,c,u,d){let p;if(!n.length)return p={path:i,value:e,parent:r,parentProperty:a,hasArrExpr:u},this._handleCallback(p,c,"value"),p;const y=n[0],b=n.slice(1),x=[];function w(h){Array.isArray(h)?h.forEach(_=>{x.push(_)}):x.push(h)}if((typeof y!="string"||d)&&e&&Object.hasOwn(e,y))w(this._trace(b,e[y],ae(i,y),e,y,c,u));else if(y==="*")this._walk(e,h=>{w(this._trace(b,e[h],ae(i,h),e,h,c,!0,!0))});else if(y==="..")w(this._trace(b,e,i,r,a,c,u)),this._walk(e,h=>{typeof e[h]=="object"&&w(this._trace(n.slice(),e[h],ae(i,h),e,h,c,!0))});else{if(y==="^")return this._hasParentSelector=!0,{path:i.slice(0,-1),expr:b,isParentSelector:!0};if(y==="~")return p={path:ae(i,y),value:a,parent:r,parentProperty:null},this._handleCallback(p,c,"property"),p;if(y==="$")w(this._trace(b,e,i,null,null,c,u));else if(/^(-?\d*):(-?\d*):?(\d*)$/u.test(y))w(this._slice(y,b,e,i,r,a,c));else if(y.indexOf("?(")===0){if(this.currEval===!1)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");const h=y.replace(/^\?\((.*?)\)$/u,"$1"),_=/@.?([^?]*)[['](\??\(.*?\))(?!.\)\])[\]']/gu.exec(h);_?this._walk(e,P=>{const S=[_[2]],M=_[1]?e[P][_[1]]:e[P];this._trace(S,M,i,r,a,c,!0).length>0&&w(this._trace(b,e[P],ae(i,P),e,P,c,!0))}):this._walk(e,P=>{this._eval(h,e[P],P,i,r,a)&&w(this._trace(b,e[P],ae(i,P),e,P,c,!0))})}else if(y[0]==="("){if(this.currEval===!1)throw new Error("Eval [(expr)] prevented in JSONPath expression.");w(this._trace(ke(this._eval(y,e,i.at(-1),i.slice(0,-1),r,a),b),e,i,r,a,c,u))}else if(y[0]==="@"){let h=!1;const _=y.slice(1,-2);switch(_){case"scalar":(!e||!["object","function"].includes(typeof e))&&(h=!0);break;case"boolean":case"string":case"undefined":case"function":typeof e===_&&(h=!0);break;case"integer":Number.isFinite(e)&&!(e%1)&&(h=!0);break;case"number":Number.isFinite(e)&&(h=!0);break;case"nonFinite":typeof e=="number"&&!Number.isFinite(e)&&(h=!0);break;case"object":e&&typeof e===_&&(h=!0);break;case"array":Array.isArray(e)&&(h=!0);break;case"other":h=this.currOtherTypeCallback(e,i,r,a);break;case"null":e===null&&(h=!0);break;default:throw new TypeError("Unknown value type "+_)}if(h)return p={path:i,value:e,parent:r,parentProperty:a},this._handleCallback(p,c,"value"),p}else if(y[0]==="`"&&e&&Object.hasOwn(e,y.slice(1))){const h=y.slice(1);w(this._trace(b,e[h],ae(i,h),e,h,c,u,!0))}else if(y.includes(",")){const h=y.split(",");for(const _ of h)w(this._trace(ke(_,b),e,i,r,a,c,!0))}else!d&&e&&Object.hasOwn(e,y)&&w(this._trace(b,e[y],ae(i,y),e,y,c,u,!0))}if(this._hasParentSelector)for(let h=0;h<x.length;h++){const _=x[h];if(_&&_.isParentSelector){const P=this._trace(_.expr,e,_.path,r,a,c,u);if(Array.isArray(P)){x[h]=P[0];const S=P.length;for(let M=1;M<S;M++)h++,x.splice(h,0,P[M])}else x[h]=P}}return x};K.prototype._walk=function(n,e){if(Array.isArray(n)){const i=n.length;for(let r=0;r<i;r++)e(r)}else n&&typeof n=="object"&&Object.keys(n).forEach(i=>{e(i)})};K.prototype._slice=function(n,e,i,r,a,c,u){if(!Array.isArray(i))return;const d=i.length,p=n.split(":"),y=p[2]&&Number.parseInt(p[2])||1;let b=p[0]&&Number.parseInt(p[0])||0,x=p[1]&&Number.parseInt(p[1])||d;b=b<0?Math.max(0,b+d):Math.min(d,b),x=x<0?Math.max(0,x+d):Math.min(d,x);const w=[];for(let h=b;h<x;h+=y)this._trace(ke(h,e),i,r,a,c,u,!0).forEach(P=>{w.push(P)});return w};K.prototype._eval=function(n,e,i,r,a,c){this.currSandbox._$_parentProperty=c,this.currSandbox._$_parent=a,this.currSandbox._$_property=i,this.currSandbox._$_root=this.json,this.currSandbox._$_v=e;const u=n.includes("@path");u&&(this.currSandbox._$_path=K.toPathString(r.concat([i])));const d=this.currEval+"Script:"+n;if(!K.cache[d]){let p=n.replaceAll("@parentProperty","_$_parentProperty").replaceAll("@parent","_$_parent").replaceAll("@property","_$_property").replaceAll("@root","_$_root").replaceAll(/@([.\s)[])/gu,"_$_v$1");if(u&&(p=p.replaceAll("@path","_$_path")),this.currEval==="safe"||this.currEval===!0||this.currEval===void 0)K.cache[d]=new this.safeVm.Script(p);else if(this.currEval==="native")K.cache[d]=new this.vm.Script(p);else if(typeof this.currEval=="function"&&this.currEval.prototype&&Object.hasOwn(this.currEval.prototype,"runInNewContext")){const y=this.currEval;K.cache[d]=new y(p)}else if(typeof this.currEval=="function")K.cache[d]={runInNewContext:y=>this.currEval(p,y)};else throw new TypeError(`Unknown "eval" property "${this.currEval}"`)}try{return K.cache[d].runInNewContext(this.currSandbox)}catch(p){if(this.ignoreEvalErrors)return!1;throw new Error("jsonPath: "+p.message+": "+n)}};K.cache={};K.toPathString=function(n){const e=n,i=e.length;let r="$";for(let a=1;a<i;a++)/^(~|\^|@.*?\(\))$/u.test(e[a])||(r+=/^[0-9*]+$/u.test(e[a])?"["+e[a]+"]":"['"+e[a]+"']");return r};K.toPointer=function(n){const e=n,i=e.length;let r="";for(let a=1;a<i;a++)/^(~|\^|@.*?\(\))$/u.test(e[a])||(r+="/"+e[a].toString().replaceAll("~","~0").replaceAll("/","~1"));return r};K.toPathArray=function(n){const{cache:e}=K;if(e[n])return e[n].concat();const i=[],a=n.replaceAll(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/gu,";$&;").replaceAll(/[['](\??\(.*?\))[\]'](?!.\])/gu,function(c,u){return"[#"+(i.push(u)-1)+"]"}).replaceAll(/\[['"]([^'\]]*)['"]\]/gu,function(c,u){return"['"+u.replaceAll(".","%@%").replaceAll("~","%%@@%%")+"']"}).replaceAll("~",";~;").replaceAll(/['"]?\.['"]?(?![^[]*\])|\[['"]?/gu,";").replaceAll("%@%",".").replaceAll("%%@@%%","~").replaceAll(/(?:;)?(\^+)(?:;)?/gu,function(c,u){return";"+u.split("").join(";")+";"}).replaceAll(/;;;|;;/gu,";..;").replaceAll(/;$|'?\]|'$/gu,"").split(";").map(function(c){const u=c.match(/#(\d+)/u);return!u||!u[1]?c:i[u[1]]});return e[n]=a,e[n].concat()};K.prototype.safeVm={Script:Et};const xt=function(n,e,i){const r=n.length;for(let a=0;a<r;a++){const c=n[a];i(c)&&e.push(n.splice(a--,1)[0])}};class At{constructor(e){this.code=e}runInNewContext(e){let i=this.code;const r=Object.keys(e),a=[];xt(r,a,y=>typeof e[y]=="function");const c=r.map(y=>e[y]);i=a.reduce((y,b)=>{let x=e[b].toString();return/function/u.test(x)||(x="function "+x),"var "+b+"="+x+";"+y},"")+i,!/(['"])use strict\1/u.test(i)&&!r.includes("arguments")&&(i="var arguments = undefined;"+i),i=i.replace(/;\s*$/u,"");const d=i.lastIndexOf(";"),p=d!==-1?i.slice(0,d+1)+" return "+i.slice(d+1):" return "+i;return new Function(...r,p)(...c)}}K.prototype.vm={Script:At};const Rt=Object.freeze(Object.defineProperty({__proto__:null,JSONPath:K},Symbol.toStringTag,{value:"Module"})),jt=st(Rt);var Ke;function it(){if(Ke)return ye;Ke=1,Object.defineProperty(ye,"__esModule",{value:!0});var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},e=(function(){function w(h,_){for(var P=0;P<_.length;P++){var S=_[P];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(h,S.key,S)}}return function(h,_,P){return _&&w(h.prototype,_),P&&w(h,P),h}})(),i=De(),r=p(i),a=ft(),c=le(),u=p(c),d=jt;function p(w){return w&&w.__esModule?w:{default:w}}function y(w,h){if(!(w instanceof h))throw new TypeError("Cannot call a class as a function")}function b(w,h){return(0,d.JSONPath)({path:h,json:w,wrap:!1})}var x=(function(){function w(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};y(this,w),this.factMap=new Map,this.factResultsCache=new Map,this.allowUndefinedFacts=!!h.allowUndefinedFacts,this.pathResolver=h.pathResolver||b,this.events={success:[],failure:[]},this.ruleResults=[]}return e(w,[{key:"addEvent",value:function(_,P){if(!P)throw new Error('outcome required: "success" | "failure"]');this.events[P].push(_)}},{key:"getEvents",value:function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return _?this.events[_]:this.events.success.concat(this.events.failure)}},{key:"addResult",value:function(_){this.ruleResults.push(_)}},{key:"getResults",value:function(){return this.ruleResults}},{key:"_getFact",value:function(_){return this.factMap.get(_)}},{key:"_addConstantFact",value:function(_){this.factMap.set(_.id,_),this._setFactValue(_,{},_.value)}},{key:"_setFactValue",value:function(_,P,S){var M=_.getCacheKey(P),k=Promise.resolve(S);return M&&this.factResultsCache.set(M,k),k}},{key:"addFact",value:function(_,P,S){var M=_,k=void 0;return _ instanceof r.default?(M=_.id,k=_):k=new r.default(_,P,S),(0,u.default)("almanac::addFact",{id:M}),this.factMap.set(M,k),k.isConstant()&&this._setFactValue(k,{},k.value),this}},{key:"addRuntimeFact",value:function(_,P){(0,u.default)("almanac::addRuntimeFact",{id:_});var S=new r.default(_,P);return this._addConstantFact(S)}},{key:"factValue",value:function(_){var P=this,S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"",k=void 0,D=this._getFact(_);if(D===void 0)return this.allowUndefinedFacts?Promise.resolve(void 0):Promise.reject(new a.UndefinedFactError("Undefined fact: "+_));if(D.isConstant())k=Promise.resolve(D.calculate(S,this));else{var I=D.getCacheKey(S),F=I&&this.factResultsCache.get(I);F?(k=Promise.resolve(F),(0,u.default)("almanac::factValue cache hit for fact",{id:_})):((0,u.default)("almanac::factValue cache miss, calculating",{id:_}),k=this._setFactValue(D,S,D.calculate(S,this)))}return M?((0,u.default)("condition::evaluate extracting object",{property:M}),k.then(function(q){if(q!=null&&(typeof q>"u"?"undefined":n(q))==="object"){var U=P.pathResolver(q,M);return(0,u.default)("condition::evaluate extracting object",{property:M,received:U}),U}else return(0,u.default)("condition::evaluate could not compute object path of non-object",{path:M,factValue:q,type:typeof q>"u"?"undefined":n(q)}),q})):k}},{key:"getValue",value:function(_){return _!=null&&(typeof _>"u"?"undefined":n(_))==="object"&&Object.prototype.hasOwnProperty.call(_,"fact")?this.factValue(_.fact,_.params,_.path):Promise.resolve(_)}}]),w})();return ye.default=x,ye}var me={},be={},He;function Oe(){if(He)return be;He=1,Object.defineProperty(be,"__esModule",{value:!0});var n=(function(){function r(a,c){for(var u=0;u<c.length;u++){var d=c[u];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(a,c,u){return c&&r(a.prototype,c),u&&r(a,u),a}})();function e(r,a){if(!(r instanceof a))throw new TypeError("Cannot call a class as a function")}var i=(function(){function r(a,c,u){if(e(this,r),this.name=String(a),!a)throw new Error("Missing operator name");if(typeof c!="function")throw new Error("Missing operator callback");this.cb=c,this.factValueValidator=u,this.factValueValidator||(this.factValueValidator=function(){return!0})}return n(r,[{key:"evaluate",value:function(c,u){return this.factValueValidator(c)&&this.cb(c,u)}}]),r})();return be.default=i,be}var Ye;function Ct(){if(Ye)return me;Ye=1,Object.defineProperty(me,"__esModule",{value:!0});var n=Oe(),e=i(n);function i(c){return c&&c.__esModule?c:{default:c}}var r=[];r.push(new e.default("equal",function(c,u){return c===u})),r.push(new e.default("notEqual",function(c,u){return c!==u})),r.push(new e.default("in",function(c,u){return u.indexOf(c)>-1})),r.push(new e.default("notIn",function(c,u){return u.indexOf(c)===-1})),r.push(new e.default("contains",function(c,u){return c.indexOf(u)>-1},Array.isArray)),r.push(new e.default("doesNotContain",function(c,u){return c.indexOf(u)===-1},Array.isArray));function a(c){return Number.parseFloat(c).toString()!=="NaN"}return r.push(new e.default("lessThan",function(c,u){return c<u},a)),r.push(new e.default("lessThanInclusive",function(c,u){return c<=u},a)),r.push(new e.default("greaterThan",function(c,u){return c>u},a)),r.push(new e.default("greaterThanInclusive",function(c,u){return c>=u},a)),me.default=r,me}var _e={},we={},Xe;function Fe(){if(Xe)return we;Xe=1,Object.defineProperty(we,"__esModule",{value:!0});var n=(function(){function u(d,p){for(var y=0;y<p.length;y++){var b=p[y];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(d,b.key,b)}}return function(d,p,y){return p&&u(d.prototype,p),y&&u(d,y),d}})(),e=Oe(),i=r(e);function r(u){return u&&u.__esModule?u:{default:u}}function a(u,d){if(!(u instanceof d))throw new TypeError("Cannot call a class as a function")}var c=(function(){function u(d,p,y){if(a(this,u),this.name=String(d),!d)throw new Error("Missing decorator name");if(typeof p!="function")throw new Error("Missing decorator callback");this.cb=p,this.factValueValidator=y,this.factValueValidator||(this.factValueValidator=function(){return!0})}return n(u,[{key:"decorate",value:function(p){var y=this,b=p.evaluate.bind(p);return new i.default(this.name+":"+p.name,function(x,w){return y.cb(x,w,b)},this.factValueValidator)}}]),u})();return we.default=c,we}var Ge;function Pt(){if(Ge)return _e;Ge=1,Object.defineProperty(_e,"__esModule",{value:!0});var n=Fe(),e=i(n);function i(a){return a&&a.__esModule?a:{default:a}}var r=[];return r.push(new e.default("someFact",function(a,c,u){return a.some(function(d){return u(d,c)})},Array.isArray)),r.push(new e.default("someValue",function(a,c,u){return c.some(function(d){return u(a,d)})})),r.push(new e.default("everyFact",function(a,c,u){return a.every(function(d){return u(d,c)})},Array.isArray)),r.push(new e.default("everyValue",function(a,c,u){return c.every(function(d){return u(a,d)})})),r.push(new e.default("swap",function(a,c,u){return u(c,a)})),r.push(new e.default("not",function(a,c,u){return!u(a,c)})),_e.default=r,_e}var Ee={},We;function St(){if(We)return Ee;We=1,Object.defineProperty(Ee,"__esModule",{value:!0});var n=(function(){function b(x,w){for(var h=0;h<w.length;h++){var _=w[h];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(x,_.key,_)}}return function(x,w,h){return w&&b(x.prototype,w),h&&b(x,h),x}})(),e=Oe(),i=d(e),r=Fe(),a=d(r),c=le(),u=d(c);function d(b){return b&&b.__esModule?b:{default:b}}function p(b,x){if(!(b instanceof x))throw new TypeError("Cannot call a class as a function")}var y=(function(){function b(){p(this,b),this.operators=new Map,this.decorators=new Map}return n(b,[{key:"addOperator",value:function(w,h){var _=void 0;w instanceof i.default?_=w:_=new i.default(w,h),(0,u.default)("operatorMap::addOperator",{name:_.name}),this.operators.set(_.name,_)}},{key:"removeOperator",value:function(w){var h=void 0;w instanceof i.default?h=w.name:h=w;for(var _=":"+h,P=Array.from(this.operators.keys()),S=0;S<P.length;S++)P[S].endsWith(_)&&this.operators.delete(P[S]);return this.operators.delete(h)}},{key:"addOperatorDecorator",value:function(w,h){var _=void 0;w instanceof a.default?_=w:_=new a.default(w,h),(0,u.default)("operatorMap::addOperatorDecorator",{name:_.name}),this.decorators.set(_.name,_)}},{key:"removeOperatorDecorator",value:function(w){var h=void 0;w instanceof a.default?h=w.name:h=w;for(var _=h+":",P=Array.from(this.operators.keys()),S=0;S<P.length;S++)P[S].includes(_)&&this.operators.delete(P[S]);return this.decorators.delete(h)}},{key:"get",value:function(w){for(var h=[],_=w;!this.operators.has(_);){var P=_.indexOf(":");if(P>0){var S=_.slice(0,P),M=this.decorators.get(S);if(!M)return(0,u.default)("operatorMap::get invalid decorator",{name:S}),null;h.unshift(M),_=_.slice(P+1)}else return(0,u.default)("operatorMap::get no operator",{name:_}),null}for(var k=this.operators.get(_),D=0;D<h.length;D++)k=h[D].decorate(k),this.operators.set(k.name,k);return k}}]),b})();return Ee.default=y,Ee}var Qe;function kt(){if(Qe)return re;Qe=1,Object.defineProperty(re,"__esModule",{value:!0}),re.FINISHED=re.RUNNING=re.READY=void 0;var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},e=(function(){function B(N,T){for(var s=0;s<T.length;s++){var f=T[s];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(N,f.key,f)}}return function(N,T,s){return T&&B(N.prototype,T),s&&B(N,s),N}})(),i=De(),r=I(i),a=nt(),c=I(a),u=it(),d=I(u),p=rt(),y=I(p),b=Ct(),x=I(b),w=Pt(),h=I(w),_=le(),P=I(_),S=et(),M=I(S),k=St(),D=I(k);function I(B){return B&&B.__esModule?B:{default:B}}function F(B,N){if(!(B instanceof N))throw new TypeError("Cannot call a class as a function")}function q(B,N){if(!B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return N&&(typeof N=="object"||typeof N=="function")?N:B}function U(B,N){if(typeof N!="function"&&N!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof N);B.prototype=Object.create(N&&N.prototype,{constructor:{value:B,enumerable:!1,writable:!0,configurable:!0}}),N&&(Object.setPrototypeOf?Object.setPrototypeOf(B,N):B.__proto__=N)}var X=re.READY="READY",V=re.RUNNING="RUNNING",W=re.FINISHED="FINISHED",ee=(function(B){U(N,B);function N(){var T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};F(this,N);var f=q(this,(N.__proto__||Object.getPrototypeOf(N)).call(this));return f.rules=[],f.allowUndefinedFacts=s.allowUndefinedFacts||!1,f.allowUndefinedConditions=s.allowUndefinedConditions||!1,f.replaceFactsInEventParams=s.replaceFactsInEventParams||!1,f.pathResolver=s.pathResolver,f.operators=new D.default,f.facts=new Map,f.conditions=new Map,f.status=X,T.map(function(O){return f.addRule(O)}),x.default.map(function(O){return f.addOperator(O)}),h.default.map(function(O){return f.addOperatorDecorator(O)}),f}return e(N,[{key:"addRule",value:function(s){if(!s)throw new Error("Engine: addRule() requires options");var f=void 0;if(s instanceof c.default)f=s;else{if(!Object.prototype.hasOwnProperty.call(s,"event"))throw new Error('Engine: addRule() argument requires "event" property');if(!Object.prototype.hasOwnProperty.call(s,"conditions"))throw new Error('Engine: addRule() argument requires "conditions" property');f=new c.default(s)}return f.setEngine(this),this.rules.push(f),this.prioritizedRules=null,this}},{key:"updateRule",value:function(s){var f=this.rules.findIndex(function(O){return O.name===s.name});if(f>-1)this.rules.splice(f,1),this.addRule(s),this.prioritizedRules=null;else throw new Error("Engine: updateRule() rule not found")}},{key:"removeRule",value:function(s){var f=!1;if(s instanceof c.default){var t=this.rules.indexOf(s);t>-1&&(f=!!this.rules.splice(t,1).length)}else{var O=this.rules.filter(function(o){return o.name!==s});f=O.length!==this.rules.length,this.rules=O}return f&&(this.prioritizedRules=null),f}},{key:"setCondition",value:function(s,f){if(!s)throw new Error("Engine: setCondition() requires name");if(!f)throw new Error("Engine: setCondition() requires conditions");if(!Object.prototype.hasOwnProperty.call(f,"all")&&!Object.prototype.hasOwnProperty.call(f,"any")&&!Object.prototype.hasOwnProperty.call(f,"not")&&!Object.prototype.hasOwnProperty.call(f,"condition"))throw new Error('"conditions" root must contain a single instance of "all", "any", "not", or "condition"');return this.conditions.set(s,new M.default(f)),this}},{key:"removeCondition",value:function(s){return this.conditions.delete(s)}},{key:"addOperator",value:function(s,f){this.operators.addOperator(s,f)}},{key:"removeOperator",value:function(s){return this.operators.removeOperator(s)}},{key:"addOperatorDecorator",value:function(s,f){this.operators.addOperatorDecorator(s,f)}},{key:"removeOperatorDecorator",value:function(s){return this.operators.removeOperatorDecorator(s)}},{key:"addFact",value:function(s,f,O){var t=s,o=void 0;return s instanceof r.default?(t=s.id,o=s):o=new r.default(s,f,O),(0,P.default)("engine::addFact",{id:t}),this.facts.set(t,o),this}},{key:"removeFact",value:function(s){var f=void 0;return s instanceof r.default?f=s.id:f=s,this.facts.delete(f)}},{key:"prioritizeRules",value:function(){if(!this.prioritizedRules){var s=this.rules.reduce(function(f,O){var t=O.priority;return f[t]||(f[t]=[]),f[t].push(O),f},{});this.prioritizedRules=Object.keys(s).sort(function(f,O){return Number(f)>Number(O)?-1:1}).map(function(f){return s[f]})}return this.prioritizedRules}},{key:"stop",value:function(){return this.status=W,this}},{key:"getFact",value:function(s){return this.facts.get(s)}},{key:"evaluateRules",value:function(s,f){var O=this;return Promise.all(s.map(function(t){return O.status!==V?((0,P.default)("engine::run, skipping remaining rules",{status:O.status}),Promise.resolve()):t.evaluate(f).then(function(o){return(0,P.default)("engine::run",{ruleResult:o.result}),f.addResult(o),o.result?(f.addEvent(o.event,"success"),O.emitAsync("success",o.event,f,o).then(function(){return O.emitAsync(o.event.type,o.event.params,f,o)})):(f.addEvent(o.event,"failure"),O.emitAsync("failure",o.event,f,o))})}))}},{key:"run",value:function(){var s=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,P.default)("engine::run started"),this.status=V;var t=O.almanac||new d.default({allowUndefinedFacts:this.allowUndefinedFacts,pathResolver:this.pathResolver});this.facts.forEach(function(E){t.addFact(E)});for(var o in f){var l=void 0;f[o]instanceof r.default?l=f[o]:l=new r.default(o,f[o]),t.addFact(l),(0,P.default)("engine::run initialized runtime fact",{id:l.id,value:l.value,type:n(l.value)})}var v=this.prioritizeRules(),g=Promise.resolve();return new Promise(function(E,A){v.map(function(C){return g=g.then(function(){return s.evaluateRules(C,t)}).catch(A),g}),g.then(function(){s.status=W,(0,P.default)("engine::run completed");var C=t.getResults(),R=C.reduce(function(Q,z){var H=z.result?"results":"failureResults";return Q[H].push(z),Q},{results:[],failureResults:[]}),j=R.results,L=R.failureResults;E({almanac:t,results:j,failureResults:L,events:t.getEvents("success"),failureEvents:t.getEvents("failure")})}).catch(A)})}}]),N})(y.default);return re.default=ee,re}var Ze;function Dt(){if(Ze)return Z;Ze=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.OperatorDecorator=Z.Almanac=Z.Engine=Z.Operator=Z.Rule=Z.Fact=void 0,Z.default=function(h,_){return new e.default(h,_)};var n=kt(),e=w(n),i=De(),r=w(i),a=nt(),c=w(a),u=Oe(),d=w(u),p=it(),y=w(p),b=Fe(),x=w(b);function w(h){return h&&h.__esModule?h:{default:h}}return Z.Fact=r.default,Z.Rule=c.default,Z.Operator=d.default,Z.Engine=e.default,Z.Almanac=y.default,Z.OperatorDecorator=x.default,Z}var Se,Je;function Ft(){return Je||(Je=1,Se=Dt()),Se}var Mt=Ft();const Lt=ut(Mt);let se=new Lt;function Me(n,e){for(let i of window.payees)if(new RegExp(i.name,"i").test(n))return i;for(let i of window.payees.filter(r=>r.alias))for(let r of i.alias.split(`\r
`))if(new RegExp(r,"i").test(n))return i;return window.payees.find(i=>i.name===e)}const Tt=function(n,e){return n.length?new RegExp(e).test(n):!1};se.addOperator("matchesRegex",Tt);se.addRule({conditions:{all:[{fact:"Tpus",operator:"equal",value:"Krtyatranzakci"},{fact:"Kzlemny/3",operator:"matchesRegex",value:" Vsrls$"}]},event:{type:"Card payment",params:{processingRules:[{transactionField:"date",customFunction:function(n,e){let r=new RegExp(/\w+ (\d{4})(\d{2})(\d{2}) \w+/).exec(n["Kzlemny/1"]);if(r)return new Date(r[1]+"-"+r[2]+"-"+r[3])}},{transactionField:"transaction_config_type",customValue:"standard"},{transactionField:"transaction_type_id",customValue:1},{transactionField:"transaction_type.name",customValue:"withdrawal"},{transactionField:"transaction_type.amount_multiplier",customValue:1},{transactionField:"config.amount_from",customFunction:function(n,e){let r=new RegExp(/^-((\d+\s)*\d+,\d+) HUF$/).exec(n.sszeg);if(r)return parseFloat(r[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.amount_to",customFunction:function(n,e){let r=new RegExp(/^-((\d+\s)*\d+,\d+) HUF$/).exec(n.sszeg);if(r)return parseFloat(r[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.account_to",customFunction:function(n,e){return Me(n["Kzlemny/2"],"Egyb")}},{transactionField:"config.account_from",customFunction:function(n,e){return{id:$("#account").val(),name:$("#account option:selected").text()}}},{transactionField:"comment",customFunction:function(n,e){if(e.config.account_to?.name==="Egyb")return n["Kzlemny/2"]}}]}}});se.addRule({conditions:{all:[{fact:"sszeg",operator:"matchesRegex",value:"^-\\d+"},{fact:"Tpus",operator:"in",value:["Elektronikus bankon belli tutals","Elektronikus forint tutals","lland tutals","Csoportos beszedsi megbzs","Forint tutals"]}]},event:{type:"Outgoing wire transfer",params:{processingRules:[{transactionField:"date",customFunction:function(n,e){let r=new RegExp(/(\d{4})\.(\d{2})\.(\d{2})\./).exec(n.rtknap);if(r)return new Date(r[1]+"-"+r[2]+"-"+r[3])}},{transactionField:"transaction_config_type",customValue:"standard"},{transactionField:"transaction_type_id",customValue:1},{transactionField:"transaction_type.name",customValue:"withdrawal"},{transactionField:"transaction_type.amount_multiplier",customValue:1},{transactionField:"config.amount_from",customFunction:function(n,e){let r=new RegExp(/^-((\d+\s)*\d+,\d+) HUF$/).exec(n.sszeg);if(r)return parseFloat(r[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.amount_to",customFunction:function(n,e){let r=new RegExp(/^-((\d+\s)*\d+,\d+) HUF$/).exec(n.sszeg);if(r)return parseFloat(r[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.account_to",customFunction:function(n,e){return Me(n["Kzlemny/2"],"Egyb")}},{transactionField:"config.account_from",customFunction:function(n,e){return{id:$("#account").val(),name:$("#account option:selected").text()}}},{transactionField:"comment",customFunction:function(n,e){if(e.config.account_to?.name==="Egyb")return n["Kzlemny/2"]}}]}}});se.addRule({conditions:{all:[{fact:"sszeg",operator:"matchesRegex",value:"^\\d+"},{fact:"Tpus",operator:"in",value:["Forint tutals","Deviza tutals","Csoportos tutals jvrsa"]}]},event:{type:"Incoming wire transfer",params:{processingRules:[{transactionField:"date",customFunction:function(n,e){let r=new RegExp(/(\d{4})\.(\d{2})\.(\d{2})\./).exec(n.rtknap);if(r)return new Date(r[1]+"-"+r[2]+"-"+r[3])}},{transactionField:"transaction_config_type",customValue:"standard"},{transactionField:"transaction_type_id",customValue:2},{transactionField:"transaction_type.name",customValue:"deposit"},{transactionField:"transaction_type.amount_multiplier",customValue:1},{transactionField:"config.amount_from",customFunction:function(n,e){let r=new RegExp(/^((\d+\s)*\d+,\d+) HUF$/).exec(n.sszeg);if(r)return parseFloat(r[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.amount_to",customFunction:function(n,e){let r=new RegExp(/^((\d+\s)*\d+,\d+) HUF$/).exec(n.sszeg);if(r)return parseFloat(r[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.account_from",customFunction:function(n,e){return Me(n["Kzlemny/2"],"Egyb")}},{transactionField:"config.account_to",customFunction:function(n,e){return{id:$("#account").val(),name:$("#account option:selected").text()}}},{transactionField:"comment",customFunction:function(n,e){if(e.config.account_to?.name==="Egyb")return n["Kzlemny/2"]}}]}}});se.addRule({conditions:{any:[{all:[{fact:"Tpus",operator:"equal",value:"Elektronik. sajt szmls tvezets"},{fact:"Kzlemny/3",operator:"in",value:["Hitelkrtya feltlts","Pay off credit card"]}]},{all:[{fact:"Tpus",operator:"equal",value:"Krtyatranzakci"},{fact:"Kzlemny/3",operator:"matchesRegex",value:" Kp felvt$"}]}]},event:{type:"Cash withdrawal",params:{processingRules:[{transactionField:"date",customFunction:function(n,e){let r=new RegExp(/(\d{4})\.(\d{2})\.(\d{2})\./).exec(n.rtknap);if(r)return new Date(r[1]+"-"+r[2]+"-"+r[3])}},{transactionField:"transaction_config_type",customValue:"standard"},{transactionField:"transaction_type_id",customValue:3},{transactionField:"transaction_type.name",customValue:"transfer"},{transactionField:"transaction_type.amount_multiplier",customValue:""},{transactionField:"config.amount_from",customFunction:function(n,e){let r=new RegExp(/^-((\d+\s)*\d+,\d+) HUF$/).exec(n.sszeg);if(r)return parseFloat(r[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.amount_to",customFunction:function(n,e){let r=new RegExp(/^-((\d+\s)*\d+,\d+) HUF$/).exec(n.sszeg);if(r)return parseFloat(r[1].replace(/\s/g,"").replace(/,/,"."))}},{transactionField:"config.account_to",customValue:void 0},{transactionField:"config.account_from",customFunction:function(n,e){return{id:$("#account").val(),name:$("#account option:selected").text()}}},{transactionField:"comment",customFunction:function(n,e){return n["Kzlemny/3"]}}]}}});at.exports=se});export default It();
