import{_ as h,a as d,o as l,b as s,e as b,t as o,w as x,f as R,g as f,v as C,n as D,F as g,h as p,r as m,d as _,c as P}from"./app-KLFPBacJ.js";import{_ as y,a as E}from"./helpers-C8PqwG3r.js";import"./dataTables.bootstrap5-Csew7iXD.js";import{t as A,a as S}from"./dataTableHelper-BFrUsbwO.js";import{S as M}from"./sweetalert2.esm.all-BQxta0Da.js";import{u as q,c as L,D as B,V as U,N,L as O,B as I,R as Y,X as j,a as V,b as z,t as X}from"./animated-BLhhOB8u.js";import{D as W}from"./DateRangePicker-BBP1Q5Mi.js";import G from"./presetDates-Ct9BMwxE.js";import"./tslib.es6-CZM0TROl.js";import"./Datepicker-CU1wOnOT.js";const J={name:"CurrencyRateOverview",props:{from:{type:Object,required:!0},to:{type:Object,required:!0},currencyRates:{type:Array,required:!0}},data(){return{locale:window.YAFFA.locale}},methods:{formatDate(e){return e=new Date(e),e.toLocaleDateString(this.locale)},toFormattedCurrency:E,__:y}},Q={class:"card mb-3"},H={class:"card-header"},K={class:"card-title collapse-control","data-coreui-toggle":"collapse","data-coreui-target":"#cardOverview"},Z={class:"collapse card-body show","aria-expanded":"true",id:"cardOverview"},ee={class:"row mb-0"},te={class:"col-6"},ae={class:"col-6"},se={class:"col-6"},re={class:"col-6"},ie={class:"col-6"},ne={class:"col-6"},oe={class:"col-6"},de={key:0,class:"col-6"},le={key:1,class:"col-6 text-italic text-muted"},ce={class:"col-6"},ue={key:2,class:"col-6"},he={key:3,class:"col-6 text-italic text-muted"},me={class:"col-6"},_e={key:4,class:"col-6"},ye={key:5,class:"col-6 text-italic text-muted"};function fe(e,t,r,c,i,a){return l(),d("div",Q,[s("div",H,[s("div",K,[t[0]||(t[0]=s("i",{class:"fa fa-angle-down"},null,-1)),b(" "+o(a.__("Overview")),1)])]),s("div",Z,[s("dl",ee,[s("dt",te,o(a.__("From")),1),s("dd",ae,o(r.from.name),1),s("dt",se,o(a.__("To")),1),s("dd",re,o(r.to.name),1),s("dt",ie,o(a.__("Number of records")),1),s("dd",ne,o(r.currencyRates.length),1),s("dt",oe,o(a.__("First available data")),1),r.currencyRates.length>0?(l(),d("dd",de,o(a.formatDate(r.currencyRates[0].date)),1)):(l(),d("dd",le,o(a.__("No data")),1)),s("dt",ce,o(a.__("Last available data")),1),r.currencyRates.length>0?(l(),d("dd",ue,o(a.formatDate(r.currencyRates[r.currencyRates.length-1].date)),1)):(l(),d("dd",he,o(a.__("No data")),1)),s("dt",me,o(a.__("Last known rate")),1),r.currencyRates.length>0?(l(),d("dd",_e,o(a.toFormattedCurrency(1,i.locale,r.from))+" = "+o(a.toFormattedCurrency(r.currencyRates[r.currencyRates.length-1].rate,i.locale,r.to)),1)):(l(),d("dd",ye,o(a.__("No data")),1))])])])}const be=h(J,[["render",fe]]),ge={name:"CurrencyRateActions",props:{fromCurrency:{type:Object,required:!0},dateFrom:{type:String,default:null},dateTo:{type:String,default:null}},emits:["add-rate","rates-loaded"],data(){return{isLoadingMissing:!1}},methods:{addNewRate(){this.$emit("add-rate")},async loadMissingRates(){if(this.isLoadingMissing)return;this.isLoadingMissing=!0;const e=new CustomEvent("toast",{detail:{body:this.__("Loading missing rates..."),toastClass:"bg-info toast-loading-missing-rates",delay:1/0}});window.dispatchEvent(e);try{await window.axios.get(window.route("api.currency-rate.retrieveMissing",{currency:this.fromCurrency.id}));const t=new CustomEvent("toast",{detail:{header:this.__("Success"),body:this.__("Missing rates loaded successfully"),toastClass:"bg-success"}});window.dispatchEvent(t),this.$emit("rates-loaded")}catch(t){const r=new CustomEvent("toast",{detail:{header:this.__("Error"),body:t.response?.data?.message||this.__("Failed to load missing rates"),toastClass:"bg-danger"}});window.dispatchEvent(r)}finally{this.isLoadingMissing=!1,setTimeout(()=>{const t=document.querySelectorAll(".toast-loading-missing-rates");t.length>0&&t.forEach(r=>{new window.bootstrap.Toast(r).dispose()})},250)}},__:y}},pe={class:"card mb-3"},we={class:"card-header"},ve={class:"card-title collapse-control","data-coreui-toggle":"collapse","data-coreui-target":"#cardActions"},Re={class:"list-group list-group-flush collapse show","aria-expanded":"true",id:"cardActions"},Ce={class:"list-group-item d-flex justify-content-between align-items-center"},De=["title"],Fe=["title"],ke={class:"list-group-item d-flex justify-content-between align-items-center"},Te=["title","disabled"],xe=["title","disabled"],Pe={key:0,class:"fa fa-fw fa-spinner fa-spin"},Ee={key:1,class:"fa fa-fw fa-cloud-download"};function Ae(e,t,r,c,i,a){return l(),d("div",pe,[s("div",we,[s("div",ve,[t[4]||(t[4]=s("i",{class:"fa fa-angle-down"},null,-1)),b(" "+o(a.__("Actions")),1)])]),s("ul",Re,[s("li",Ce,[s("button",{class:"btn btn-link text-decoration-none p-0 add-currency-rate-button",onClick:t[0]||(t[0]=(...n)=>a.addNewRate&&a.addNewRate(...n)),title:a.__("Add new rate")},o(a.__("Add new rate")),9,De),s("button",{class:"btn btn-xs btn-primary add-currency-rate-button",onClick:t[1]||(t[1]=(...n)=>a.addNewRate&&a.addNewRate(...n)),title:a.__("Add new rate")},[...t[5]||(t[5]=[s("span",{class:"fa fa-fw fa-plus"},null,-1)])],8,Fe)]),s("li",ke,[s("button",{class:"btn btn-link text-decoration-none p-0",onClick:t[2]||(t[2]=(...n)=>a.loadMissingRates&&a.loadMissingRates(...n)),title:a.__("Load missing rates"),disabled:i.isLoadingMissing},o(a.__("Load missing rates")),9,Te),s("button",{class:"btn btn-xs btn-success",onClick:t[3]||(t[3]=(...n)=>a.loadMissingRates&&a.loadMissingRates(...n)),title:a.__("Load missing rates"),disabled:i.isLoadingMissing},[i.isLoadingMissing?(l(),d("span",Pe)):(l(),d("span",Ee))],8,xe)])])])}const Se=h(ge,[["render",Ae]]),Me={name:"CurrencyRateTable",props:{currencyRates:{type:Array,required:!0},fromCurrency:{type:Object,required:!0},toCurrency:{type:Object,required:!0},filteredRates:{type:Array,default:null}},emits:["edit-rate","delete-rate","data-updated"],data(){return{table:null}},watch:{filteredRates:{handler(e){this.table&&(this.table.clear(),e?this.table.rows.add(e):this.table.rows.add(this.currencyRates),this.table.draw())},deep:!0}},mounted(){this.initializeTable()},beforeUnmount(){this.table&&this.table.destroy()},methods:{initializeTable(){const e=this;this.table=$("#ratesTable").DataTable({data:this.currencyRates,columns:[A.dateFromCustomField("date",this.__("Date"),window.YAFFA.locale),{data:"rate",title:this.__("Rate"),render:function(t,r){return S(r,t,window.YAFFA.locale,Object.assign({},e.toCurrency,{max_digits:4}))}},{data:"id",title:this.__("Actions"),render:function(t,r,c,i){return`
                                <button class="btn btn-xs btn-primary edit-rate" data-id="${t}" title="${e.__("Edit")}">
                                    <span class="fa fa-edit"></span>
                                </button>
                                <button class="btn btn-xs btn-danger delete-rate" data-id="${t}" title="${e.__("Delete")}">
                                    <span class="fa fa-trash"></span>
                                </button>
                            `},className:"dt-nowrap",orderable:!1,searchable:!1}],order:[[0,"desc"]],deferRender:!0,scrollY:"500px",scrollCollapse:!0,stateSave:!1,processing:!0,paging:!1,info:!1}),$("#ratesTable").on("click",".edit-rate",function(){const t=$(this).data("id"),r=e.currencyRates.find(c=>c.id===t);r&&e.$emit("edit-rate",r)}),$("#ratesTable").on("click",".delete-rate",function(){const t=$(this).data("id"),r=e.currencyRates.find(c=>c.id===t);r&&e.confirmDelete(r)})},confirmDelete(e){M.fire({animation:!1,text:this.__("Are you sure to want to delete this item?"),icon:"warning",showCancelButton:!0,cancelButtonText:this.__("Cancel"),confirmButtonText:this.__("Confirm"),buttonsStyling:!1,customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-outline-secondary ms-3"}}).then(t=>{t.isConfirmed&&this.deleteRate(e)})},async deleteRate(e){const t=new CustomEvent("toast",{detail:{body:this.__("Deleting rate..."),toastClass:`bg-info toast-rate-${e.id}`,delay:1/0}});window.dispatchEvent(t);try{await window.axios.delete(window.route("api.currency-rate.destroy",{currency_rate:e.id}));const r=new CustomEvent("toast",{detail:{header:this.__("Success"),body:this.__("Currency rate deleted"),toastClass:"bg-success"}});window.dispatchEvent(r),this.$emit("delete-rate",e.id)}catch(r){const c=new CustomEvent("toast",{detail:{header:this.__("Error"),body:r.response?.data?.message||this.__("Failed to delete rate"),toastClass:"bg-danger"}});window.dispatchEvent(c)}finally{setTimeout(()=>{const r=document.querySelector(`.toast-rate-${e.id}`);r&&new window.bootstrap.Toast(r).dispose()},250)}},updateTableData(e){this.table&&(this.table.clear(),this.table.rows.add(e),this.table.draw())},__:y}},qe={class:"card"},Le={class:"card-header"},Be={class:"card-title"};function Ue(e,t,r,c,i,a){return l(),d("div",qe,[s("div",Le,[s("div",Be,o(a.__("Currency rate values")),1)]),t[0]||(t[0]=s("div",{class:"card-body no-datatable-search"},[s("table",{class:"table table-bordered table-hover",role:"grid",id:"ratesTable"})],-1))])}const Ne=h(Me,[["render",Ue]]),Oe={name:"CurrencyRateChart",props:{currencyRates:{type:Array,required:!0},toCurrency:{type:Object,required:!0},locale:{type:String,default:()=>window.YAFFA?window.YAFFA.locale:navigator.language}},computed:{hasData(){return this.currencyRates&&this.currencyRates.length>0}},watch:{currencyRates:{handler(e){e&&e.length>0?this.chart?this.chart.data=e:this.$nextTick(()=>{this.initializeChart()}):this.chart&&(this.chart.dispose(),this.chart=null)},deep:!0}},mounted(){this.hasData&&this.initializeChart()},beforeUnmount(){this.chart&&this.chart.dispose()},methods:{initializeChart(){q(X);const e=L(this.$refs.chartRate,z);e.data=this.currencyRates,e.dateFormatter.inputDateFormat="yyyy-MM-dd";const t=e.xAxes.push(new B);t.dataFields.category="date";const r=e.yAxes.push(new U),c=new Intl.NumberFormat(this.locale,{style:"currency",currency:this.toCurrency.iso_code,currencyDisplay:"narrowSymbol",minimumFractionDigits:0,maximumFractionDigits:4});r.numberFormatter=new N,r.numberFormatter.numberFormat="#,###.####",r.numberFormatter.format.bind(r.numberFormatter),r.numberFormatter.format=function(w){return c.format(w)};const i=e.series.push(new O);i.dataFields.valueY="rate",i.dataFields.dateX="date",i.strokeWidth=3;const n=i.bullets.push(new I).createChild(Y);n.width=5,n.height=5,n.horizontalCenter="middle",n.verticalCenter="middle";const u=new j;u.series.push(i),e.scrollbarX=u,e.cursor=new V,e.cursor.behavior="zoomX",e.cursor.xAxis=t,this.chart=e},updateChart(e){this.chart&&e&&e.length>0&&(this.chart.data=e)},__:y}},Ie={class:"card"},Ye={class:"card-body"},$e={key:0},je={ref:"chartRate",style:{width:"100%",height:"500px"}},Ve={key:1},ze={class:"text-center text-muted"};function Xe(e,t,r,c,i,a){return l(),d("div",Ie,[s("div",Ye,[a.hasData?(l(),d("div",$e,[s("div",je,null,512)])):(l(),d("div",Ve,[s("div",ze,o(a.__("No data available")),1)]))])])}const We=h(Oe,[["render",Xe]]),Ge={name:"CurrencyRateModal",props:{fromCurrency:{type:Object,required:!0},toCurrency:{type:Object,required:!0},editRate:{type:Object,default:null}},emits:["saved","close"],data(){return{formData:{date:"",rate:null},errors:{},isSubmitting:!1,modal:null}},computed:{isEditMode(){return this.editRate!==null}},watch:{editRate:{immediate:!0,handler(e){e?(this.formData.date=e.date,this.formData.rate=e.rate):this.resetForm()}}},mounted(){const e=document.getElementById("currencyRateModal");window.coreui&&window.coreui.Modal?this.modal=new window.coreui.Modal(e):this.modal=new window.bootstrap.Modal(e),e.addEventListener("hidden.bs.modal",()=>{this.resetForm(),this.$emit("close")}),e.addEventListener("hidden.coreui.modal",()=>{this.resetForm(),this.$emit("close")})},methods:{show(){this.modal.show()},hide(){this.modal.hide()},resetForm(){this.formData={date:"",rate:null},this.errors={}},async submitForm(){if(this.isSubmitting)return;this.errors={},this.isSubmitting=!0;const e={from_id:this.fromCurrency.id,to_id:this.toCurrency.id,date:this.formData.date,rate:this.formData.rate};try{let t;this.isEditMode?t=await window.axios.put(window.route("api.currency-rate.update",{currency_rate:this.editRate.id}),e):t=await window.axios.post(window.route("api.currency-rate.store"),e),this.$emit("saved",t.data.rate,t.data.message),this.hide()}catch(t){if(t.response&&t.response.status===422)this.errors=t.response.data.errors;else{const r=new CustomEvent("toast",{detail:{header:this.__("Error"),body:t.response?.data?.message||this.__("An error occurred"),toastClass:"bg-danger"}});window.dispatchEvent(r)}}finally{this.isSubmitting=!1}},__:y}},Je={class:"modal fade",id:"currencyRateModal",tabindex:"-1"},Qe={class:"modal-dialog"},He={class:"modal-content"},Ke={class:"modal-header"},Ze={class:"modal-title"},et={class:"modal-body"},tt={class:"mb-3"},at={for:"rateDate",class:"form-label"},st={key:0,class:"invalid-feedback"},rt={key:0},it={key:1},nt={class:"mb-3"},ot={for:"rateValue",class:"form-label"},dt={class:"text-muted"},lt={key:0,class:"invalid-feedback"},ct={key:0},ut={key:1},ht={class:"modal-footer"},mt={type:"button",class:"btn btn-secondary","data-coreui-dismiss":"modal"},_t=["disabled"],yt={key:0,class:"spinner-border spinner-border-sm me-1"};function ft(e,t,r,c,i,a){return l(),d("div",Je,[s("div",Qe,[s("div",He,[s("div",Ke,[s("h5",Ze,o(a.isEditMode?a.__("Edit Currency Rate"):a.__("Add Currency Rate")),1),t[4]||(t[4]=s("button",{type:"button",class:"btn-close","data-coreui-dismiss":"modal","aria-label":"Close"},null,-1))]),s("div",et,[s("form",{onSubmit:t[2]||(t[2]=x((...n)=>a.submitForm&&a.submitForm(...n),["prevent"]))},[s("div",tt,[s("label",at,o(a.__("Date")),1),R(s("input",{type:"date",class:D(["form-control",{"is-invalid":i.errors.date}]),id:"rateDate","onUpdate:modelValue":t[0]||(t[0]=n=>i.formData.date=n),required:""},null,2),[[C,i.formData.date]]),i.errors.date?(l(),d("div",st,[Array.isArray(i.errors.date)?(l(),d("div",rt,[(l(!0),d(g,null,p(i.errors.date,n=>(l(),d("div",{key:n},o(n),1))),128))])):(l(),d("div",it,o(i.errors.date),1))])):f("",!0)]),s("div",nt,[s("label",ot,[b(o(a.__("Rate"))+" ",1),s("small",dt,"("+o(r.fromCurrency.iso_code)+" â†’ "+o(r.toCurrency.iso_code)+")",1)]),R(s("input",{type:"number",step:"0.0001",min:"0.0000000001",class:D(["form-control",{"is-invalid":i.errors.rate}]),id:"rateValue","onUpdate:modelValue":t[1]||(t[1]=n=>i.formData.rate=n),required:""},null,2),[[C,i.formData.rate,void 0,{number:!0}]]),i.errors.rate?(l(),d("div",lt,[Array.isArray(i.errors.rate)?(l(),d("div",ct,[(l(!0),d(g,null,p(i.errors.rate,n=>(l(),d("div",{key:n},o(n),1))),128))])):(l(),d("div",ut,o(i.errors.rate),1))])):f("",!0)])],32)]),s("div",ht,[s("button",mt,o(a.__("Cancel")),1),s("button",{type:"button",class:"btn btn-primary",onClick:t[3]||(t[3]=(...n)=>a.submitForm&&a.submitForm(...n)),disabled:i.isSubmitting},[i.isSubmitting?(l(),d("span",yt)):f("",!0),b(" "+o(a.isEditMode?a.__("Update"):a.__("Add")),1)],8,_t)])])])])}const bt=h(Ge,[["render",ft]]),gt={name:"DateRangeSelectorWithPresets",emits:["update","dateChange"],props:{initialDateFrom:{type:String,default:null},initialDateTo:{type:String,default:null},initialPreset:{type:String,default:"none"},showUpdateButton:{type:Boolean,default:!1},presetGroups:{type:Array,default:()=>[{label:"Current period",options:[{value:"thisMonth",label:"This month"},{value:"thisQuarter",label:"This quarter"},{value:"thisYear",label:"This year"},{value:"thisMonthToDate",label:"This month to date"},{value:"thisQuarterToDate",label:"This quarter to date"},{value:"thisYearToDate",label:"This year to date"}]},{label:"Recent periods",options:[{value:"yesterday",label:"Yesterday"},{value:"previous7Days",label:"Previous 7 days"},{value:"previous30Days",label:"Previous 30 days"},{value:"previous90Days",label:"Previous 90 days"},{value:"previous180Days",label:"Previous 180 days"},{value:"previous365Days",label:"Previous 365 days"}]},{label:"Previous period",options:[{value:"previousMonth",label:"Previous month"},{value:"previousMonthToDate",label:"Previous month to date"}]}]}},data(){return{dateFrom:this.initialDateFrom,dateTo:this.initialDateTo,dateRangePicker:null,isPresetChange:!1}},mounted(){if(this.dateRangePicker=new W(this.$refs.dateRangePicker,{allowOneSidedRange:!0,weekStart:1,todayBtn:!0,todayBtnMode:1,todayHighlight:!0,language:window.YAFFA?window.YAFFA.language:"en",format:"yyyy-mm-dd",autohide:!0,buttonClass:"btn"}),this.initialDateFrom||this.initialDateTo){const r=this.initialDateFrom||{clear:!0},c=this.initialDateTo||{clear:!0};this.dateRangePicker.setDates(r,c)}if(this.initialPreset&&this.initialPreset!=="none"){const r=document.getElementById("dateRangePickerPresets");r&&(r.value=this.initialPreset,this.isPresetChange=!0,this.onPresetSelect({target:r}),this.isPresetChange=!1)}const e=this.$refs.dateRangePicker.querySelector('[name="date_from"]'),t=this.$refs.dateRangePicker.querySelector('[name="date_to"]');e&&t&&(e.addEventListener("changeDate",this.onDateChange),t.addEventListener("changeDate",this.onDateChange))},beforeUnmount(){this.dateRangePicker&&this.dateRangePicker.destroy()},methods:{clearSelection(){this.dateRangePicker.setDates({clear:!0},{clear:!0}),this.dateFrom=null,this.dateTo=null;const e=document.getElementById("dateRangePickerPresets");e&&(e.value="none"),this.emitUpdate()},onDateChange(){if(!this.dateRangePicker)return;if(!this.isPresetChange){const t=document.getElementById("dateRangePickerPresets");t&&(t.value="none")}const e=this.dateRangePicker.getDates("yyyy-mm-dd");this.dateFrom=e[0]||null,this.dateTo=e[1]||null,this.showUpdateButton||this.emitUpdate(),this.$emit("dateChange",{dateFrom:this.dateFrom,dateTo:this.dateTo,preset:this.isPresetChange?document.getElementById("dateRangePickerPresets")?.value:"none"})},onPresetSelect(e){this.isPresetChange=!0;const t=e.target.value,r=new Date;let c,i;const a=G[t];if(a){const n=a(r);c=n.start,i=n.end}else c={clear:!0},i={clear:!0};this.dateRangePicker.setDates(c,i),this.isPresetChange=!1,this.onDateChange()},triggerUpdate(){this.emitUpdate()},emitUpdate(){this.$emit("update",{dateFrom:this.dateFrom,dateTo:this.dateTo,preset:document.getElementById("dateRangePickerPresets")?.value||"none"})},getDates(){return this.dateRangePicker?this.dateRangePicker.getDates("yyyy-mm-dd"):[this.dateFrom,this.dateTo]},__:function(e,t){return window.__(e,t)}}},pt={class:"card mb-3"},wt={class:"card-header"},vt={class:"card-title"},Rt={class:"card-body",ref:"dateRangePicker"},Ct={class:"row"},Dt={class:"col-6"},Ft={for:"date_from",class:"form-label"},kt=["placeholder"],Tt={class:"col-6"},xt={for:"date_to",class:"form-label"},Pt=["placeholder"],Et={class:"row mt-2"},At={class:"col-12"},St={value:"none"},Mt=["label"],qt=["value"],Lt={class:"card-footer text-end"};function Bt(e,t,r,c,i,a){return l(),d("div",pt,[s("div",wt,[s("div",vt,o(a.__("Date")),1)]),s("div",Rt,[s("div",Ct,[s("div",Dt,[s("label",Ft,o(a.__("Date from")),1),s("input",{type:"text",class:"form-control",name:"date_from",id:"date_from",placeholder:a.__("Select date"),autocomplete:"off"},null,8,kt)]),s("div",Tt,[s("label",xt,o(a.__("Date to")),1),s("input",{type:"text",class:"form-control",name:"date_to",id:"date_to",placeholder:a.__("Select date"),autocomplete:"off"},null,8,Pt)])]),s("div",Et,[s("div",At,[s("select",{id:"dateRangePickerPresets",class:"form-select",onChange:t[0]||(t[0]=(...n)=>a.onPresetSelect&&a.onPresetSelect(...n))},[s("option",St,o(a.__("Select preset")),1),(l(!0),d(g,null,p(r.presetGroups,n=>(l(),d("optgroup",{key:n.label,label:a.__(n.label)},[(l(!0),d(g,null,p(n.options,u=>(l(),d("option",{key:u.value,value:u.value},o(a.__(u.label)),9,qt))),128))],8,Mt))),128))],32)])])],512),s("div",Lt,[s("button",{class:"btn btn-sm btn-outline-dark",onClick:t[1]||(t[1]=(...n)=>a.clearSelection&&a.clearSelection(...n))},o(a.__("Clear selection")),1),r.showUpdateButton?(l(),d("button",{key:0,type:"button",class:"btn btn-sm btn-primary ms-2",onClick:t[2]||(t[2]=(...n)=>a.triggerUpdate&&a.triggerUpdate(...n))},o(a.__("Update")),1)):f("",!0)])])}const Ut=h(gt,[["render",Bt]]),Nt={name:"CurrencyRateManager",components:{CurrencyRateOverview:be,CurrencyRateActions:Se,CurrencyRateTable:Ne,CurrencyRateChart:We,CurrencyRateModal:bt,DateRangeSelectorWithPresets:Ut},props:{from:{type:Object,required:!0},to:{type:Object,required:!0},initialRates:{type:Array,required:!0}},data(){return{fromCurrency:this.from,toCurrency:this.to,allRates:JSON.parse(JSON.stringify(this.initialRates)),displayRates:null,dateFrom:null,dateTo:null,editingRate:null,isUpdatingFromChart:!1}},watch:{dateFrom(){this.updateDisplayRates()},dateTo(){this.updateDisplayRates()}},methods:{onDateChange({dateFrom:e,dateTo:t}){this.isUpdatingFromChart||(this.dateFrom=e,this.dateTo=t,this.updateDisplayRates())},updateDisplayRates(){if(!this.dateFrom&&!this.dateTo){this.displayRates=null;return}const e=this.allRates.filter(t=>{const r=new Date(t.date);if(this.dateFrom&&this.dateTo){const c=new Date(this.dateFrom),i=new Date(this.dateTo);return r>=c&&r<=i}else if(this.dateFrom){const c=new Date(this.dateFrom);return r>=c}else if(this.dateTo){const c=new Date(this.dateTo);return r<=c}return!0});this.displayRates=e},openAddModal(){this.editingRate=null,this.$nextTick(()=>{this.$refs.rateModal.show()})},openEditModal(e){this.editingRate=e,this.$nextTick(()=>{this.$refs.rateModal.show()})},onRateSaved(e,t){const r=new CustomEvent("toast",{detail:{header:this.__("Success"),body:t,toastClass:"bg-success"}});window.dispatchEvent(r);const c=this.allRates.findIndex(i=>i.id===e.id);c!==-1?this.allRates.splice(c,1,e):this.allRates.push(e),this.allRates.sort((i,a)=>new Date(i.date)-new Date(a.date)),this.updateDisplayRates(),this.$refs.rateTable.updateTableData(this.displayRates||this.allRates)},onRateDeleted(e){this.allRates=this.allRates.filter(t=>t.id!==e),this.updateDisplayRates(),this.$refs.rateTable.updateTableData(this.displayRates||this.allRates),this.$refs.rateChart.updateChart(this.allRates)},async reloadData(){try{const e=await window.axios.get(window.route("api.currency-rate.index",{from:this.fromCurrency.id,to:this.toCurrency.id}));this.allRates=e.data.rates,this.updateDisplayRates(),this.$refs.rateTable.updateTableData(this.displayRates||this.allRates),this.$refs.rateChart.updateChart(this.allRates)}catch(e){console.error("Failed to reload rates:",e)}},__:y}},Ot={class:"row"},It={class:"col-12 col-lg-3"},Yt={class:"col-12 col-lg-3"},$t={class:"col-md-6"};function jt(e,t,r,c,i,a){const n=m("currency-rate-overview"),u=m("currency-rate-actions"),w=m("date-range-selector-with-presets"),F=m("currency-rate-table"),k=m("currency-rate-chart"),T=m("currency-rate-modal");return l(),d("div",null,[s("div",Ot,[s("div",It,[_(n,{from:i.fromCurrency,to:i.toCurrency,"currency-rates":i.allRates},null,8,["from","to","currency-rates"]),_(u,{"from-currency":i.fromCurrency,"date-from":i.dateFrom,"date-to":i.dateTo,onAddRate:a.openAddModal,onRatesLoaded:a.reloadData},null,8,["from-currency","date-from","date-to","onAddRate","onRatesLoaded"]),_(w,{ref:"dateSelector","initial-date-from":i.dateFrom,"initial-date-to":i.dateTo,onUpdate:a.onDateChange},null,8,["initial-date-from","initial-date-to","onUpdate"])]),s("div",Yt,[_(F,{ref:"rateTable","currency-rates":i.allRates,"filtered-rates":i.displayRates,"from-currency":i.fromCurrency,"to-currency":i.toCurrency,onEditRate:a.openEditModal,onDeleteRate:a.onRateDeleted},null,8,["currency-rates","filtered-rates","from-currency","to-currency","onEditRate","onDeleteRate"])]),s("div",$t,[_(k,{ref:"rateChart","currency-rates":i.allRates,"to-currency":i.toCurrency},null,8,["currency-rates","to-currency"])])]),_(T,{ref:"rateModal","from-currency":i.fromCurrency,"to-currency":i.toCurrency,"edit-rate":i.editingRate,onSaved:a.onRateSaved,onClose:t[0]||(t[0]=zt=>i.editingRate=null)},null,8,["from-currency","to-currency","edit-rate","onSaved"])])}const Vt=h(Nt,[["render",jt]]),v=P({});v.config.globalProperties.__=window.__;v.component("currency-rate-manager",Vt);v.mount("#currencyRateApp");
